<!doctype html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-rc.20" />
    <meta name="theme" content="VuePress Theme Hope 2.0.0-rc.77" />
    <style>
      :root {
        --vp-c-bg: #fff;
      }

      [data-theme="dark"] {
        --vp-c-bg: #1b1b1f;
      }

      html,
      body {
        background: var(--vp-c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.documentElement.setAttribute("data-theme", "dark");
      }
    </script>
    <meta property="og:url" content="https://houbb.github.io/interview/posts/interview/tech/Kafka%20%E9%82%A3%E7%82%B9%E7%A0%B4%E4%BA%8B.html"><meta property="og:site_name" content="è€é©¬å•¸è¥¿é£"><meta property="og:title" content="ç¬¬åå››ç¯‡ï¼šKafka ï¼åˆ†åŒºã€å‰¯æœ¬ã€æ¶ˆè´¹ç»„ã€é«˜å¯é æ€§"><meta property="og:description" content="Kafka é‚£ç‚¹ç ´äº‹ï¼åˆ†åŒºã€å‰¯æœ¬ã€æ¶ˆè´¹ç»„ã€é«˜å¯é æ€§ ä½œè€…ï¼šè€é©¬ å…¬ä¼—å·ï¼šè€é©¬å•¸è¥¿é£ åšå®¢ï¼šhttps://houbb.github.io/ äººç”Ÿç†å¿µï¼šçŸ¥é“çš„è¶Šå¤šï¼Œä¸çŸ¥é“çš„è¶Šå¤šï¼ŒåŠªåŠ›å»å­¦ Kafka æ˜¯ä»€ä¹ˆï¼Ÿ ç­”æ¡ˆï¼šKafka æ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼çš„æµå¼å¤„ç†å¹³å°ï¼Œå®ƒä»¥é«˜ååã€å¯æŒä¹…åŒ–ã€å¯æ°´å¹³æ‰©å±•ã€æ”¯æŒæµæ•°æ®å¤„ç†ç­‰å¤šç§ç‰¹æ€§è€Œè¢«å¹¿æ³›ä½¿ç”¨ä¸»è¦åŠŸèƒ½ä½“ç°äºä¸‰ç‚¹ï¼š æ¶ˆæ¯ç³»ç»Ÿ..."><meta property="og:type" content="article"><meta property="og:image" content="https://cdn.nlark.com/yuque/0/2022/png/21503536/1666966942521-1e262f78-d331-4349-9e0c-45714524ad8a.png#clientId=ua41a3794-5c73-4&from=paste&height=209&id=ua0ed81c5&originHeight=459&originWidth=1080&originalType=url&ratio=1&rotation=0&showTitle=false&status=done&style=none&taskId=u4e87f618-00df-4e04-a78f-3ad31d2f9ca&title=&width=491"><meta property="og:locale" content="zh-CN"><meta property="og:updated_time" content="2025-08-16T11:28:53.000Z"><meta property="article:modified_time" content="2025-08-16T11:28:53.000Z"><script type="application/ld+json">{"@context":"https://schema.org","@type":"Article","headline":"ç¬¬åå››ç¯‡ï¼šKafka ï¼åˆ†åŒºã€å‰¯æœ¬ã€æ¶ˆè´¹ç»„ã€é«˜å¯é æ€§","image":["https://cdn.nlark.com/yuque/0/2022/png/21503536/1666966942521-1e262f78-d331-4349-9e0c-45714524ad8a.png#clientId=ua41a3794-5c73-4&from=paste&height=209&id=ua0ed81c5&originHeight=459&originWidth=1080&originalType=url&ratio=1&rotation=0&showTitle=false&status=done&style=none&taskId=u4e87f618-00df-4e04-a78f-3ad31d2f9ca&title=&width=491","https://cdn.nlark.com/yuque/0/2022/png/21503536/1666966942546-3b9a01af-9570-429e-8c6a-bc2a26148816.png#clientId=ua41a3794-5c73-4&from=paste&height=363&id=u1ac1f286&originHeight=658&originWidth=1080&originalType=url&ratio=1&rotation=0&showTitle=false&status=done&style=none&taskId=ue64094f7-fef5-4b48-9016-7218229abd2&title=&width=595","https://cdn.nlark.com/yuque/0/2022/png/21503536/1666966942538-22430d80-14e5-4bcb-affe-e151d06f9332.png#clientId=ua41a3794-5c73-4&from=paste&height=337&id=u784d93ba&originHeight=660&originWidth=1286&originalType=url&ratio=1&rotation=0&showTitle=false&status=done&style=none&taskId=u5ff74075-b1e7-4af2-9368-08600d40f1f&title=&width=656","https://cdn.nlark.com/yuque/0/2022/png/21503536/1666966942543-ac16f79c-ece0-4c08-9e31-21569255f13e.png#clientId=ua41a3794-5c73-4&from=paste&height=188&id=u40aef77f&originHeight=516&originWidth=982&originalType=url&ratio=1&rotation=0&showTitle=false&status=done&style=none&taskId=u0a82dcee-d23f-41b1-898a-209da8642c2&title=&width=358","https://cdn.nlark.com/yuque/0/2022/png/21503536/1666966942555-118cbba0-3250-4370-83ff-6771a36ae158.png#clientId=ua41a3794-5c73-4&from=paste&height=395&id=u06e2198e&originHeight=669&originWidth=1080&originalType=url&ratio=1&rotation=0&showTitle=false&status=done&style=none&taskId=u9e9c4ec7-09e2-43d9-8913-d39799fac69&title=&width=638","https://cdn.nlark.com/yuque/0/2022/png/21503536/1666966943079-0344bf10-49e4-4b73-b6dd-08553ea6817d.png#clientId=ua41a3794-5c73-4&from=paste&height=260&id=ueeba08ad&originHeight=525&originWidth=1080&originalType=url&ratio=1&rotation=0&showTitle=false&status=done&style=none&taskId=ub59f66ec-19b2-4e49-a9b9-12d6b44ef7c&title=&width=535","https://cdn.nlark.com/yuque/0/2022/png/21503536/1666966942924-0c5e68c4-4358-450a-a269-7d8b83a76984.png#clientId=ua41a3794-5c73-4&from=paste&height=286&id=uc3ce1972&originHeight=544&originWidth=1080&originalType=url&ratio=1&rotation=0&showTitle=false&status=done&style=none&taskId=u5c1fda36-25da-40ae-aa4d-7d85d9d09ec&title=&width=568","https://cdn.nlark.com/yuque/0/2022/png/21503536/1666966943097-87e73a92-25cb-4987-9592-b8a945bc17ef.png#clientId=ua41a3794-5c73-4&from=paste&height=277&id=u105ce1e4&originHeight=536&originWidth=1080&originalType=url&ratio=1&rotation=0&showTitle=false&status=done&style=none&taskId=u21038c1d-0648-4e02-9f4a-c458c1c09c6&title=&width=559","https://cdn.nlark.com/yuque/0/2022/png/21503536/1666966943050-f067c92e-da8a-4523-b8d1-b8df48a829c2.png#clientId=ua41a3794-5c73-4&from=paste&height=240&id=u17272f4d&originHeight=392&originWidth=892&originalType=url&ratio=1&rotation=0&showTitle=false&status=done&style=none&taskId=u06187419-1307-429b-80f2-3c18f836688&title=&width=546","https://cdn.nlark.com/yuque/0/2022/png/21503536/1666966943237-44fcbda1-d733-4eb5-8aa6-2328e15bbc4d.png#clientId=ua41a3794-5c73-4&from=paste&height=240&id=uabea12a3&originHeight=412&originWidth=994&originalType=url&ratio=1&rotation=0&showTitle=false&status=done&style=none&taskId=u5f29c7fe-ef80-4dc6-a076-69436c6b2c2&title=&width=578","https://cdn.nlark.com/yuque/0/2022/png/21503536/1666966943332-f155dc0c-b407-49be-8c86-d03a29aabf03.png#clientId=ua41a3794-5c73-4&from=paste&height=235&id=u1dce99b2&originHeight=463&originWidth=1080&originalType=url&ratio=1&rotation=0&showTitle=false&status=done&style=none&taskId=ud49020f6-a594-4d89-bdb5-f5e97710dec&title=&width=547","https://cdn.nlark.com/yuque/0/2022/png/21503536/1666966943464-979b5978-dc65-48ad-ba95-3f3ccb6648e8.png#clientId=ua41a3794-5c73-4&from=paste&height=232&id=u0e06b4cd&originHeight=458&originWidth=1080&originalType=url&ratio=1&rotation=0&showTitle=false&status=done&style=none&taskId=u2cbc278f-c674-4f59-a34b-5caaf830382&title=&width=547"],"dateModified":"2025-08-16T11:28:53.000Z","author":[{"@type":"Person","name":"è€é©¬å•¸è¥¿é£","url":"https://houbb.github.io"}]}</script><title>ç¬¬åå››ç¯‡ï¼šKafka ï¼åˆ†åŒºã€å‰¯æœ¬ã€æ¶ˆè´¹ç»„ã€é«˜å¯é æ€§ | è€é©¬å•¸è¥¿é£</title><meta name="description" content="Kafka é‚£ç‚¹ç ´äº‹ï¼åˆ†åŒºã€å‰¯æœ¬ã€æ¶ˆè´¹ç»„ã€é«˜å¯é æ€§ ä½œè€…ï¼šè€é©¬ å…¬ä¼—å·ï¼šè€é©¬å•¸è¥¿é£ åšå®¢ï¼šhttps://houbb.github.io/ äººç”Ÿç†å¿µï¼šçŸ¥é“çš„è¶Šå¤šï¼Œä¸çŸ¥é“çš„è¶Šå¤šï¼ŒåŠªåŠ›å»å­¦ Kafka æ˜¯ä»€ä¹ˆï¼Ÿ ç­”æ¡ˆï¼šKafka æ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼çš„æµå¼å¤„ç†å¹³å°ï¼Œå®ƒä»¥é«˜ååã€å¯æŒä¹…åŒ–ã€å¯æ°´å¹³æ‰©å±•ã€æ”¯æŒæµæ•°æ®å¤„ç†ç­‰å¤šç§ç‰¹æ€§è€Œè¢«å¹¿æ³›ä½¿ç”¨ä¸»è¦åŠŸèƒ½ä½“ç°äºä¸‰ç‚¹ï¼š æ¶ˆæ¯ç³»ç»Ÿ...">
    <link rel="preload" href="/interview/assets/style-BGajUEJb.css" as="style"><link rel="stylesheet" href="/interview/assets/style-BGajUEJb.css">
    <link rel="modulepreload" href="/interview/assets/app-BDqOilFQ.js"><link rel="modulepreload" href="/interview/assets/Kafka é‚£ç‚¹ç ´äº‹.html-B7Y-_l1g.js"><link rel="modulepreload" href="/interview/assets/plugin-vue_export-helper-DlAUqK2U.js">
    <link rel="prefetch" href="/interview/assets/index.html-k5_JBS9p.js" as="script"><link rel="prefetch" href="/interview/assets/intro.html-Cf4vxY-f.js" as="script"><link rel="prefetch" href="/interview/assets/frame.html-DNrzzFG5.js" as="script"><link rel="prefetch" href="/interview/assets/Tomå“¥çš„çŸ¥è¯†æ˜Ÿçƒ.html-Ciieg50X.js" as="script"><link rel="prefetch" href="/interview/assets/è¯»ä¹¦å•.html-DOxDSzTc.js" as="script"><link rel="prefetch" href="/interview/assets/google_search.html-DwZOXyus.js" as="script"><link rel="prefetch" href="/interview/assets/å…¥èŒä¸€å®¶æ–°å…¬å¸ï¼Œå¦‚ä½•å¿«é€Ÿç†Ÿæ‚‰ä»£ç ï¼Ÿ.html-CHswpTEe.js" as="script"><link rel="prefetch" href="/interview/assets/æé«˜ã€Œç¨‹åºå‘˜ã€çš„æ€ç»´æ–¹å¼.html-SFeCH-xu.js" as="script"><link rel="prefetch" href="/interview/assets/çŸ¥è¯†æ”¹å˜å‘½è¿ï¼Œè¯»ä¹¦æ”¹å˜ç”Ÿæ´».html-BoG4fm4U.js" as="script"><link rel="prefetch" href="/interview/assets/about-me.html-O8XlBfpf.js" as="script"><link rel="prefetch" href="/interview/assets/ä¸‡çº§å¹¶å‘ç”µå•†åº“å­˜æ‰£å‡å¦‚ä½•è®¾è®¡ï¼Ÿä¸è¶…å–ï¼.html-DjUYwWeg.js" as="script"><link rel="prefetch" href="/interview/assets/å¦‚ä½•ç©å¥½ä¼˜æƒ åˆ¸è¿™æŠŠè¥é”€åˆ©å‰‘ï¼Ÿ.html-DFpT1VX0.js" as="script"><link rel="prefetch" href="/interview/assets/å¦‚ä½•è®¾è®¡ä¸€ä¸ªé«˜æ€§èƒ½çš„ç§’æ€ç³»ç»Ÿ.html-CIEsv46H.js" as="script"><link rel="prefetch" href="/interview/assets/æ‹†è§£é›¶å”®å•†å“æ¶æ„çš„åº•å±‚é€»è¾‘.html-BxnCOPsj.js" as="script"><link rel="prefetch" href="/interview/assets/æ·±å…¥å‰–æä¼˜æƒ åˆ¸æ ¸å¿ƒæ¶æ„è®¾è®¡.html-DTjksLHY.js" as="script"><link rel="prefetch" href="/interview/assets/ç”µå•†ç³»ç»Ÿæ¶æ„ï¼Œ å¸¸è§çš„ 9 ä¸ªå¤§å‘.html-DsIoicvh.js" as="script"><link rel="prefetch" href="/interview/assets/ç”µå•†è®¢å•è‡ªåŠ¨ç¡®è®¤æ”¶è´§çš„Nç§å®ç°.html-CIA5CvIf.js" as="script"><link rel="prefetch" href="/interview/assets/èŠèŠç”µå•†ä¿ƒé”€ä¸šåŠ¡.html-DN3AKlU-.js" as="script"><link rel="prefetch" href="/interview/assets/Redis _ Lua ç»„åˆå®ç°åˆ†å¸ƒå¼é™æµ.html-Sz2QiHj6.js" as="script"><link rel="prefetch" href="/interview/assets/Redisåˆ†å¸ƒå¼é”.html-wy624EaH.js" as="script"><link rel="prefetch" href="/interview/assets/å€ŸåŠ©æµç¨‹å¼•æ“ä¼˜åŒ–ç³»ç»Ÿçš„å¤æ‚åº¦.html-LOSFo4jQ.js" as="script"><link rel="prefetch" href="/interview/assets/æäº†ä¸ªçº¿ä¸Šæ•…éšœï¼Œè¢«è€æ¿éª‚äº†.html-dYp4WXy0.js" as="script"><link rel="prefetch" href="/interview/assets/ç”µå•†å¤§ä¿ƒï¼Œã€Œç½‘ç«™å®æ—¶æˆäº¤é¢ã€ä»ªè¡¨å¤§ç›˜æŠ€æœ¯æ–¹æ¡ˆï¼Ÿ.html-CQd02jQ_.js" as="script"><link rel="prefetch" href="/interview/assets/ç”µå•†å¹³å°çš„çƒ­ç‚¹å•†å“æ¶æ„æ–¹æ¡ˆ.html-Dy1UPzqf.js" as="script"><link rel="prefetch" href="/interview/assets/å­¦ä¼šè¿™10ä¸ªè®¾è®¡åŸåˆ™ï¼Œç¦»æ¶æ„å¸ˆåˆè¿›äº†ä¸€æ­¥.html-DMmPa5tJ.js" as="script"><link rel="prefetch" href="/interview/assets/è½¯ä»¶è®¾è®¡æ¨¡å¼ç³»åˆ—ï¼ˆç¬¬ä¸€æœŸï¼‰.html-jsbbACWK.js" as="script"><link rel="prefetch" href="/interview/assets/è½¯ä»¶è®¾è®¡æ¨¡å¼ç³»åˆ—ï¼ˆç¬¬ä¸‰æœŸï¼‰.html-_kphjzBV.js" as="script"><link rel="prefetch" href="/interview/assets/è½¯ä»¶è®¾è®¡æ¨¡å¼ç³»åˆ—ï¼ˆç¬¬äºŒæœŸï¼‰.html-Br7VQ9fU.js" as="script"><link rel="prefetch" href="/interview/assets/OpenResty å®ç°é™æµ.html-BNBarziV.js" as="script"><link rel="prefetch" href="/interview/assets/gRPC ç½‘å…³ï¼Œé’ˆå¯¹ HTTP 2.0 é•¿è¿æ¥æ€§èƒ½ä¼˜åŒ–ï¼Œæå‡ååé‡.html-DKT-5nNT.js" as="script"><link rel="prefetch" href="/interview/assets/ã€é«˜å¹¶å‘ã€é«˜æ€§èƒ½ã€é«˜å¯ç”¨ã€‘ç³»ç»Ÿè®¾è®¡ç»éªŒ.html-Da-dpwT5.js" as="script"><link rel="prefetch" href="/interview/assets/ä¸­å°ä¸æ˜¯ä¸‡èƒ½è¯ï¼.html-DkUi1-F4.js" as="script"><link rel="prefetch" href="/interview/assets/ä¸ºä»€ä¹ˆæ˜¯ HTTP2 ï¼Œè€Œä¸æ˜¯HTTP2.0 ï¼Ÿ.html-CwfOgY2V.js" as="script"><link rel="prefetch" href="/interview/assets/äººäººéƒ½æ˜¯æ¶æ„å¸ˆï¼Ÿï¼è°ˆä½•å®¹æ˜“ï¼.html-Bw_nLUXQ.js" as="script"><link rel="prefetch" href="/interview/assets/å¤–éƒ¨æ¥å£å¤§é‡è¶…æ—¶ï¼ŒæŠŠæ•´ä¸ªç³»ç»Ÿæ‹–å®ï¼Œå¼•å‘é›ªå´©ï¼å¦‚ä½•è§£å†³ï¼Ÿç†”æ–­.html-DXRSaU05.js" as="script"><link rel="prefetch" href="/interview/assets/å¦‚ä½•è®¾è®¡ä¸€ä¸ªé«˜å¹¶å‘ç³»ç»Ÿï¼Ÿ.html-CLCl75r-.js" as="script"><link rel="prefetch" href="/interview/assets/æµ·é‡æ•°æ®ä¸šåŠ¡æœ‰å“ªäº›ä¼˜åŒ–æ‰‹æ®µï¼Ÿ.html-DxILofn5.js" as="script"><link rel="prefetch" href="/interview/assets/ç½‘å…³æŠ€æœ¯é€‰å‹ï¼Œä¸ºä»€ä¹ˆé€‰æ‹© Openresty.html-DI5EmrKw.js" as="script"><link rel="prefetch" href="/interview/assets/ä½ ç¦»èŒçš„åŸå› æ˜¯ä»€ä¹ˆï¼Ÿå¦‚ä½•é¿å‘ï¼Ÿ.html-DnIJsMaw.js" as="script"><link rel="prefetch" href="/interview/assets/Docker é‚£ç‚¹ç ´äº‹.html-DCAuCV8l.js" as="script"><link rel="prefetch" href="/interview/assets/JAVA å¹¶å‘é‚£ç‚¹ç ´äº‹.html-DnOeyJQf.js" as="script"><link rel="prefetch" href="/interview/assets/JAVAåŸºç¡€é‚£ç‚¹ç ´äº‹.html-E_Px5QR3.js" as="script"><link rel="prefetch" href="/interview/assets/JAVAé›†åˆé‚£ç‚¹ç ´äº‹.html-DSgAXLin.js" as="script"><link rel="prefetch" href="/interview/assets/JVM é‚£ç‚¹ç ´äº‹.html-C8yajNtR.js" as="script"><link rel="prefetch" href="/interview/assets/Kubernetes é‚£ç‚¹ç ´äº‹.html-DfdEZq1-.js" as="script"><link rel="prefetch" href="/interview/assets/MQ é‚£ç‚¹ç ´äº‹.html-WAMqR7Qf.js" as="script"><link rel="prefetch" href="/interview/assets/MySQL é‚£ç‚¹ç ´äº‹.html-D5rh8EQv.js" as="script"><link rel="prefetch" href="/interview/assets/Mybatis é‚£ç‚¹ç ´äº‹.html-BLMBg3y6.js" as="script"><link rel="prefetch" href="/interview/assets/Nginx é‚£ç‚¹ç ´äº‹.html-lYPt57TJ.js" as="script"><link rel="prefetch" href="/interview/assets/Redis ç¼“å­˜é‚£ç‚¹ç ´äº‹.html-p8TzZlj6.js" as="script"><link rel="prefetch" href="/interview/assets/RocketMQ é‚£ç‚¹ç ´äº‹.html-CcnC51cO.js" as="script"><link rel="prefetch" href="/interview/assets/Spring Boot é‚£ç‚¹ç ´äº‹.html-BzeR53GA.js" as="script"><link rel="prefetch" href="/interview/assets/Spring Cloud é‚£ç‚¹ç ´äº‹.html-CwHiIYk9.js" as="script"><link rel="prefetch" href="/interview/assets/Spring é‚£ç‚¹ç ´äº‹.html-kfEkGxp_.js" as="script"><link rel="prefetch" href="/interview/assets/TCP ç½‘ç»œé‚£ç‚¹ç ´äº‹.html-ClTKgnuP.js" as="script"><link rel="prefetch" href="/interview/assets/æ“ä½œç³»ç»Ÿé‚£ç‚¹ç ´äº‹.html-DBqg3jcv.js" as="script"><link rel="prefetch" href="/interview/assets/é¢è¯•é‚£ç‚¹ç ´äº‹.html-BHRGQ758.js" as="script"><link rel="prefetch" href="/interview/assets/é¡¹ç›®äº®ç‚¹.html-BrZMYJu8.js" as="script"><link rel="prefetch" href="/interview/assets/Kafka å¦‚ä½•è§£å†³æ¶ˆæ¯ä¸ä¸¢å¤±ï¼Ÿ.html-BkHFCiPx.js" as="script"><link rel="prefetch" href="/interview/assets/å…³äºæ¶ˆæ¯é˜Ÿåˆ—ï¼Œé¢è¯•å®˜ä¸€èˆ¬éƒ½ä¼šé—®å“ªäº›.html-sGwdJkOz.js" as="script"><link rel="prefetch" href="/interview/assets/å¦‚ä½•ä¿è¯ MQæ¶ˆæ¯æ˜¯æœ‰åºçš„ï¼Ÿ.html-Bitq6zfJ.js" as="script"><link rel="prefetch" href="/interview/assets/èŠèŠ Kafka é‚£ç‚¹ç ´äº‹.html-CfKpfhSS.js" as="script"><link rel="prefetch" href="/interview/assets/MySQL ä¸»ä»å»¶è¿Ÿ 7 ç§è§£å†³æ–¹æ¡ˆ.html-D2bq-4sJ.js" as="script"><link rel="prefetch" href="/interview/assets/MySQL ä¸»å¤‡å»¶è¿Ÿæœ‰å“ªäº›å‘ï¼Ÿä¸»å¤‡åˆ‡æ¢ç­–ç•¥.html-DIAgL5jd.js" as="script"><link rel="prefetch" href="/interview/assets/SQL ä¼˜åŒ–æœ‰å“ªäº›æŠ€å·§.html-oM6sgDb7.js" as="script"><link rel="prefetch" href="/interview/assets/SQL è¯­å¥æ˜æ˜å‘½ä¸­äº†ç´¢å¼•ï¼Œä¸ºä»€ä¹ˆæ‰§è¡Œå¾ˆæ…¢ï¼Ÿ.html-BozlKyCY.js" as="script"><link rel="prefetch" href="/interview/assets/mysql ä¸€æ£µ B_ æ ‘èƒ½å­˜å¤šå°‘æ¡æ•°æ®ï¼Ÿ.html-BvHBy6dJ.js" as="script"><link rel="prefetch" href="/interview/assets/ä¸€å¼ åƒä¸‡çº§çš„æ•°æ®è¡¨ï¼Œåˆ é™¤äº†ä¸€åŠçš„æ•°æ®ï¼Œä½ è§‰å¾—B_æ ‘ç´¢å¼•æ–‡ä»¶ä¼šä¸ä¼šå˜å°ï¼Ÿ.html-1naVguy8.js" as="script"><link rel="prefetch" href="/interview/assets/æ‹‰å– binlogï¼Œè‡ªåŠ¨åŒæ­¥æ•°æ®.html-DGd7_Qut.js" as="script"><link rel="prefetch" href="/interview/assets/è®²ä¸€è®² MySQL æ•°æ®å¤‡ä»½æ€æ‰‹é” binlog.html-CjBQWAhr.js" as="script"><link rel="prefetch" href="/interview/assets/è·‘äº†4ä¸ªå®éªŒï¼Œå®æˆ˜è®²è§£ MySQLçš„è¡Œé”ã€é—´éš™é”.html-BYNe6aSG.js" as="script"><link rel="prefetch" href="/interview/assets/2ç±³çš„å¤§é•¿å›¾ä¸€æ–‡æ‰“å°½ Redis æ ¸å¿ƒæŠ€æœ¯.html-D1B_XRUm.js" as="script"><link rel="prefetch" href="/interview/assets/Redis Clusteré›†ç¾¤ï¼Œå½“masterå®•æœºï¼Œä¸»ä»åˆ‡æ¢ï¼Œå®¢æˆ·ç«¯æŠ¥é”™ timed out.html-DgP_GN6J.js" as="script"><link rel="prefetch" href="/interview/assets/Redis å®•æœºï¼Œæ•°æ®ä¸¢äº†ï¼Œè€æ¿è¦è¾é€€æˆ‘.html-PQ9YlSXV.js" as="script"><link rel="prefetch" href="/interview/assets/Redisä¸»èŠ‚ç‚¹å®•æœºï¼Œè¦å¦‚ä½•å¤„ç†ï¼Ÿ.html-Dhgauvr1.js" as="script"><link rel="prefetch" href="/interview/assets/Redisä¸»èŠ‚ç‚¹çš„Keyå·²è¿‡æœŸï¼Œä½†Clientè®¿é—®ä»èŠ‚ç‚¹ä¾ç„¶å¯ä»¥è¯»åˆ°è¿‡æœŸæ•°æ®.html-C4IwDNKO.js" as="script"><link rel="prefetch" href="/interview/assets/ä¸€ä¸‹è¯´å‡ºäº† Redis 16 ä¸ªå¸¸è§ä½¿ç”¨åœºæ™¯ï¼ŒæƒŠå‘†é¢è¯•å®˜.html-lbb2aNXK.js" as="script"><link rel="prefetch" href="/interview/assets/ä¸ºä»€ä¹ˆRedis Clusteræ˜¯16384ä¸ªæ§½ä½.html-J0OGH9eF.js" as="script"><link rel="prefetch" href="/interview/assets/äº¿çº§ç³»ç»Ÿçš„Redisç¼“å­˜å¦‚ä½•è®¾è®¡.html-DLRXByjD.js" as="script"><link rel="prefetch" href="/interview/assets/ä»€ä¹ˆæ˜¯å¸ƒéš†è¿‡æ»¤å™¨ï¼Ÿå¦‚ä½•è§£å†³é«˜å¹¶å‘ç¼“å­˜ç©¿é€é—®é¢˜ï¼Ÿ.html-CYOAbJFy.js" as="script"><link rel="prefetch" href="/interview/assets/å¦‚ä½•è§£å†³ Redis æ•°æ®å€¾æ–œã€çƒ­ç‚¹ç­‰é—®é¢˜.html-DRTIUZrL.js" as="script"><link rel="prefetch" href="/interview/assets/ç§’æ€æ´»åŠ¨æŠ€æœ¯æ–¹æ¡ˆï¼ŒRedisç”³è¯·32ä¸ªGï¼Œè¢«æŠ€æœ¯æ€»ç›‘æŒ‘æˆ˜äº†.html-DdvfT2ew.js" as="script"><link rel="prefetch" href="/interview/assets/optimize.html-BKISQZ9F.js" as="script"><link rel="prefetch" href="/interview/assets/ä¸­é—´ä»¶ï¼š4 ç§ä¸»æµ RPC æ¡†æ¶.html-BfqvO61S.js" as="script"><link rel="prefetch" href="/interview/assets/ä¸­é—´ä»¶ï¼šElasticSearch è§£å†³å¤æ‚æ¡ä»¶æŸ¥è¯¢.html-DDLOE3rd.js" as="script"><link rel="prefetch" href="/interview/assets/ä¸­é—´ä»¶ï¼šæ³¨å†Œä¸­å¿ƒçš„ 5 ç§æŠ€æœ¯é€‰å‹.html-COA7DcSy.js" as="script"><link rel="prefetch" href="/interview/assets/ä¸­é—´ä»¶ï¼šæ¶ˆæ¯é˜Ÿåˆ—å¿…é—®çš„ 6 ä¸ªç»å…¸é—®é¢˜.html-DTKV_dhe.js" as="script"><link rel="prefetch" href="/interview/assets/ä¸­é—´ä»¶ï¼šç¼“å­˜æ˜¯æ€§èƒ½ä¼˜åŒ–çš„é¦–é€‰åˆ©å™¨.html-rO5PPqGZ.js" as="script"><link rel="prefetch" href="/interview/assets/ä¸­é—´ä»¶ï¼šç¼“å­˜çš„ 7 å¤§ç»å…¸é—®é¢˜.html-CdOxDyA-.js" as="script"><link rel="prefetch" href="/interview/assets/ä¸­é—´ä»¶ï¼šé€šè¿‡æ¶ˆæ¯é˜Ÿåˆ—åˆ†æ‹…ç³»ç»Ÿå‹åŠ›.html-DbDaCMCM.js" as="script"><link rel="prefetch" href="/interview/assets/ä»£ç ç¯‡ï¼šå­¦ä¼š13 ç§é”ï¼Œä»æ­¤ä¸å†ä¸ºâ€œé”â€å¿ƒçƒ¦.html-Bbg0KuZw.js" as="script"><link rel="prefetch" href="/interview/assets/ä»£ç ç¯‡ï¼šå¼‚æ­¥ç¼–ç¨‹çš„ 7 ç§å®ç°æ–¹å¼.html-CPdiUwJd.js" as="script"><link rel="prefetch" href="/interview/assets/ä»£ç ç¯‡ï¼šæ¥å£å¹‚ç­‰æ€§çš„ 8 ç§è§£å†³æ–¹æ¡ˆ.html-Uy5M4tMj.js" as="script"><link rel="prefetch" href="/interview/assets/ä»£ç ç¯‡ï¼šæ¥å£æ€§èƒ½ä¼˜åŒ–çš„ 15 ä¸ªæŠ€å·§.html-B618PJEY.js" as="script"><link rel="prefetch" href="/interview/assets/åŸºç¡€ç¯‡ï¼šä¸ºä»€ä¹ˆæµé‡å…¥å£è¦éƒ¨ç½²ç½‘å…³ï¼Ÿ.html-C1b7Qgo7.js" as="script"><link rel="prefetch" href="/interview/assets/åŸºç¡€ç¯‡ï¼šè´Ÿè½½å‡è¡¡å¸¸ç”¨çš„ 7 ç§ç®—æ³•.html-0jMNX98U.js" as="script"><link rel="prefetch" href="/interview/assets/æå‡ç¯‡ï¼šé€šè¿‡Arthaså¿«é€Ÿå®šä½çº¿ä¸Šé—®é¢˜.html-BVTIT3U0.js" as="script"><link rel="prefetch" href="/interview/assets/æå‡ç¯‡ï¼šé€šè¿‡é“¾è·¯è¿½è¸ªä¼˜åŒ–æ…¢è¯·æ±‚.html-DqUc_rhQ.js" as="script"><link rel="prefetch" href="/interview/assets/æ•°æ®åº“ï¼šSQL ä¼˜åŒ– 7 æ¡ç»éªŒæ€»ç»“.html-8S5LsSkR.js" as="script"><link rel="prefetch" href="/interview/assets/æ•°æ®åº“ï¼šåˆ†å¸ƒå¼ä¸»é”® id çš„ 7 ç§ç”Ÿæˆç­–ç•¥.html-DMplfLTj.js" as="script"><link rel="prefetch" href="/interview/assets/æ•°æ®åº“ï¼šåˆ†å¸ƒå¼äº‹åŠ¡çš„ 7 ç§æŠ€æœ¯æ–¹æ¡ˆ.html-DP5efx9S.js" as="script"><link rel="prefetch" href="/interview/assets/æ•°æ®åº“ï¼šæµ·é‡æ•°æ®ä¸šåŠ¡æœ‰å“ªäº›æ–¹æ¡ˆ.html-CcnXxpjI.js" as="script"><link rel="prefetch" href="/interview/assets/æ¶æ„ç¯‡ï¼š10 ä¸ªæ¶æ„åŸåˆ™ï¼Œç¦»æ¶æ„å¸ˆåˆè¿›äº†ä¸€æ­¥.html-DH_6FATo.js" as="script"><link rel="prefetch" href="/interview/assets/æ¶æ„ç¯‡ï¼šDDDå¦‚ä½•æŒ‡å¯¼å¾®æœåŠ¡è½åœ°.html-DpPIFcUJ.js" as="script"><link rel="prefetch" href="/interview/assets/ç¨³å®šæ€§ï¼šç³»ç»Ÿé«˜å¯ç”¨çš„ 11 ä¸ªæ–¹æ¡ˆæŠ€å·§.html-DRhU8Zze.js" as="script"><link rel="prefetch" href="/interview/assets/ç¨³å®šæ€§ï¼šé™æµçš„ 4 ç§ç­–ç•¥æ–¹æ¡ˆ.html-DfPgw4Kh.js" as="script"><link rel="prefetch" href="/interview/assets/introductory.html-By8avEpt.js" as="script"><link rel="prefetch" href="/interview/assets/ç¬¬ 1 è®²ï¼šæ‰¾å·¥ä½œæœ‰å“ªäº›æ¸ é“.html-B6RSoqHt.js" as="script"><link rel="prefetch" href="/interview/assets/ç¬¬ 10 è®²ï¼šå¦‚ä½•äº‰å–æ›´é«˜è–ªèµ„ï¼Ÿ.html-D2W40RXB.js" as="script"><link rel="prefetch" href="/interview/assets/ç¬¬ 2 è®²ï¼šå¦‚ä½•æŒ‘é€‰å¿ƒä»ªå…¬å¸ï¼Ÿ.html-DrPpdbs6.js" as="script"><link rel="prefetch" href="/interview/assets/ç¬¬ 3 è®²ï¼šJD ä¸æ˜¯æ‘†è®¾ï¼Œæ•™ä½ çœ‹æ‡‚å²—ä½.html-Brm4MJht.js" as="script"><link rel="prefetch" href="/interview/assets/ç¬¬ 4 è®²ï¼šä»€ä¹ˆæ—¶å€™è·³æ§½æœ€åˆé€‚ï¼Ÿ.html-DAG7CDPo.js" as="script"><link rel="prefetch" href="/interview/assets/ç¬¬ 5 è®²ï¼šè®¾è®¡è®©é¢è¯•å®˜çœ¼å‰ä¸€äº®çš„ç®€å†ï¼Ÿ.html-ByeeBO0a.js" as="script"><link rel="prefetch" href="/interview/assets/ç¬¬ 6 è®²ï¼šæ€ä¹ˆè®©é¢è¯•å®˜å–œæ¬¢ä½ ï¼Ÿ.html-xUzaYjlI.js" as="script"><link rel="prefetch" href="/interview/assets/ç¬¬ 7 è®²ï¼šé¢è¯•ä¸­é‡åˆ°ä¸ä¼šçš„é—®é¢˜æ€ä¹ˆåŠï¼Ÿ.html-B9fA4YCC.js" as="script"><link rel="prefetch" href="/interview/assets/ç¬¬ 8 è®²ï¼šHRç¯èŠ‚ä¸€èˆ¬å–œæ¬¢é—®å“ªäº›é—®é¢˜ï¼Ÿ.html-DFIAKy2C.js" as="script"><link rel="prefetch" href="/interview/assets/ç¬¬ 9 è®²ï¼šå¦‚ä½•æŒ‘é€‰æœ€é€‚åˆè‡ªå·±çš„ offerï¼Ÿ.html-BjunANiz.js" as="script"><link rel="prefetch" href="/interview/assets/001 _  èŒåœºé­é‡è€æ¿ PUAï¼Œæ€ä¹ˆåŠï¼Ÿ.html-CwG6DLNe.js" as="script"><link rel="prefetch" href="/interview/assets/002 _  ä¸åŒäº‹å‘ç”Ÿå†²çªæ€ä¹ˆåŠï¼Ÿ.html-DJ29ChQM.js" as="script"><link rel="prefetch" href="/interview/assets/003 _  èŒåœºä¸ç›¸ä¿¡çœ¼æ³ªï¼Œåƒä¸‡ä¸è¦ç»ç’ƒå¿ƒ ï¼Ÿ.html-B_nRAvIz.js" as="script"><link rel="prefetch" href="/interview/assets/004 _  å…¥èŒä¸€å®¶æ–°å…¬å¸ï¼Œå¦‚ä½•å¿«é€Ÿç†Ÿæ‚‰ä»£ç .html-Fxuqjnis.js" as="script"><link rel="prefetch" href="/interview/assets/005 _  å·¥ä½œä¸­ï¼ŒåŒäº‹ä¸é…åˆæ€ä¹ˆåŠï¼Ÿ.html-BtXsxYW2.js" as="script"><link rel="prefetch" href="/interview/assets/006 _  è¦æƒ³èŒåœºæ··çš„å¥½ï¼Œå‘ä¸Šç®¡ç†å¾ˆé‡è¦.html-Saeta9os.js" as="script"><link rel="prefetch" href="/interview/assets/007 _  ç¦»èŒåï¼Œä¸€å®šè¦ç«‹åˆ»æ‰¾åˆ°æ–°å·¥ä½œå—ï¼Ÿ.html-KRvwnBKn.js" as="script"><link rel="prefetch" href="/interview/assets/008 _  ç©ºé™é¢†å¯¼å¦‚ä½•åšï¼Œæ‰èƒ½å¹³ç¨³ç€é™†ï¼Ÿ.html-Gh-EQNx-.js" as="script"><link rel="prefetch" href="/interview/assets/009 _  ä¿®ç‚¼å¿ƒæ€ï¼Œé¿å…èŒåœºå†…è€—ï¼.html-ceZVND5-.js" as="script"><link rel="prefetch" href="/interview/assets/010 _ ä¸ºä»€ä¹ˆç¨‹åºå‘˜è¦ä¿®ç‚¼è‡ªå·±å¯¹å¤–ã€Œæ²Ÿé€šã€èƒ½åŠ›ï¼Ÿ.html-Cr1x_v_x.js" as="script"><link rel="prefetch" href="/interview/assets/å€ŸåŠ©Proxyä»£ç†æå‡æ¶æ„æ‰©å±•æ€§.html-BssFotaM.js" as="script"><link rel="prefetch" href="/interview/assets/å¦‚ä½•å®ç°æ³¨è§£RPC Consumerå±æ€§åŠ¨æ€æ³¨å…¥.html-BbGIfdcC.js" as="script"><link rel="prefetch" href="/interview/assets/ç»Ÿè®¡ä»£ç å—è€—æ—¶çš„å°å·¥å…·.html-pJo4fc2D.js" as="script"><link rel="prefetch" href="/interview/assets/Apollo.html-Dn38QZSk.js" as="script"><link rel="prefetch" href="/interview/assets/Caffeine.html-ihRcV9kC.js" as="script"><link rel="prefetch" href="/interview/assets/Druid.html-BoKZCZ1k.js" as="script"><link rel="prefetch" href="/interview/assets/Dubbo.html-Dw7lycqt.js" as="script"><link rel="prefetch" href="/interview/assets/EhCache.html-BTLeqQcm.js" as="script"><link rel="prefetch" href="/interview/assets/Elastic-Job.html-BVFoGWNu.js" as="script"><link rel="prefetch" href="/interview/assets/ElasticSearch.html-ClL26ysp.js" as="script"><link rel="prefetch" href="/interview/assets/Guava.html-BSNzi0nl.js" as="script"><link rel="prefetch" href="/interview/assets/HttpClient.html-CdavkqVJ.js" as="script"><link rel="prefetch" href="/interview/assets/Kafka.html-CAhYOLzn.js" as="script"><link rel="prefetch" href="/interview/assets/MongoDB.html-BuydeC0J.js" as="script"><link rel="prefetch" href="/interview/assets/Mybatis.html-mI2HEwzj.js" as="script"><link rel="prefetch" href="/interview/assets/Nacos.html-B5-nPgQk.js" as="script"><link rel="prefetch" href="/interview/assets/OkHttp.html-CFWEoOp7.js" as="script"><link rel="prefetch" href="/interview/assets/Pulsar.html-CG4n30YT.js" as="script"><link rel="prefetch" href="/interview/assets/RabbitMQ.html-Bh86mJqG.js" as="script"><link rel="prefetch" href="/interview/assets/Redis-safety.html-oYKJFFqg.js" as="script"><link rel="prefetch" href="/interview/assets/Redis.html-DdyAf7TX.js" as="script"><link rel="prefetch" href="/interview/assets/RocketMQ.html-CQMtAHFe.js" as="script"><link rel="prefetch" href="/interview/assets/Seata.html-BlUz4PWO.js" as="script"><link rel="prefetch" href="/interview/assets/ShardingSphere.html-ClMqLJXk.js" as="script"><link rel="prefetch" href="/interview/assets/Spring-Data-JPA.html-Tx0nC0PO.js" as="script"><link rel="prefetch" href="/interview/assets/gRPC.html-CHNFqn4T.js" as="script"><link rel="prefetch" href="/interview/assets/spring-cloud-alibaba.html-CeVAyZtN.js" as="script"><link rel="prefetch" href="/interview/assets/spring-frame-compare.html-CJOOEUB-.js" as="script"><link rel="prefetch" href="/interview/assets/ä½œä¸ºæŠ€æœ¯å›¢é˜ŸTLï¼Œå¦‚ä½•è¿ç”¨OKRæé«˜å›¢é˜Ÿäº§å‡º.html-DeBwh6Xt.js" as="script"><link rel="prefetch" href="/interview/assets/å›¢é˜Ÿç®¡ç†é‚£ç‚¹ç ´äº‹.html-Cc9IAWay.js" as="script"><link rel="prefetch" href="/interview/assets/å¦‚ä½•æ‰“é€ ä¸€ä¸ªé«˜æ•ˆçš„ç ”å‘å›¢é˜Ÿ.html-BQ23G-QU.js" as="script"><link rel="prefetch" href="/interview/assets/æ•™ä½ å‡ æ‹›ï¼Œå¦‚ä½•å¿«é€ŸæŠŠä¸€ä¸ªå›¢é˜Ÿæå®.html-Crn0NbSM.js" as="script"><link rel="prefetch" href="/interview/assets/ç¬¬ä¸€æ¬¡å¸¦å›¢é˜Ÿæ„Ÿè§‰å¾ˆæ…Œ.html-C5O8_PNd.js" as="script"><link rel="prefetch" href="/interview/assets/ç®¡ç†è€…ä¸€å®šä¼šé‡åˆ°çš„é‚£äº›äº‹.html-CPpgdabc.js" as="script"><link rel="prefetch" href="/interview/assets/404.html-CFQer1IF.js" as="script"><link rel="prefetch" href="/interview/assets/index.html-DQbAKE0j.js" as="script"><link rel="prefetch" href="/interview/assets/index.html-8-0zyY5O.js" as="script"><link rel="prefetch" href="/interview/assets/index.html-CGYRH0yE.js" as="script"><link rel="prefetch" href="/interview/assets/index.html-C5WfKaE-.js" as="script"><link rel="prefetch" href="/interview/assets/index.html-D65osGmo.js" as="script"><link rel="prefetch" href="/interview/assets/index.html-CfiUAL_G.js" as="script"><link rel="prefetch" href="/interview/assets/index.html-BCTXjdZB.js" as="script"><link rel="prefetch" href="/interview/assets/index.html-rraEFpoW.js" as="script"><link rel="prefetch" href="/interview/assets/index.html-P-TGELmW.js" as="script"><link rel="prefetch" href="/interview/assets/index.html-CRsgchvL.js" as="script"><link rel="prefetch" href="/interview/assets/index.html-UU5VwC6P.js" as="script"><link rel="prefetch" href="/interview/assets/index.html-DCwk4HQ1.js" as="script"><link rel="prefetch" href="/interview/assets/index.html-KF7IW-FN.js" as="script"><link rel="prefetch" href="/interview/assets/index.html-C1xzTdKX.js" as="script"><link rel="prefetch" href="/interview/assets/index.html-CBAxwyJ1.js" as="script"><link rel="prefetch" href="/interview/assets/index.html-C2PyANp6.js" as="script"><link rel="prefetch" href="/interview/assets/index.html-Cu_kViiY.js" as="script"><link rel="prefetch" href="/interview/assets/index.html-BssOJtCz.js" as="script"><link rel="prefetch" href="/interview/assets/index.html-U_bt07qU.js" as="script"><link rel="prefetch" href="/interview/assets/index.html-CzK1Vqbh.js" as="script"><link rel="prefetch" href="/interview/assets/index.html-BkbeKNZI.js" as="script"><link rel="prefetch" href="/interview/assets/index.html-CUOPoDob.js" as="script"><link rel="prefetch" href="/interview/assets/index.html-K5UwwzbP.js" as="script"><link rel="prefetch" href="/interview/assets/index.html-Bs2zaXox.js" as="script"><link rel="prefetch" href="/interview/assets/index.html-CsvWef51.js" as="script"><link rel="prefetch" href="/interview/assets/index.html-DyuqDubV.js" as="script"><link rel="prefetch" href="/interview/assets/index.html-DIvSenJG.js" as="script"><link rel="prefetch" href="/interview/assets/index.html-IvmJEvzF.js" as="script"><link rel="prefetch" href="/interview/assets/index.html-D1WA3f1G.js" as="script"><link rel="prefetch" href="/interview/assets/index.html-zSPdFpwa.js" as="script"><link rel="prefetch" href="/interview/assets/index.html-BS5P5xDy.js" as="script"><link rel="prefetch" href="/interview/assets/index.html-D2jaC6HQ.js" as="script"><link rel="prefetch" href="/interview/assets/index.html-B6il___P.js" as="script"><link rel="prefetch" href="/interview/assets/index.html-CccO4UDj.js" as="script"><link rel="prefetch" href="/interview/assets/photoswipe.esm-DXWKOczD.js" as="script"><link rel="prefetch" href="/interview/assets/SearchResult-CZ-_YXIO.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="vp-skip-link sr-only">è·³è‡³ä¸»è¦å…§å®¹</a><!--]--><div class="theme-container no-sidebar external-link-icon has-toc" vp-container><!--[--><header id="navbar" class="vp-navbar" vp-navbar><div class="vp-navbar-start"><button type="button" class="vp-toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!--[--><a class="route-link vp-brand" href="/interview/" aria-label="å¸¦æˆ‘å›å®¶"><img class="vp-nav-logo" src="/interview/assets/images/lmxxf.png" alt><!----><span class="vp-site-name hide-in-pad">è€é©¬å•¸è¥¿é£</span></a><!--]--></div><div class="vp-navbar-center"><!--[--><nav class="vp-nav-links"><div class="vp-nav-item hide-in-mobile"><a class="route-link route-link-active auto-link" href="/interview/posts/" aria-label="å…¨éƒ¨æ–‡ç« " iconsizing="height"><!--[--><iconify-icon class="vp-icon" icon="fa6-solid:pen-to-square" height="1em" sizing="height"></iconify-icon><!--]-->å…¨éƒ¨æ–‡ç« <!----></a></div></nav><!--]--></div><div class="vp-navbar-end"><!--[--><!----><div class="vp-nav-item vp-action"><a class="vp-action-link" href="https://github.com/houbb/vpress" target="_blank" rel="noopener noreferrer" aria-label="GitHub"><svg xmlns="http://www.w3.org/2000/svg" class="icon github-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="github icon" name="github" style="width:1.25rem;height:1.25rem;vertical-align:middle;"><path d="M511.957 21.333C241.024 21.333 21.333 240.981 21.333 512c0 216.832 140.544 400.725 335.574 465.664 24.49 4.395 32.256-10.07 32.256-23.083 0-11.69.256-44.245 0-85.205-136.448 29.61-164.736-64.64-164.736-64.64-22.315-56.704-54.4-71.765-54.4-71.765-44.587-30.464 3.285-29.824 3.285-29.824 49.195 3.413 75.179 50.517 75.179 50.517 43.776 75.008 114.816 53.333 142.762 40.79 4.523-31.66 17.152-53.377 31.19-65.537-108.971-12.458-223.488-54.485-223.488-242.602 0-53.547 19.114-97.323 50.517-131.67-5.035-12.33-21.93-62.293 4.779-129.834 0 0 41.258-13.184 134.912 50.346a469.803 469.803 0 0 1 122.88-16.554c41.642.213 83.626 5.632 122.88 16.554 93.653-63.488 134.784-50.346 134.784-50.346 26.752 67.541 9.898 117.504 4.864 129.834 31.402 34.347 50.474 78.123 50.474 131.67 0 188.586-114.73 230.016-224.042 242.09 17.578 15.232 33.578 44.672 33.578 90.454v135.85c0 13.142 7.936 27.606 32.854 22.87C862.25 912.597 1002.667 728.747 1002.667 512c0-271.019-219.648-490.667-490.71-490.667z"></path></svg></a></div><div class="vp-nav-item hide-in-mobile"><button type="button" class="vp-color-mode-switch" id="color-mode-switch"><svg xmlns="http://www.w3.org/2000/svg" class="icon auto-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="auto icon" name="auto" style="display:block;"><path d="M512 992C246.92 992 32 777.08 32 512S246.92 32 512 32s480 214.92 480 480-214.92 480-480 480zm0-840c-198.78 0-360 161.22-360 360 0 198.84 161.22 360 360 360s360-161.16 360-360c0-198.78-161.22-360-360-360zm0 660V212c165.72 0 300 134.34 300 300 0 165.72-134.28 300-300 300z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon dark-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="dark icon" name="dark" style="display:none;"><path d="M524.8 938.667h-4.267a439.893 439.893 0 0 1-313.173-134.4 446.293 446.293 0 0 1-11.093-597.334A432.213 432.213 0 0 1 366.933 90.027a42.667 42.667 0 0 1 45.227 9.386 42.667 42.667 0 0 1 10.24 42.667 358.4 358.4 0 0 0 82.773 375.893 361.387 361.387 0 0 0 376.747 82.774 42.667 42.667 0 0 1 54.187 55.04 433.493 433.493 0 0 1-99.84 154.88 438.613 438.613 0 0 1-311.467 128z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon light-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="light icon" name="light" style="display:none;"><path d="M952 552h-80a40 40 0 0 1 0-80h80a40 40 0 0 1 0 80zM801.88 280.08a41 41 0 0 1-57.96-57.96l57.96-58a41.04 41.04 0 0 1 58 58l-58 57.96zM512 752a240 240 0 1 1 0-480 240 240 0 0 1 0 480zm0-560a40 40 0 0 1-40-40V72a40 40 0 0 1 80 0v80a40 40 0 0 1-40 40zm-289.88 88.08-58-57.96a41.04 41.04 0 0 1 58-58l57.96 58a41 41 0 0 1-57.96 57.96zM192 512a40 40 0 0 1-40 40H72a40 40 0 0 1 0-80h80a40 40 0 0 1 40 40zm30.12 231.92a41 41 0 0 1 57.96 57.96l-57.96 58a41.04 41.04 0 0 1-58-58l58-57.96zM512 832a40 40 0 0 1 40 40v80a40 40 0 0 1-80 0v-80a40 40 0 0 1 40-40zm289.88-88.08 58 57.96a41.04 41.04 0 0 1-58 58l-57.96-58a41 41 0 0 1 57.96-57.96z"></path></svg></button></div><!--[--><button type="button" class="slimsearch-button" aria-label="æœç´¢"><svg xmlns="http://www.w3.org/2000/svg" class="icon search-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="search icon"><path d="M192 480a256 256 0 1 1 512 0 256 256 0 0 1-512 0m631.776 362.496-143.2-143.168A318.464 318.464 0 0 0 768 480c0-176.736-143.264-320-320-320S128 303.264 128 480s143.264 320 320 320a318.016 318.016 0 0 0 184.16-58.592l146.336 146.368c12.512 12.48 32.768 12.48 45.28 0 12.48-12.512 12.48-32.768 0-45.28"></path></svg><div class="slimsearch-placeholder">æœç´¢</div><div class="slimsearch-key-hints"><kbd class="slimsearch-key">Ctrl</kbd><kbd class="slimsearch-key">K</kbd></div></button><!--]--><!--]--><button type="button" class="vp-toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span><span class="vp-top"></span><span class="vp-middle"></span><span class="vp-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow start"></span></div><aside id="sidebar" class="vp-sidebar" vp-sidebar><!----><ul class="vp-sidebar-links"></ul><!----></aside><!--[--><main id="main-content" class="vp-page"><!--[--><!----><!----><nav class="vp-breadcrumb disable"></nav><div class="vp-page-title"><h1><!---->ç¬¬åå››ç¯‡ï¼šKafka ï¼åˆ†åŒºã€å‰¯æœ¬ã€æ¶ˆè´¹ç»„ã€é«˜å¯é æ€§</h1><div class="page-info"><span class="page-author-info" aria-label="ä½œè€…ğŸ–Š" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon author-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="author icon" name="author"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z"></path></svg><span><a class="page-author-item" href="https://houbb.github.io" target="_blank" rel="noopener noreferrer">è€é©¬å•¸è¥¿é£</a></span><span property="author" content="è€é©¬å•¸è¥¿é£"></span></span><!----><span class="page-date-info" aria-label="å†™ä½œæ—¥æœŸğŸ“…" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="calendar icon" name="calendar"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 01-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 01-33.473-33.473V143.657H180.6A134.314 134.314 0 0046.66 277.595v535.756A134.314 134.314 0 00180.6 947.289h669.74a134.36 134.36 0 00133.94-133.938V277.595a134.314 134.314 0 00-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 01-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 01-33.472 33.473z"></path></svg><span data-allow-mismatch="text">2025å¹´8æœˆ16æ—¥</span><meta property="datePublished" content="2025-08-16T11:28:53.000Z"></span><!----><span class="page-reading-time-info" aria-label="é˜…è¯»æ—¶é—´âŒ›" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="timer icon" name="timer"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></svg><span>å¤§çº¦ 39 åˆ†é’Ÿ</span><meta property="timeRequired" content="PT39M"></span><!----><!----></div><hr></div><!----><div class="" vp-content><!----><div id="markdown-content"><h1 id="kafka-é‚£ç‚¹ç ´äº‹-åˆ†åŒºã€å‰¯æœ¬ã€æ¶ˆè´¹ç»„ã€é«˜å¯é æ€§" tabindex="-1"><a class="header-anchor" href="#kafka-é‚£ç‚¹ç ´äº‹-åˆ†åŒºã€å‰¯æœ¬ã€æ¶ˆè´¹ç»„ã€é«˜å¯é æ€§"><span>Kafka é‚£ç‚¹ç ´äº‹ï¼åˆ†åŒºã€å‰¯æœ¬ã€æ¶ˆè´¹ç»„ã€é«˜å¯é æ€§</span></a></h1><blockquote><p>ä½œè€…ï¼šè€é©¬<br><br>å…¬ä¼—å·ï¼šè€é©¬å•¸è¥¿é£<br><br> åšå®¢ï¼š<a href="https://houbb.github.io/" target="_blank" rel="noopener noreferrer">https://houbb.github.io/</a><br><br> äººç”Ÿç†å¿µï¼šçŸ¥é“çš„è¶Šå¤šï¼Œä¸çŸ¥é“çš„è¶Šå¤šï¼ŒåŠªåŠ›å»å­¦</p></blockquote><h2 id="kafka-æ˜¯ä»€ä¹ˆ" tabindex="-1"><a class="header-anchor" href="#kafka-æ˜¯ä»€ä¹ˆ"><span><strong>Kafka æ˜¯ä»€ä¹ˆï¼Ÿ</strong></span></a></h2><p>ç­”æ¡ˆï¼š<br>Kafka æ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼çš„æµå¼å¤„ç†å¹³å°ï¼Œå®ƒä»¥é«˜ååã€å¯æŒä¹…åŒ–ã€å¯æ°´å¹³æ‰©å±•ã€æ”¯æŒæµæ•°æ®å¤„ç†ç­‰å¤šç§ç‰¹æ€§è€Œè¢«å¹¿æ³›ä½¿ç”¨<br><img src="https://cdn.nlark.com/yuque/0/2022/png/21503536/1666966942521-1e262f78-d331-4349-9e0c-45714524ad8a.png#clientId=ua41a3794-5c73-4&amp;from=paste&amp;height=209&amp;id=ua0ed81c5&amp;originHeight=459&amp;originWidth=1080&amp;originalType=url&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;status=done&amp;style=none&amp;taskId=u4e87f618-00df-4e04-a78f-3ad31d2f9ca&amp;title=&amp;width=491" alt="" loading="lazy"><br>ä¸»è¦åŠŸèƒ½ä½“ç°äºä¸‰ç‚¹ï¼š</p><ul><li><strong>æ¶ˆæ¯ç³»ç»Ÿ</strong>ï¼škafkaä¸ä¼ ç»Ÿçš„æ¶ˆæ¯ä¸­é—´ä»¶éƒ½å…·å¤‡<strong>ç³»ç»Ÿè§£è€¦ã€å†—ä½™å­˜å‚¨ã€æµé‡å‰Šå³°ã€ç¼“å†²ã€å¼‚æ­¥é€šä¿¡ã€æ‰©å±•æ€§ã€å¯æ¢å¤æ€§</strong>ç­‰åŠŸèƒ½ã€‚ä¸æ­¤åŒæ—¶ï¼Œkafkaè¿˜æä¾›äº†å¤§å¤šæ•°æ¶ˆæ¯ç³»ç»Ÿéš¾ä»¥å®ç°çš„æ¶ˆæ¯é¡ºåºæ€§ä¿éšœåŠå›æº¯æ€§æ¶ˆè´¹çš„åŠŸèƒ½ã€‚</li><li><strong>å­˜å‚¨ç³»ç»Ÿ</strong>ï¼škafkaæŠŠ<strong>æ¶ˆæ¯æŒä¹…åŒ–åˆ°ç£ç›˜</strong>ï¼Œç›¸æ¯”äºå…¶ä»–åŸºäºå†…å­˜å­˜å‚¨çš„ç³»ç»Ÿè€Œè¨€ï¼Œæœ‰æ•ˆçš„é™ä½äº†æ¶ˆæ¯ä¸¢å¤±çš„é£é™©ã€‚è¿™å¾—ç›Šäºå…¶æ¶ˆæ¯æŒä¹…åŒ–å’Œå¤šå‰¯æœ¬æœºåˆ¶ã€‚ä¹Ÿå¯ä»¥å°†kafkaä½œä¸ºé•¿æœŸçš„å­˜å‚¨ç³»ç»Ÿæ¥ä½¿ç”¨ï¼Œåªéœ€è¦æŠŠå¯¹åº”çš„æ•°æ®ä¿ç•™ç­–ç•¥è®¾ç½®ä¸ºâ€œæ°¸ä¹…â€æˆ–å¯ç”¨ä¸»é¢˜æ—¥å¿—å‹ç¼©åŠŸèƒ½ã€‚</li><li><strong>æµå¼å¤„ç†å¹³å°</strong>ï¼škafkaä¸ºæµè¡Œçš„æµå¼å¤„ç†æ¡†æ¶æä¾›äº†å¯é çš„æ•°æ®æ¥æºï¼Œè¿˜æä¾›äº†ä¸€ä¸ªå®Œæ•´çš„æµå¼å¤„ç†æ¡†æ¶ï¼Œæ¯”å¦‚çª—å£ã€è¿æ¥ã€å˜æ¢å’Œèšåˆç­‰å„ç±»æ“ä½œã€‚</li></ul><h2 id="kafka-æ ¸å¿ƒæ¶æ„" tabindex="-1"><a class="header-anchor" href="#kafka-æ ¸å¿ƒæ¶æ„"><span><strong>Kafka æ ¸å¿ƒæ¶æ„ï¼Ÿ</strong><br><br></span></a></h2><p>ç­”æ¡ˆï¼š<br>ä¸€ä¸ªå…¸å‹çš„ kafka ä½“ç³»æ¶æ„åŒ…æ‹¬è‹¥å¹² <strong>Producer</strong>ã€è‹¥å¹² <strong>Consumer</strong>ã€ä»¥åŠä¸€ä¸ª <strong>Zookeeper</strong> é›†ç¾¤ï¼ˆåœ¨2.8.0ç‰ˆæœ¬ä¸­ç§»ï¼Œé™¤äº† Zookeeperï¼Œé€šè¿‡ <strong>KRaft</strong> è¿›è¡Œè‡ªå·±çš„é›†ç¾¤ç®¡ç†ï¼‰<br>Producer å°†æ¶ˆæ¯å‘é€åˆ° Brokerï¼ŒBroker è´Ÿè´£å°†å—åˆ°çš„æ¶ˆæ¯å­˜å‚¨åˆ°ç£ç›˜ä¸­ï¼Œè€Œ Consumer è´Ÿè´£ä» Broker è®¢é˜…å¹¶æ¶ˆè´¹æ¶ˆæ¯ã€‚<br><img src="https://cdn.nlark.com/yuque/0/2022/png/21503536/1666966942546-3b9a01af-9570-429e-8c6a-bc2a26148816.png#clientId=ua41a3794-5c73-4&amp;from=paste&amp;height=363&amp;id=u1ac1f286&amp;originHeight=658&amp;originWidth=1080&amp;originalType=url&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;status=done&amp;style=none&amp;taskId=ue64094f7-fef5-4b48-9016-7218229abd2&amp;title=&amp;width=595" alt="" loading="lazy"></p><p><strong>Kafka åè¯æœ¯è¯­ï¼Œä¸€ç½‘æ‰“å°½ï¼š</strong></p><ul><li><strong>Producer</strong> ï¼šç”Ÿäº§è€…ï¼Œè´Ÿè´£å°†æ¶ˆæ¯å‘é€åˆ° Broker</li><li><strong>Consumer</strong> ï¼šæ¶ˆè´¹è€…ï¼Œä» Broker æ¥æ”¶æ¶ˆæ¯</li><li><strong>Consumer Group</strong> ï¼šæ¶ˆè´¹è€…ç»„ï¼Œç”±<strong>å¤šä¸ª Consumer ç»„æˆ</strong>ã€‚æ¶ˆè´¹è€…ç»„å†…æ¯ä¸ªæ¶ˆè´¹è€…è´Ÿè´£æ¶ˆè´¹ä¸åŒåˆ†åŒºçš„æ•°æ®ï¼Œ<strong>ä¸€ä¸ªåˆ†åŒºåªèƒ½ç”±ä¸€ä¸ªç»„å†…æ¶ˆè´¹è€…æ¶ˆè´¹</strong>ï¼›æ¶ˆè´¹è€…ç»„ä¹‹é—´äº’ä¸å½±å“ã€‚æ‰€æœ‰çš„æ¶ˆè´¹è€…éƒ½å±äºæŸä¸ªæ¶ˆè´¹è€…ç»„ï¼Œå³æ¶ˆè´¹è€…ç»„æ˜¯é€»è¾‘ä¸Šçš„ä¸€ä¸ªè®¢é˜…è€…ã€‚</li><li><strong>æ¶ˆè´¹è€…ä½ç§»</strong>ï¼šConsumer Offsetã€‚è¡¨ç¤ºæ¶ˆè´¹è€…æ¶ˆè´¹è¿›åº¦ï¼Œæ¯ä¸ªæ¶ˆè´¹è€…éƒ½æœ‰è‡ªå·±çš„æ¶ˆè´¹è€…ä½ç§»ã€‚offsetä¿å­˜åœ¨brokerç«¯çš„å†…éƒ¨topicä¸­ï¼Œä¸æ˜¯åœ¨clientsä¸­ä¿å­˜</li><li><strong>Broker</strong> ï¼šå¯ä»¥çœ‹åšä¸€ä¸ªç‹¬ç«‹çš„ <strong>Kafka æœåŠ¡èŠ‚ç‚¹æˆ– Kafka æœåŠ¡å®ä¾‹</strong>ã€‚å¦‚æœä¸€å°æœåŠ¡å™¨ä¸Šåªéƒ¨ç½²äº†ä¸€ä¸ª Kafka å®ä¾‹ï¼Œé‚£ä¹ˆæˆ‘ä»¬ä¹Ÿå¯ä»¥å°† Broker çœ‹åšä¸€å° Kafka æœåŠ¡å™¨ã€‚</li><li><strong>Topic</strong> ï¼šä¸€ä¸ªé€»è¾‘ä¸Šçš„æ¦‚å¿µï¼ŒåŒ…å«å¾ˆå¤š Partitionï¼Œ<strong>åŒä¸€ä¸ª Topic ä¸‹çš„ Partiton çš„æ¶ˆæ¯å†…å®¹æ˜¯ä¸ç›¸åŒçš„</strong>ã€‚</li><li><strong>Partition</strong> ï¼šä¸ºäº†å®ç°æ‰©å±•æ€§ï¼Œä¸€ä¸ªéå¸¸å¤§çš„ topic <strong>å¯ä»¥åˆ†å¸ƒåˆ°å¤šä¸ª broker ä¸Šï¼Œä¸€ä¸ª topic å¯ä»¥åˆ†ä¸ºå¤šä¸ª partition</strong>ï¼Œæ¯ä¸ª partition æ˜¯ä¸€ä¸ªæœ‰åºçš„é˜Ÿåˆ—ã€‚</li><li><strong>æ¶ˆæ¯</strong>ï¼šè¿™é‡Œçš„æ¶ˆæ¯å°±æ˜¯æŒ‡ Kafka å¤„ç†çš„ä¸»è¦å¯¹è±¡ã€‚</li><li><strong>æ¶ˆæ¯ä½ç§»</strong>ï¼šOffsetã€‚è¡¨ç¤ºåˆ†åŒºä¸­æ¯æ¡æ¶ˆæ¯çš„ä½ç½®ä¿¡æ¯ï¼Œæ˜¯ä¸€ä¸ªå•è°ƒé€’å¢ä¸”ä¸å˜çš„å€¼ã€‚</li><li><strong>Replica</strong> ï¼šå‰¯æœ¬ï¼Œ<strong>åŒä¸€åˆ†åŒºçš„ä¸åŒå‰¯æœ¬ä¿å­˜çš„æ˜¯ç›¸åŒçš„æ¶ˆæ¯</strong>ï¼Œä¸ºä¿è¯é›†ç¾¤ä¸­çš„æŸä¸ªèŠ‚ç‚¹å‘ç”Ÿæ•…éšœæ—¶ï¼Œè¯¥èŠ‚ç‚¹ä¸Šçš„ partition æ•°æ®ä¸ä¸¢å¤±ï¼Œä¸” kafka ä»ç„¶èƒ½å¤Ÿç»§ç»­å·¥ä½œï¼Œkafka æä¾›äº†å‰¯æœ¬æœºåˆ¶ï¼Œä¸€ä¸ª topic çš„æ¯ä¸ªåˆ†åŒºéƒ½æœ‰è‹¥å¹²ä¸ªå‰¯æœ¬ï¼Œä¸€ä¸ª leader å’Œè‹¥å¹²ä¸ª followerã€‚</li><li><strong>Leader</strong> ï¼šæ¯ä¸ªåˆ†åŒºçš„å¤šä¸ªå‰¯æœ¬ä¸­çš„&quot;ä¸»å‰¯æœ¬&quot;ï¼Œ<strong>ç”Ÿäº§è€…ä»¥åŠæ¶ˆè´¹è€…åªä¸ Leader äº¤äº’</strong>ã€‚</li><li><strong>Follower</strong> ï¼šæ¯ä¸ªåˆ†åŒºçš„å¤šä¸ªå‰¯æœ¬ä¸­çš„&quot;ä»å‰¯æœ¬&quot;ï¼Œ<strong>è´Ÿè´£å®æ—¶ä» Leader ä¸­åŒæ­¥æ•°æ®ï¼Œä¿æŒå’Œ Leader æ•°æ®çš„åŒæ­¥</strong>ã€‚Leader å‘ç”Ÿæ•…éšœæ—¶ï¼Œä» Follower å‰¯æœ¬ä¸­é‡æ–°é€‰ä¸¾æ–°çš„ Leader å‰¯æœ¬å¯¹å¤–æä¾›æœåŠ¡ã€‚</li><li><strong>é‡å¹³è¡¡</strong>ï¼šRebalanceã€‚æ¶ˆè´¹è€…ç»„å†…æŸä¸ªæ¶ˆè´¹è€…å®ä¾‹æŒ‚æ‰åï¼Œå…¶ä»–æ¶ˆè´¹è€…å®ä¾‹è‡ªåŠ¨é‡æ–°åˆ†é…è®¢é˜…ä¸»é¢˜åˆ†åŒº</li></ul><h2 id="å¦‚ä½•ä¿è¯é«˜å¯ç”¨" tabindex="-1"><a class="header-anchor" href="#å¦‚ä½•ä¿è¯é«˜å¯ç”¨"><span>å¦‚ä½•ä¿è¯é«˜å¯ç”¨ï¼Ÿ<br><br></span></a></h2><p>ç­”æ¡ˆï¼š<br>åœ¨ Kafka 0.8 ä»¥åï¼Œæä¾›äº† HA æœºåˆ¶ï¼Œå°±æ˜¯ replica å‰¯æœ¬æœºåˆ¶ã€‚æ¯ä¸ª partition ä¸Šçš„æ•°æ®éƒ½ä¼šåŒæ­¥åˆ°å…¶å®ƒæœºå™¨ï¼Œå½¢æˆè‡ªå·±çš„å¤šä¸ª replica å‰¯æœ¬ã€‚æ‰€æœ‰ replica ä¼šé€‰ä¸¾ä¸€ä¸ª leader å‡ºæ¥ï¼Œæ¶ˆæ¯çš„ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…éƒ½è·Ÿè¿™ä¸ª leader æ‰“äº¤é“ï¼Œå…¶ä»– replica ä½œä¸º follower ã€‚å†™çš„æ—¶å€™ï¼Œ leader ä¼šè´Ÿè´£æŠŠæ•°æ®åŒæ­¥åˆ°æ‰€æœ‰ follower ä¸Šå»ï¼Œè¯»çš„æ—¶å€™å°±ç›´æ¥è¯» leader ä¸Šçš„æ•°æ®å³å¯ã€‚ Kafka è´Ÿè´£å‡åŒ€çš„å°†ä¸€ä¸ª partition çš„æ‰€æœ‰ replica åˆ†å¸ƒåœ¨ä¸åŒçš„æœºå™¨ä¸Šï¼Œè¿™æ ·æ‰å¯ä»¥æé«˜å®¹é”™æ€§ã€‚<br>æ‹¥æœ‰äº† replica å‰¯æœ¬æœºåˆ¶ï¼Œå¦‚æœæŸä¸ª broker å®•æœºäº†ï¼Œè¿™ä¸ª broker ä¸Šçš„ partition åœ¨å…¶ä»–æœºå™¨ä¸Šè¿˜å­˜åœ¨å‰¯æœ¬ã€‚å¦‚æœè¿™ä¸ªå®•æœºçš„ broker ä¸Šé¢æœ‰æŸä¸ª partition çš„ leader ï¼Œé‚£ä¹ˆæ­¤æ—¶ä¼šä»å…¶follower ä¸­é‡æ–°é€‰ä¸¾ä¸€ä¸ªæ–°çš„ leader å‡ºæ¥ï¼Œç”±è¿™ä¸ªæ–° leader ç»§ç»­æä¾›è¯»å†™æœåŠ¡ï¼Œä»è€Œè¾¾åˆ°äº†æ‰€è°“çš„é«˜å¯ç”¨æ€§ã€‚ <br><img src="https://cdn.nlark.com/yuque/0/2022/png/21503536/1666966942538-22430d80-14e5-4bcb-affe-e151d06f9332.png#clientId=ua41a3794-5c73-4&amp;from=paste&amp;height=337&amp;id=u784d93ba&amp;originHeight=660&amp;originWidth=1286&amp;originalType=url&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;status=done&amp;style=none&amp;taskId=u5ff74075-b1e7-4af2-9368-08600d40f1f&amp;title=&amp;width=656" alt="" loading="lazy"></p><p>å†™æ•°æ®çš„æ—¶å€™ï¼Œç”Ÿäº§è€…åªå°†æ•°æ®å†™å…¥ leader èŠ‚ç‚¹ï¼Œ leader ä¼šå°†æ•°æ®å†™å…¥æœ¬åœ°ç£ç›˜ï¼Œæ¥ç€å…¶ä»–follower ä¼šä¸»åŠ¨ä» leader æ¥æ‹‰å–æ•°æ®ï¼Œ follower åŒæ­¥å¥½æ•°æ®äº†ï¼Œå°±ä¼šå‘é€ ack ç»™ leader ï¼Œleader æ”¶åˆ°æ‰€æœ‰ follower çš„ ack ä¹‹åï¼Œå°±ä¼šè¿”å›å†™æˆåŠŸçš„æ¶ˆæ¯ç»™ç”Ÿäº§è€…ã€‚</p><p>æ¶ˆè´¹æ•°æ®çš„æ—¶å€™ï¼Œæ¶ˆè´¹è€…åªä¼šä» leader èŠ‚ç‚¹å»è¯»å–æ¶ˆæ¯ï¼Œä½†æ˜¯åªæœ‰å½“ä¸€ä¸ªæ¶ˆæ¯å·²ç»è¢«æ‰€æœ‰ followeréƒ½åŒæ­¥æˆåŠŸè¿”å› ack çš„æ—¶å€™ï¼Œè¿™ä¸ªæ¶ˆæ¯æ‰ä¼šè¢«æ¶ˆè´¹è€…è¯»åˆ°ã€‚</p><h2 id="kafka-ä¸ºä»€ä¹ˆè¿™ä¹ˆå¿«" tabindex="-1"><a class="header-anchor" href="#kafka-ä¸ºä»€ä¹ˆè¿™ä¹ˆå¿«"><span><strong>Kafka ä¸ºä»€ä¹ˆè¿™ä¹ˆå¿«ï¼Ÿ</strong></span></a></h2><p>ç­”æ¡ˆï¼š<br><strong>1ã€é¡ºåºè¯»å†™</strong> <br>ç£ç›˜åˆ†ä¸ºé¡ºåºè¯»å†™ä¸éšæœºè¯»å†™ï¼ŒåŸºäºç£ç›˜çš„éšæœºè¯»å†™ç¡®å®å¾ˆæ…¢ï¼Œä½†ç£ç›˜çš„é¡ºåºè¯»å†™æ€§èƒ½å´å¾ˆé«˜ï¼Œkafka é‡‡ç”¨çš„å°±æ˜¯é¡ºåºè¯»å†™ã€‚<br><strong>2ã€Page Cache</strong> <br>ä¸ºäº†ä¼˜åŒ–è¯»å†™æ€§èƒ½ï¼ŒKafka åˆ©ç”¨äº†æ“ä½œ<strong>ç³»ç»Ÿæœ¬èº«çš„ Page Cache</strong>ï¼Œå°±æ˜¯åˆ©ç”¨æ“ä½œç³»ç»Ÿè‡ªèº«çš„å†…å­˜è€Œä¸æ˜¯JVMç©ºé—´å†…å­˜ã€‚<br><strong>3ã€é›¶æ‹·è´</strong> <br>Kafkaä½¿ç”¨äº†é›¶æ‹·è´æŠ€æœ¯ï¼Œä¹Ÿå°±æ˜¯<strong>ç›´æ¥å°†æ•°æ®ä»å†…æ ¸ç©ºé—´çš„è¯»ç¼“å†²åŒºç›´æ¥æ‹·è´åˆ°å†…æ ¸ç©ºé—´çš„ socket ç¼“å†²åŒº</strong>ï¼Œç„¶åå†å†™å…¥åˆ° NIC ç¼“å†²åŒºï¼Œé¿å…äº†åœ¨å†…æ ¸ç©ºé—´å’Œç”¨æˆ·ç©ºé—´ä¹‹é—´ç©¿æ¢­ã€‚<br><strong>4ã€åˆ†åŒºåˆ†æ®µ+ç´¢å¼•</strong> <br>Kafka çš„ message æ˜¯æŒ‰ topicåˆ† ç±»å­˜å‚¨çš„ï¼Œtopic ä¸­çš„æ•°æ®åˆæ˜¯æŒ‰ç…§ä¸€ä¸ªä¸€ä¸ªçš„ partition å³åˆ†åŒºå­˜å‚¨åˆ°ä¸åŒ broker èŠ‚ç‚¹ã€‚æ¯ä¸ª partition å¯¹åº”äº†æ“ä½œç³»ç»Ÿä¸Šçš„ä¸€ä¸ªæ–‡ä»¶å¤¹ï¼Œpartition å®é™…ä¸Šåˆæ˜¯æŒ‰ç…§segmentåˆ†æ®µå­˜å‚¨çš„ã€‚<br>é€šè¿‡è¿™ç§åˆ†åŒºåˆ†æ®µçš„è®¾è®¡ï¼ŒKafka çš„ message æ¶ˆæ¯å®é™…ä¸Šæ˜¯åˆ†å¸ƒå¼å­˜å‚¨åœ¨ä¸€ä¸ªä¸€ä¸ªå°çš„ segment ä¸­çš„ï¼Œæ¯æ¬¡æ–‡ä»¶æ“ä½œä¹Ÿæ˜¯ç›´æ¥æ“ä½œçš„ segmentã€‚ä¸ºäº†è¿›ä¸€æ­¥çš„æŸ¥è¯¢ä¼˜åŒ–ï¼ŒKafka åˆé»˜è®¤ä¸ºåˆ†æ®µåçš„æ•°æ®æ–‡ä»¶å»ºç«‹äº†ç´¢å¼•æ–‡ä»¶ï¼Œå°±æ˜¯æ–‡ä»¶ç³»ç»Ÿä¸Šçš„.indexæ–‡ä»¶ã€‚è¿™ç§åˆ†åŒºåˆ†æ®µ+ç´¢å¼•çš„è®¾è®¡ï¼Œä¸ä»…æå‡äº†æ•°æ®è¯»å–çš„æ•ˆç‡ï¼ŒåŒæ—¶ä¹Ÿæé«˜äº†æ•°æ®æ“ä½œçš„å¹¶è¡Œåº¦ã€‚<br><strong>5ã€æ‰¹é‡è¯»å†™</strong> <br>Kafka <strong>æ•°æ®è¯»å†™ä¹Ÿæ˜¯æ‰¹é‡çš„è€Œä¸æ˜¯å•æ¡ï¼Œ<strong>è¿™æ ·å¯ä»¥é¿å…åœ¨ç½‘ç»œä¸Šé¢‘ç¹ä¼ è¾“å•ä¸ªæ¶ˆæ¯å¸¦æ¥çš„å»¶è¿Ÿå’Œå¸¦å®½å¼€é”€ã€‚å‡è®¾ç½‘ç»œå¸¦å®½ä¸º 10MB/Sï¼Œä¸€æ¬¡æ€§ä¼ è¾“ 10MB æ¶ˆæ¯æ¯”ä¼ è¾“1KBçš„æ¶ˆæ¯ 1ä¸‡æ¬¡æ˜¾ç„¶è¦å¿«å¾—å¤šã€‚<br><strong>6ã€æ‰¹é‡å‹ç¼©</strong> <br>Kafka æŠŠæ‰€æœ‰çš„æ¶ˆæ¯éƒ½å˜æˆä¸€ä¸ª</strong>æ‰¹é‡çš„æ–‡ä»¶</strong>ï¼Œå¹¶ä¸”è¿›è¡Œåˆç†çš„<strong>æ‰¹é‡å‹ç¼©</strong>ï¼Œå‡å°‘ç½‘ç»œ IO æŸè€—ï¼Œé€šè¿‡ mmap æé«˜ I/O é€Ÿåº¦ï¼Œå†™å…¥æ•°æ®çš„æ—¶å€™ç”±äºå•ä¸ªPartionæ˜¯æœ«å°¾æ·»åŠ æ‰€ä»¥é€Ÿåº¦æœ€ä¼˜ï¼›è¯»å–æ•°æ®çš„æ—¶å€™é…åˆ sendfile è¿›è¡Œç›´æ¥è¯»å–ã€‚</p><h2 id="isrã€arä»£è¡¨ä»€ä¹ˆ" tabindex="-1"><a class="header-anchor" href="#isrã€arä»£è¡¨ä»€ä¹ˆ"><span>ISRã€ARä»£è¡¨ä»€ä¹ˆï¼Ÿ</span></a></h2><p>ç­”æ¡ˆ<br><img src="https://cdn.nlark.com/yuque/0/2022/png/21503536/1666966942543-ac16f79c-ece0-4c08-9e31-21569255f13e.png#clientId=ua41a3794-5c73-4&amp;from=paste&amp;height=188&amp;id=u40aef77f&amp;originHeight=516&amp;originWidth=982&amp;originalType=url&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;status=done&amp;style=none&amp;taskId=u0a82dcee-d23f-41b1-898a-209da8642c2&amp;title=&amp;width=358" alt="" loading="lazy"></p><ul><li>AR: åˆ†åŒºä¸­çš„<strong>æ‰€æœ‰ Replica ç»Ÿç§°ä¸º AR</strong></li><li>ISR: æ‰€æœ‰ä¸ Leader å‰¯æœ¬<strong>ä¿æŒä¸€å®šç¨‹åº¦åŒæ­¥</strong>çš„ Replica (åŒ…æ‹¬ Leader å‰¯æœ¬åœ¨å†…) ç»„æˆ ISR</li><li>OSR: ä¸ Leader å‰¯æœ¬<strong>åŒæ­¥æ»åè¿‡å¤šçš„</strong> Replica ç»„æˆäº† OSR</li></ul><p>Leader è´Ÿè´£ç»´æŠ¤å’Œè·Ÿè¸ª ISR é›†åˆä¸­æ‰€æœ‰ Follower å‰¯æœ¬çš„æ»åçŠ¶æ€ï¼Œå½“ Follower å‰¯æœ¬è½åè¿‡å¤šæ—¶ï¼Œå°±ä¼šå°†å…¶æ”¾å…¥ OSR é›†åˆï¼Œå½“ Follower å‰¯æœ¬è¿½ä¸Šäº† Leader çš„è¿›åº¦æ—¶ï¼Œå°±ä¼šå°†å…¶æ”¾å…¥ ISR é›†åˆã€‚</p><div class="hint-container info"><p class="hint-container-title">ç›¸å…³ä¿¡æ¯</p><p>åªæœ‰ ISR ä¸­çš„å‰¯æœ¬æ‰æœ‰èµ„æ ¼æ™‹å‡ä¸º Leaderã€‚</p></div><h2 id="leader-å’Œ-follower-å‰¯æœ¬çš„åŒºåˆ«" tabindex="-1"><a class="header-anchor" href="#leader-å’Œ-follower-å‰¯æœ¬çš„åŒºåˆ«"><span>Leader å’Œ Follower å‰¯æœ¬çš„åŒºåˆ«ï¼Ÿ<br><br></span></a></h2><p>ç­”æ¡ˆï¼š<br>Kafkaå‰¯æœ¬å½“å‰åˆ†ä¸º Leader å‰¯æœ¬å’Œ Follower å‰¯æœ¬ã€‚åªæœ‰Leaderå‰¯æœ¬æ‰èƒ½å¯¹å¤–æä¾›è¯»å†™æœåŠ¡ï¼Œå“åº”Clientsç«¯çš„è¯·æ±‚ã€‚Follower å‰¯æœ¬åªæ˜¯é‡‡ç”¨æ‹‰ï¼ˆPULLï¼‰çš„æ–¹å¼ï¼Œè¢«åŠ¨åœ°åŒæ­¥Leaderå‰¯æœ¬ä¸­çš„æ•°æ®ï¼Œå¹¶ä¸”åœ¨Leaderå‰¯æœ¬æ‰€åœ¨çš„Brokerå®•æœºåï¼Œéšæ—¶å‡†å¤‡ç«é€‰Leaderå‰¯æœ¬ã€‚</p><h2 id="ç”Ÿäº§è€…å‘é€æ¶ˆæ¯æœ‰å“ªäº›æ–¹å¼" tabindex="-1"><a class="header-anchor" href="#ç”Ÿäº§è€…å‘é€æ¶ˆæ¯æœ‰å“ªäº›æ–¹å¼"><span><strong>ç”Ÿäº§è€…å‘é€æ¶ˆæ¯æœ‰å“ªäº›æ–¹å¼ï¼Ÿ</strong><br><br></span></a></h2><p>ç­”æ¡ˆï¼š</p><ol><li><strong>å‘åå³å¿˜</strong>ï¼ˆfire-and-forgetï¼‰ <ul><li>å®ƒåªç®¡å¾€ Kafka é‡Œé¢å‘é€æ¶ˆæ¯ï¼Œä½†æ˜¯<strong>ä¸å…³å¿ƒæ¶ˆæ¯æ˜¯å¦æ­£ç¡®åˆ°è¾¾</strong>ï¼Œè¿™ç§æ–¹å¼çš„æ•ˆç‡æœ€é«˜ï¼Œä½†æ˜¯å¯é æ€§ä¹Ÿæœ€å·®ï¼Œæ¯”å¦‚å½“å‘ç”ŸæŸäº›ä¸å¯å……å®å¼‚å¸¸çš„æ—¶å€™ä¼šé€ æˆæ¶ˆæ¯çš„ä¸¢å¤±</li></ul></li><li><strong>åŒæ­¥</strong>ï¼ˆsyncï¼‰ <ul><li>producer.send() è¿”å›ä¸€ä¸ªFutureå¯¹è±¡ï¼Œè°ƒç”¨get()æ–¹æ³•å˜å›è¿›è¡ŒåŒæ­¥ç­‰å¾…ï¼Œå°±çŸ¥é“æ¶ˆæ¯æ˜¯å¦å‘é€æˆåŠŸï¼Œ<strong>å‘é€ä¸€æ¡æ¶ˆæ¯éœ€è¦ç­‰ä¸Šä¸ªæ¶ˆæ¯å‘é€æˆåŠŸåæ‰å¯ä»¥ç»§ç»­å‘é€</strong></li></ul></li><li><strong>å¼‚æ­¥</strong>ï¼ˆasyncï¼‰ <ul><li>Kafkaæ”¯æŒ producer.send() ä¼ å…¥ä¸€ä¸ªå›è°ƒå‡½æ•°ï¼Œæ¶ˆæ¯ä¸ç®¡æˆåŠŸæˆ–è€…å¤±è´¥éƒ½ä¼šè°ƒç”¨è¿™ä¸ªå›è°ƒå‡½æ•°ï¼Œè¿™æ ·å°±ç®—æ˜¯å¼‚æ­¥å‘é€ï¼Œæˆ‘ä»¬ä¹ŸçŸ¥é“æ¶ˆæ¯çš„å‘é€æƒ…å†µï¼Œç„¶åå†å›è°ƒå‡½æ•°ä¸­é€‰æ‹©è®°å½•æ—¥å¿—è¿˜æ˜¯é‡è¯•éƒ½å–å†³äºè°ƒç”¨æ–¹</li></ul></li></ol><h2 id="ç”Ÿäº§è€…å‘é€æ•°æ®-ackä¸º-0-1-1-çš„å«ä¹‰" tabindex="-1"><a class="header-anchor" href="#ç”Ÿäº§è€…å‘é€æ•°æ®-ackä¸º-0-1-1-çš„å«ä¹‰"><span>ç”Ÿäº§è€…å‘é€æ•°æ®ï¼Œackä¸º 0ï¼Œ1ï¼Œ-1 çš„å«ä¹‰ï¼Ÿ</span></a></h2><p>ç­”æ¡ˆï¼š<br>è¿™ä¸ªå‚æ•°ç”¨æ¥æŒ‡å®šåˆ†åŒºä¸­æœ‰å¤šå°‘ä¸ªå‰¯æœ¬æ”¶åˆ°è¿™æ¡æ¶ˆæ¯ï¼Œç”Ÿäº§è€…æ‰è®¤ä¸ºè¿™æ¡æ¶ˆæ¯æ˜¯å†™å…¥æˆåŠŸçš„ï¼Œè¿™ä¸ªå‚æ•°æœ‰ä¸‰ä¸ªå€¼ï¼š</p><ul><li>acks = 1ï¼Œé»˜è®¤ä¸º1ã€‚ç”Ÿäº§è€…å‘é€æ¶ˆæ¯ï¼Œ<strong>åªè¦ leader å‰¯æœ¬æˆåŠŸå†™å…¥æ¶ˆæ¯ï¼Œå°±ä»£è¡¨æˆåŠŸ</strong>ã€‚è¿™ç§æ–¹æ¡ˆçš„é—®é¢˜åœ¨äºï¼Œå½“è¿”å›æˆåŠŸåï¼Œå¦‚æœ leader å‰¯æœ¬å’Œ follower å‰¯æœ¬è¿˜<strong>æ²¡æœ‰æ¥å¾—åŠåŒæ­¥</strong>ï¼Œleader å°±å´©æºƒäº†ï¼Œé‚£ä¹ˆåœ¨é€‰ä¸¾åæ–°çš„ leader å°±æ²¡æœ‰è¿™æ¡<strong>æ¶ˆæ¯ï¼Œä¹Ÿå°±ä¸¢å¤±äº†</strong>ã€‚</li><li>acks = 0ã€‚ç”Ÿäº§è€…å‘é€æ¶ˆæ¯åç›´æ¥ç®—å†™å…¥æˆåŠŸï¼Œä¸éœ€è¦ç­‰å¾…å“åº”ã€‚è¿™ä¸ªæ–¹æ¡ˆçš„é—®é¢˜å¾ˆæ˜æ˜¾ï¼Œ<strong>åªè¦æœåŠ¡ç«¯å†™æ¶ˆæ¯æ—¶å‡ºç°ä»»ä½•é—®é¢˜ï¼Œéƒ½ä¼šå¯¼è‡´æ¶ˆæ¯ä¸¢å¤±</strong>ã€‚</li><li>acks = -1 æˆ– acks = allã€‚ç”Ÿäº§è€…å‘é€æ¶ˆæ¯åï¼Œéœ€è¦ç­‰å¾… ISR ä¸­çš„æ‰€æœ‰å‰¯æœ¬éƒ½æˆåŠŸå†™å…¥æ¶ˆæ¯åæ‰èƒ½æ”¶åˆ°æœåŠ¡ç«¯çš„å“åº”ã€‚æ¯«æ— ç–‘é—®è¿™ç§æ–¹æ¡ˆçš„<strong>å¯é æ€§æ˜¯æœ€é«˜</strong>çš„ï¼Œä½†æ˜¯å¦‚æœ ISR ä¸­åªæœ‰leader å‰¯æœ¬ï¼Œé‚£ä¹ˆå°±å’Œ acks = 1 æ¯«æ— å·®åˆ«äº†ã€‚</li></ul><h2 id="producer-å‘é€æ¶ˆæ¯" tabindex="-1"><a class="header-anchor" href="#producer-å‘é€æ¶ˆæ¯"><span>Producer å‘é€æ¶ˆæ¯ï¼Ÿ</span></a></h2><p>ç­”æ¡ˆï¼š<br>Producer ä½¿ç”¨å¸¦å›è°ƒé€šçŸ¥çš„å‘é€ APIï¼Œ producer.send(msg, callback)ã€‚<br>è®¾ç½® acks = allã€‚Producer çš„ä¸€ä¸ªå‚æ•°ï¼Œè¡¨ç¤ºæ‰€æœ‰å‰¯æœ¬éƒ½æˆåŠŸæ¥æ”¶åˆ°æ¶ˆæ¯ï¼Œè¯¥æ¶ˆæ¯æ‰ç®—æ˜¯â€œå·²æäº¤â€ï¼Œæœ€é«˜ç­‰çº§ï¼Œacksçš„å…¶å®ƒå€¼è¯´æ˜ã€‚min.insync.replicas &gt; 1ï¼Œè¡¨ç¤ºæ¶ˆæ¯è‡³å°‘è¦è¢«å†™å…¥åˆ°å¤šå°‘ä¸ªå‰¯æœ¬æ‰ç®—æ˜¯â€œå·²æäº¤â€<br>retries æ˜¯ Producer çš„å‚æ•°ã€‚å½“å‡ºç°ç½‘ç»œçš„ç¬æ—¶æŠ–åŠ¨æ—¶ï¼Œæ¶ˆæ¯å‘é€å¯èƒ½ä¼šå¤±è´¥ï¼Œæ­¤æ—¶é…ç½®äº† retries &gt; 0 çš„ Producer èƒ½å¤Ÿè‡ªåŠ¨é‡è¯•æ¶ˆæ¯å‘é€ï¼Œé¿å…æ¶ˆæ¯ä¸¢å¤±ã€‚</p><h2 id="å¹‚ç­‰æ€§-producer" tabindex="-1"><a class="header-anchor" href="#å¹‚ç­‰æ€§-producer"><span>å¹‚ç­‰æ€§ Producerï¼Ÿ<br><br></span></a></h2><p>ç­”æ¡ˆï¼š<br>è®¾ç½®å‚æ•°props.put(â€œenable.idempotenceâ€, ture)ï¼ŒProducer è‡ªåŠ¨å‡çº§æˆå¹‚ç­‰æ€§ Producerï¼Œå…¶ä»–æ‰€æœ‰çš„ä»£ç é€»è¾‘éƒ½ä¸éœ€è¦æ”¹å˜ã€‚Kafka è‡ªåŠ¨å¸®ä½ åšæ¶ˆæ¯çš„é‡å¤å»é‡ã€‚<br>åŸç†å¾ˆç®€å•ï¼Œå°±æ˜¯ç»å…¸çš„ç©ºé—´æ¢æ—¶é—´ï¼Œå³åœ¨ Broker ç«¯å¤šä¿å­˜ä¸€äº›å­—æ®µã€‚å½“ Producer å‘é€äº†å…·æœ‰ç›¸åŒå­—æ®µå€¼çš„æ¶ˆæ¯åï¼ŒBroker èƒ½å¤Ÿè‡ªåŠ¨çŸ¥æ™“è¿™äº›æ¶ˆæ¯å·²ç»é‡å¤äº†ï¼Œå¯ä»¥åœ¨åå°é»˜é»˜åœ°æŠŠå®ƒä»¬â€œä¸¢å¼ƒâ€æ‰ã€‚<br>åªèƒ½ä¿è¯å•åˆ†åŒºã€å•ä¼šè¯ä¸Šçš„æ¶ˆæ¯å¹‚ç­‰æ€§ã€‚ä¸€ä¸ªå¹‚ç­‰æ€§ Producer èƒ½å¤Ÿä¿è¯æŸä¸ªtopicçš„ä¸€ä¸ªåˆ†åŒºä¸Šä¸å‡ºç°é‡å¤æ¶ˆæ¯ï¼Œä½†æ— æ³•å®ç°å¤šä¸ªåˆ†åŒºçš„å¹‚ç­‰æ€§ã€‚æ¯”å¦‚é‡‡ç”¨è½®è¯¢ï¼Œä¸‹ä¸€æ¬¡æäº¤æ¢äº†ä¸€ä¸ªåˆ†åŒºå°±æ— æ³•è§£å†³</p><h2 id="äº‹åŠ¡å‹-producer" tabindex="-1"><a class="header-anchor" href="#äº‹åŠ¡å‹-producer"><span>äº‹åŠ¡å‹ Producer?<br><br></span></a></h2><p>ç­”æ¡ˆï¼š<br>èƒ½å¤Ÿä¿è¯å°†æ¶ˆæ¯åŸå­æ€§åœ°å†™å…¥åˆ°å¤šä¸ªåˆ†åŒºä¸­ã€‚è¿™æ‰¹æ¶ˆæ¯è¦ä¹ˆå…¨éƒ¨å†™å…¥æˆåŠŸï¼Œè¦ä¹ˆå…¨éƒ¨å¤±è´¥ã€‚èƒ½å¤Ÿä¿è¯è·¨åˆ†åŒºã€è·¨ä¼šè¯é—´çš„å¹‚ç­‰æ€§ã€‚</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>producer.initTransactions();</span></span>
<span class="line"><span>try {</span></span>
<span class="line"><span>            producer.beginTransaction();</span></span>
<span class="line"><span>            producer.send(record1);</span></span>
<span class="line"><span>            producer.send(record2);</span></span>
<span class="line"><span>            //æäº¤äº‹åŠ¡</span></span>
<span class="line"><span>            producer.commitTransaction();</span></span>
<span class="line"><span>} catch (KafkaException e) {</span></span>
<span class="line"><span>            //äº‹åŠ¡ç»ˆæ­¢</span></span>
<span class="line"><span>            producer.abortTransaction();</span></span>
<span class="line"><span>}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å®é™…ä¸Šå³ä½¿å†™å…¥å¤±è´¥ï¼ŒKafka ä¹Ÿä¼šæŠŠå®ƒä»¬å†™å…¥åˆ°åº•å±‚çš„æ—¥å¿—ä¸­ï¼Œä¹Ÿå°±æ˜¯è¯´ Consumer è¿˜æ˜¯ä¼šçœ‹åˆ°è¿™äº›æ¶ˆæ¯ã€‚è¦ä¸è¦å¤„ç†åœ¨ Consumer ç«¯è®¾ç½® isolation.level ï¼Œè¿™ä¸ªå‚æ•°æœ‰ä¸¤ä¸ªå€¼:</p><ul><li>read_uncommittedï¼šè¿™æ˜¯é»˜è®¤å€¼ï¼Œè¡¨æ˜ Consumer èƒ½å¤Ÿè¯»å–åˆ° Kafka å†™å…¥çš„ä»»ä½•æ¶ˆæ¯</li><li>read_committedï¼šè¡¨æ˜ Consumer åªä¼šè¯»å–äº‹åŠ¡å‹ Producer æˆåŠŸæäº¤äº‹åŠ¡å†™å…¥çš„æ¶ˆæ¯</li></ul><h2 id="ä»€ä¹ˆæ˜¯æ¶ˆæ¯ä½ç§»-offset" tabindex="-1"><a class="header-anchor" href="#ä»€ä¹ˆæ˜¯æ¶ˆæ¯ä½ç§»-offset"><span>ä»€ä¹ˆæ˜¯æ¶ˆæ¯ä½ç§»ï¼ˆoffsetï¼‰ï¼Ÿ<br><br></span></a></h2><p>ç­”æ¡ˆï¼š<br>åœ¨Kafkaä¸­ï¼Œæ¯ä¸ªä¸»é¢˜åˆ†åŒºä¸‹çš„æ¯æ¡æ¶ˆæ¯éƒ½è¢«èµ‹äºˆäº†ä¸€ä¸ªå”¯ä¸€çš„IDæ•°å€¼ï¼Œç”¨äºæ ‡è¯†å®ƒåœ¨åˆ†åŒºä¸­çš„ä½ç½®ã€‚è¿™ä¸ªIDæ•°å€¼ï¼Œå°±è¢«ç§°ä¸ºä½ç§»ï¼Œæˆ–è€…å«åç§»é‡ã€‚ä¸€æ—¦æ¶ˆæ¯è¢«å†™å…¥åˆ°åˆ†åŒºæ—¥å¿—ï¼Œå®ƒçš„ä½ç§»å€¼å°†ä¸èƒ½è¢«ä¿®æ”¹ã€‚</p><h2 id="kafka-å¦‚ä½•å®ç°è´Ÿè½½å‡è¡¡" tabindex="-1"><a class="header-anchor" href="#kafka-å¦‚ä½•å®ç°è´Ÿè½½å‡è¡¡"><span><strong>Kafka å¦‚ä½•å®ç°è´Ÿè½½å‡è¡¡ï¼Ÿ</strong><br><br></span></a></h2><p>ç­”æ¡ˆï¼š<br>Kafka çš„è´Ÿè½½å‡è¡¡ä¸»è¦æ˜¯<strong>é€šè¿‡åˆ†åŒºæ¥å®ç°</strong>çš„ï¼Œæˆ‘ä»¬çŸ¥é“ Kafka æ˜¯<strong>ä¸»å†™ä¸»è¯»</strong>çš„æ¶æ„ï¼Œå¦‚ä¸‹å›¾:<br><img src="https://cdn.nlark.com/yuque/0/2022/png/21503536/1666966942555-118cbba0-3250-4370-83ff-6771a36ae158.png#clientId=ua41a3794-5c73-4&amp;from=paste&amp;height=395&amp;id=u06e2198e&amp;originHeight=669&amp;originWidth=1080&amp;originalType=url&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;status=done&amp;style=none&amp;taskId=u9e9c4ec7-09e2-43d9-8913-d39799fac69&amp;title=&amp;width=638" alt="" loading="lazy"></p><p>å…±ä¸‰ä¸ª broker ï¼Œé‡Œé¢å„æœ‰ä¸‰ä¸ªå‰¯æœ¬ï¼Œæ€»å…±æœ‰ä¸‰ä¸ª partationï¼Œ æ·±è‰²çš„æ˜¯ leaderï¼Œæµ…è‰²çš„æ˜¯ followerï¼Œä¸Šä¸‹ç°è‰²åˆ†åˆ«ä»£è¡¨ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…ï¼Œè™šçº¿ä»£è¡¨ follower ä» leader æ‹‰å–æ¶ˆæ¯ã€‚<br>æˆ‘ä»¬ä»è¿™å¼ å›¾å°±å¯ä»¥å¾ˆæ˜æ˜¾çš„çœ‹å‡ºæ¥ï¼Œ<strong>æ¯ä¸ª broker éƒ½æœ‰æ¶ˆè´¹è€…æ‹‰å–æ¶ˆæ¯ï¼Œæ¯ä¸ª broker ä¹Ÿéƒ½æœ‰ç”Ÿäº§è€…å‘é€æ¶ˆæ¯ï¼Œæ¯ä¸ª broker ä¸Šçš„è¯»å†™è´Ÿè½½éƒ½æ˜¯ä¸€æ ·çš„</strong>ï¼Œè¿™ä¹Ÿè¯´æ˜äº† kafka ç‹¬ç‰¹çš„æ¶æ„æ–¹å¼å¯ä»¥é€šè¿‡ä¸»å†™ä¸»è¯»æ¥å®ç°è´Ÿè½½å‡è¡¡ã€‚</p><h2 id="kafka-broker-å¦‚ä½•å­˜å‚¨æ•°æ®" tabindex="-1"><a class="header-anchor" href="#kafka-broker-å¦‚ä½•å­˜å‚¨æ•°æ®"><span>Kafka Broker å¦‚ä½•å­˜å‚¨æ•°æ®ï¼Ÿ<br><br></span></a></h2><p>ç­”æ¡ˆï¼š<br>Kafka ä½¿ç”¨æ¶ˆæ¯æ—¥å¿—ï¼ˆLogï¼‰æ¥ä¿å­˜æ•°æ®ï¼Œä¸€ä¸ªæ—¥å¿—å°±æ˜¯ç£ç›˜ä¸Šä¸€ä¸ªåªèƒ½è¿½åŠ å†™ï¼ˆAppend-onlyï¼‰æ¶ˆæ¯çš„ç‰©ç†æ–‡ä»¶ã€‚å› ä¸ºåªèƒ½è¿½åŠ å†™å…¥ï¼Œæ•…é¿å…äº†ç¼“æ…¢çš„éšæœº I/O æ“ä½œï¼Œæ”¹ä¸ºæ€§èƒ½è¾ƒå¥½çš„é¡ºåº I/O å†™æ“ä½œï¼Œè¿™ä¹Ÿæ˜¯å®ç° Kafka é«˜ååé‡ç‰¹æ€§çš„ä¸€ä¸ªé‡è¦æ‰‹æ®µã€‚<br>ä¸è¿‡å¦‚æœä½ ä¸åœåœ°å‘ä¸€ä¸ªæ—¥å¿—å†™å…¥æ¶ˆæ¯ï¼Œæœ€ç»ˆä¹Ÿä¼šè€—å°½æ‰€æœ‰çš„ç£ç›˜ç©ºé—´ï¼Œå› æ­¤ Kafka å¿…ç„¶è¦å®šæœŸåœ°åˆ é™¤æ¶ˆæ¯ä»¥å›æ”¶ç£ç›˜ã€‚æ€ä¹ˆåˆ é™¤å‘¢ï¼Ÿ<br>ç®€å•æ¥è¯´å°±æ˜¯é€šè¿‡æ—¥å¿—æ®µï¼ˆLog Segmentï¼‰æœºåˆ¶ã€‚åœ¨ Kafka åº•å±‚ï¼Œä¸€ä¸ªæ—¥å¿—åˆè¿‘ä¸€æ­¥ç»†åˆ†æˆå¤šä¸ªæ—¥å¿—æ®µï¼Œæ¶ˆæ¯è¢«è¿½åŠ å†™åˆ°å½“å‰æœ€æ–°çš„æ—¥å¿—æ®µä¸­ï¼Œå½“å†™æ»¡äº†ä¸€ä¸ªæ—¥å¿—æ®µåï¼ŒKafka ä¼šè‡ªåŠ¨åˆ‡åˆ†å‡ºä¸€ä¸ªæ–°çš„æ—¥å¿—æ®µï¼Œå¹¶å°†è€çš„æ—¥å¿—æ®µå°å­˜èµ·æ¥ã€‚Kafka åœ¨åå°è¿˜æœ‰å®šæ—¶ä»»åŠ¡ä¼šå®šæœŸåœ°æ£€æŸ¥è€çš„æ—¥å¿—æ®µæ˜¯å¦èƒ½å¤Ÿè¢«åˆ é™¤ï¼Œä»è€Œå®ç°å›æ”¶ç£ç›˜ç©ºé—´çš„ç›®çš„ã€‚</p><h2 id="æ¶ˆæ¯ä¼ è¾“åè®®" tabindex="-1"><a class="header-anchor" href="#æ¶ˆæ¯ä¼ è¾“åè®®"><span>æ¶ˆæ¯ä¼ è¾“åè®®ï¼Ÿ<br><br></span></a></h2><p>ç­”æ¡ˆï¼š<br>æ¶ˆæ¯æ¶ˆè´¹æœ‰ä¸¤ç§æ¨¡å¼ï¼šæ¨å’Œæ‹‰ã€‚Kafkaçš„æ¶ˆè´¹æ˜¯å±äº<strong>æ‹‰æ¨¡å¼</strong>çš„ï¼Œè€Œæ­¤æ¨¡å¼çš„æ¶ˆæ¯æ¶ˆè´¹æ–¹å¼æœ‰ä¸¤ç§**ï¼šç‚¹å¯¹ç‚¹å’Œå‘å¸ƒè®¢é˜…**ã€‚<br><strong>1ã€ç‚¹å¯¹ç‚¹</strong><br>ç³»ç»Ÿ A å‘é€çš„æ¶ˆæ¯åªèƒ½è¢«ç³»ç»Ÿ B æ¥æ”¶ï¼Œå…¶ä»–ä»»ä½•ç³»ç»Ÿéƒ½ä¸èƒ½è¯»å– A å‘é€çš„æ¶ˆæ¯<br><strong>2ã€å‘å¸ƒ/è®¢é˜…æ¨¡å‹</strong><br>è¯¥æ¨¡å‹ä¹Ÿæœ‰å‘é€æ–¹å’Œæ¥æ”¶æ–¹ï¼Œåªä¸è¿‡ææ³•ä¸åŒã€‚å‘é€æ–¹ä¹Ÿç§°ä¸ºå‘å¸ƒè€…ï¼ˆPublisherï¼‰ï¼Œæ¥æ”¶æ–¹ç§°ä¸ºè®¢é˜…è€…ï¼ˆSubscriberï¼‰ã€‚å’Œç‚¹å¯¹ç‚¹æ¨¡å‹ä¸åŒçš„æ˜¯ï¼Œè¿™ä¸ªæ¨¡å‹å¯èƒ½å­˜åœ¨å¤šä¸ªå‘å¸ƒè€…å‘ç›¸åŒçš„ä¸»é¢˜å‘é€æ¶ˆæ¯ï¼Œè€Œè®¢é˜…è€…ä¹Ÿå¯èƒ½å­˜åœ¨å¤šä¸ªï¼Œå®ƒä»¬éƒ½èƒ½æ¥æ”¶åˆ°ç›¸åŒä¸»é¢˜çš„æ¶ˆæ¯ã€‚</p><h2 id="æ¶ˆæ¯å‹ç¼©" tabindex="-1"><a class="header-anchor" href="#æ¶ˆæ¯å‹ç¼©"><span>æ¶ˆæ¯å‹ç¼©ï¼Ÿ<br><br></span></a></h2><p>ç­”æ¡ˆï¼š<br>ç”Ÿäº§è€…ç¨‹åºä¸­é…ç½®compression.type å‚æ•°å³è¡¨ç¤ºå¯ç”¨æŒ‡å®šç±»å‹çš„å‹ç¼©ç®—æ³•ã€‚<br>props.put(â€œcompression.typeâ€, â€œgzipâ€)ï¼Œå®ƒè¡¨æ˜è¯¥ Producer çš„å‹ç¼©ç®—æ³•ä½¿ç”¨çš„æ˜¯GZIPã€‚è¿™æ · Producer å¯åŠ¨åç”Ÿäº§çš„æ¯ä¸ªæ¶ˆæ¯é›†åˆéƒ½æ˜¯ç» GZIP å‹ç¼©è¿‡çš„ï¼Œæ•…è€Œèƒ½å¾ˆå¥½åœ°èŠ‚çœç½‘ç»œä¼ è¾“å¸¦å®½ä»¥åŠ Kafka Broker ç«¯çš„ç£ç›˜å ç”¨ã€‚<br>ä½†å¦‚æœBrokeråˆæŒ‡å®šäº†ä¸åŒçš„å‹ç¼©ç®—æ³•ï¼Œå¦‚ï¼šSnappyï¼Œä¼šå°†ç”Ÿäº§ç«¯çš„æ¶ˆæ¯è§£å‹ç„¶åæŒ‰è‡ªå·±çš„ç®—æ³•é‡æ–°å‹ç¼©ã€‚</p><blockquote><p>å„å‹ç¼©ç®—æ³•æ¯”è¾ƒï¼šååé‡æ–¹é¢ï¼šLZ4 &gt; Snappy &gt; zstd å’Œ GZIPï¼›è€Œåœ¨å‹ç¼©æ¯”æ–¹é¢ï¼Œzstd &gt; LZ4 &gt; GZIP &gt; Snappyã€‚</p></blockquote><p>kafkaé»˜è®¤ä¸æŒ‡å®šå‹ç¼©ç®—æ³•ã€‚</p><h2 id="æ¶ˆæ¯è§£å‹ç¼©" tabindex="-1"><a class="header-anchor" href="#æ¶ˆæ¯è§£å‹ç¼©"><span>æ¶ˆæ¯è§£å‹ç¼©ï¼Ÿ</span></a></h2><p>ç­”æ¡ˆï¼š<br>å½“ Consumer pullæ¶ˆæ¯æ—¶ï¼ŒBroker ä¼šåŸæ ·å‘é€å‡ºå»ï¼Œå½“æ¶ˆæ¯åˆ°è¾¾ Consumer ç«¯åï¼Œç”± Consumer è‡ªè¡Œè§£å‹ç¼©è¿˜åŸæˆä¹‹å‰çš„æ¶ˆæ¯ã€‚</p><h2 id="åˆ†åŒºç­–ç•¥" tabindex="-1"><a class="header-anchor" href="#åˆ†åŒºç­–ç•¥"><span>åˆ†åŒºç­–ç•¥ï¼Ÿ<br><br></span></a></h2><p>ç­”æ¡ˆï¼š<br>ç¼–å†™ä¸€ä¸ªç±»å®ç°org.apache.kafka.clients.Partitioneræ¥å£ã€‚å®ç°å†…éƒ¨ä¸¤ä¸ªæ–¹æ³•ï¼špartition()å’Œclose()ã€‚ç„¶åæ˜¾å¼åœ°é…ç½®ç”Ÿäº§è€…ç«¯çš„å‚æ•°partitioner.class<br><strong>å¸¸è§çš„ç­–ç•¥ï¼š</strong></p><ul><li>è½®è¯¢ç­–ç•¥ï¼ˆé»˜è®¤ï¼‰ã€‚ä¿è¯æ¶ˆæ¯æœ€å¤§é™åº¦åœ°è¢«å¹³å‡åˆ†é…åˆ°æ‰€æœ‰åˆ†åŒºä¸Šã€‚</li><li>éšæœºç­–ç•¥ã€‚éšæœºç­–ç•¥æ˜¯è€ç‰ˆæœ¬ç”Ÿäº§è€…ä½¿ç”¨çš„åˆ†åŒºç­–ç•¥ï¼Œåœ¨æ–°ç‰ˆæœ¬ä¸­å·²ç»æ”¹ä¸ºè½®è¯¢äº†ã€‚</li><li>æŒ‰keyåˆ†åŒºç­–ç•¥ã€‚keyå¯èƒ½æ˜¯uidæˆ–è€…è®¢å•idï¼Œå°†åŒä¸€æ ‡å¿—ä½çš„æ‰€æœ‰æ¶ˆæ¯éƒ½å‘é€åˆ°åŒä¸€åˆ†åŒºï¼Œè¿™æ ·å¯ä»¥ä¿è¯ä¸€ä¸ªåˆ†åŒºå†…çš„æ¶ˆæ¯æœ‰åº</li><li>å…¶ä»–åˆ†åŒºç­–ç•¥ã€‚å¦‚ï¼šåŸºäºåœ°ç†ä½ç½®çš„åˆ†åŒºç­–ç•¥</li></ul><h2 id="ä»€ä¹ˆæ˜¯æ¶ˆè´¹è€…ç»„" tabindex="-1"><a class="header-anchor" href="#ä»€ä¹ˆæ˜¯æ¶ˆè´¹è€…ç»„"><span>ä»€ä¹ˆæ˜¯æ¶ˆè´¹è€…ç»„ï¼Ÿ</span></a></h2><p>ç­”æ¡ˆï¼š<br>æ¶ˆè´¹è€…ç»„ï¼ˆConsumer Groupï¼‰å…è®¸ä½ åˆ†å‰²æ•°æ®ï¼Œä¸€ä¸ªæ¶ˆè´¹è€…ç»„ä¸­å¯ä»¥åŒ…å«å¤šä¸ªæ¶ˆè´¹è€…è¿›ç¨‹ï¼Œä»–ä»¬å…±åŒæ¶ˆè´¹è¯¥topicçš„æ•°æ®ã€‚<br>åŒä¸€ä¸ªç»„ä¸‹çš„æ¯ä¸ªå®ä¾‹éƒ½é…ç½®æœ‰ç›¸åŒçš„ç»„ IDï¼Œè¢«åˆ†é…è®¢é˜…ä¸åŒçš„ topic åˆ†åŒºã€‚å½“æŸä¸ªå®ä¾‹æŒ‚æ‰çš„æ—¶å€™ï¼Œå…¶ä»–å®ä¾‹ä¼šè‡ªåŠ¨åœ°æ‰¿æ‹…èµ·å®ƒè´Ÿè´£æ¶ˆè´¹çš„åˆ†åŒºã€‚ å› æ­¤ï¼Œæ¶ˆè´¹è€…ç»„åœ¨ä¸€å®šç¨‹åº¦ä¸Šä¹Ÿä¿è¯äº†æ¶ˆè´¹è€…ç¨‹åºçš„é«˜å¯ç”¨æ€§ã€‚</p><h2 id="æ¶ˆè´¹ç«¯å½“å‰èƒ½è¯»åˆ°å“ªä¸€æ¡æ¶ˆæ¯" tabindex="-1"><a class="header-anchor" href="#æ¶ˆè´¹ç«¯å½“å‰èƒ½è¯»åˆ°å“ªä¸€æ¡æ¶ˆæ¯"><span><strong>æ¶ˆè´¹ç«¯å½“å‰èƒ½è¯»åˆ°å“ªä¸€æ¡æ¶ˆæ¯ï¼Ÿ</strong></span></a></h2><p>ç­”æ¡ˆï¼š<br>åˆ†åŒºç›¸å½“äºä¸€ä¸ªæ—¥å¿—æ–‡ä»¶<br><img src="https://cdn.nlark.com/yuque/0/2022/png/21503536/1666966943079-0344bf10-49e4-4b73-b6dd-08553ea6817d.png#clientId=ua41a3794-5c73-4&amp;from=paste&amp;height=260&amp;id=ueeba08ad&amp;originHeight=525&amp;originWidth=1080&amp;originalType=url&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;status=done&amp;style=none&amp;taskId=ub59f66ec-19b2-4e49-a9b9-12d6b44ef7c&amp;title=&amp;width=535" alt="" loading="lazy"><br>å¦‚ä¸Šå›¾æ˜¯ä¸€ä¸ªåˆ†åŒºæ—¥å¿—æ–‡ä»¶</p><ul><li>æ ‡è¯†<strong>å…±æœ‰7æ¡æ¶ˆæ¯</strong>ï¼Œoffset (æ¶ˆæ¯åç§»é‡)åˆ†åˆ«æ˜¯0~6</li><li>0 ä»£è¡¨è¿™ä¸ªæ—¥å¿—æ–‡ä»¶çš„<strong>å¼€å§‹</strong></li><li>HW(High Watermark) ä¸º4ï¼Œ0~3 ä»£è¡¨è¿™ä¸ªæ—¥å¿—æ–‡ä»¶<strong>å¯ä»¥æ¶ˆè´¹çš„åŒºé—´</strong>ï¼Œæ¶ˆè´¹è€…åªèƒ½æ¶ˆè´¹åˆ°è¿™å››æ¡æ¶ˆæ¯</li><li>LEO ä»£è¡¨å³å°†è¦å†™å…¥æ¶ˆæ¯çš„åç§»é‡ offset</li></ul><p><strong>åˆ†åŒº ISR é›†åˆä¸­çš„æ¯ä¸ªå‰¯æœ¬éƒ½ä¼šç»´æŠ¤è‡ªå·±çš„ LEOï¼Œè€Œ ISR é›†åˆä¸­æœ€å°çš„LEO å³ä¸ºåˆ†åŒºçš„ HW</strong></p><figure><img src="https://cdn.nlark.com/yuque/0/2022/png/21503536/1666966942924-0c5e68c4-4358-450a-a269-7d8b83a76984.png#clientId=ua41a3794-5c73-4&amp;from=paste&amp;height=286&amp;id=uc3ce1972&amp;originHeight=544&amp;originWidth=1080&amp;originalType=url&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;status=done&amp;style=none&amp;taskId=u5c1fda36-25da-40ae-aa4d-7d85d9d09ec&amp;title=&amp;width=568" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>å¦‚ä¸Šå›¾: ä¸‰ä¸ªåˆ†åŒºå‰¯æœ¬éƒ½æ˜¯ ISRé›†åˆå½“ä¸­çš„ï¼Œæœ€å°çš„ LEO ä¸º 3ï¼Œå°±ä»£è¡¨åˆ†åŒºçš„ HW ä¸º3ï¼Œæ‰€ä»¥å½“å‰åˆ†åŒºåªèƒ½æ¶ˆè´¹åˆ° 0~2 ä¹‹é—´çš„ä¸‰æ¡æ•°æ®ï¼Œå¦‚ä¸‹å›¾</p><figure><img src="https://cdn.nlark.com/yuque/0/2022/png/21503536/1666966943097-87e73a92-25cb-4987-9592-b8a945bc17ef.png#clientId=ua41a3794-5c73-4&amp;from=paste&amp;height=277&amp;id=u105ce1e4&amp;originHeight=536&amp;originWidth=1080&amp;originalType=url&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;status=done&amp;style=none&amp;taskId=u21038c1d-0648-4e02-9f4a-c458c1c09c6&amp;title=&amp;width=559" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><h2 id="æ¶ˆè´¹ç«¯æ‹‰å–-æ‰¹é‡-ã€ack" tabindex="-1"><a class="header-anchor" href="#æ¶ˆè´¹ç«¯æ‹‰å–-æ‰¹é‡-ã€ack"><span>æ¶ˆè´¹ç«¯æ‹‰å–ï¼ˆæ‰¹é‡ï¼‰ã€ACKï¼Ÿ</span></a></h2><p>ç­”æ¡ˆï¼š<br>æ¶ˆè´¹ç«¯å…ˆæ‹‰å–å¹¶æ¶ˆè´¹æ¶ˆæ¯ï¼Œç„¶åå†ackæ›´æ–°offsetã€‚<br>1ï¼‰æ¶ˆè´¹è€…ç¨‹åºå¯åŠ¨å¤šä¸ªçº¿ç¨‹ï¼Œæ¯ä¸ªçº¿ç¨‹ç»´æŠ¤ä¸“å±çš„ KafkaConsumer å®ä¾‹ï¼Œè´Ÿè´£å®Œæ•´çš„æ¶ˆæ¯æ‹‰å–ã€æ¶ˆæ¯å¤„ç†æµç¨‹ã€‚ä¸€ä¸ªKafkaConsumerè´Ÿè´£ä¸€ä¸ªåˆ†åŒºï¼Œèƒ½ä¿è¯åˆ†åŒºå†…çš„æ¶ˆæ¯æ¶ˆè´¹é¡ºåºã€‚<br>ç¼ºç‚¹ï¼šçº¿ç¨‹æ•°å—é™äº Consumer è®¢é˜…topicçš„æ€»åˆ†åŒºæ•°ã€‚<br>2ï¼‰ä»»åŠ¡åˆ‡åˆ†æˆäº†æ¶ˆæ¯è·å–å’Œæ¶ˆæ¯å¤„ç†ä¸¤ä¸ªéƒ¨åˆ†ã€‚æ¶ˆè´¹è€…ç¨‹åºä½¿ç”¨å•æˆ–å¤šçº¿ç¨‹æ‹‰å–æ¶ˆæ¯ï¼ŒåŒæ—¶åˆ›å»ºä¸“é—¨çº¿ç¨‹æ± æ‰§è¡Œä¸šåŠ¡é€»è¾‘ã€‚ä¼˜ç‚¹ï¼šå¯ä»¥çµæ´»è°ƒèŠ‚æ¶ˆæ¯è·å–çš„çº¿ç¨‹æ•°ï¼Œä»¥åŠæ¶ˆæ¯å¤„ç†çš„çº¿ç¨‹æ•°ã€‚<br>ç¼ºç‚¹ï¼šæ— æ³•ä¿è¯åˆ†åŒºå†…çš„æ¶ˆæ¯æ¶ˆè´¹é¡ºåºã€‚å¦å¤–å¼•å…¥å¤šç»„çº¿ç¨‹ï¼Œä½¿å¾—æ•´ä¸ªæ¶ˆæ¯æ¶ˆè´¹é“¾è·¯è¢«æ‹‰é•¿ï¼Œæœ€ç»ˆå¯¼è‡´æ­£ç¡®ä½ç§»æäº¤ä¼šå˜å¾—å¼‚å¸¸å›°éš¾ï¼Œå¯èƒ½ä¼šå‡ºç°æ¶ˆæ¯çš„é‡å¤æ¶ˆè´¹æˆ–ä¸¢å¤±ã€‚</p><h2 id="æ¶ˆè´¹ç«¯-offset-ç®¡ç†" tabindex="-1"><a class="header-anchor" href="#æ¶ˆè´¹ç«¯-offset-ç®¡ç†"><span>æ¶ˆè´¹ç«¯ offset ç®¡ç†ï¼Ÿ<br><br></span></a></h2><p>ç­”æ¡ˆï¼š<br>1ï¼‰è€ç‰ˆæœ¬çš„ Consumerç»„æŠŠä½ç§»ä¿å­˜åœ¨ ZooKeeper ä¸­ï¼Œä½†å¾ˆå¿«å‘ç°zkå¹¶ä¸é€‚åˆé¢‘ç¹çš„å†™æ›´æ–°ã€‚<br>2ï¼‰åœ¨æ–°ç‰ˆæœ¬çš„ Consumer Group ä¸­ï¼ŒKafka ç¤¾åŒºé‡æ–°è®¾è®¡äº† Consumerç»„çš„ä½ç§»ç®¡ç†æ–¹å¼ï¼Œé‡‡ç”¨äº†å°†ä½ç§»ä¿å­˜åœ¨ Brokerç«¯çš„å†…éƒ¨topicä¸­ï¼Œä¹Ÿç§°ä¸ºâ€œä½ç§»ä¸»é¢˜â€ï¼Œç”±kafkaè‡ªå·±æ¥ç®¡ç†ã€‚<br>åŸç†å¾ˆç®€å•ï¼Œ Consumerçš„ä½ç§»æ•°æ®ä½œä¸ºä¸€æ¡æ¡æ™®é€šçš„ Kafka æ¶ˆæ¯ï¼Œæäº¤åˆ°__consumer_offsets ä¸­ã€‚å®ƒçš„æ¶ˆæ¯æ ¼å¼ç”±Kafka è‡ªå·±å®šä¹‰ï¼Œç”¨æˆ·ä¸èƒ½ä¿®æ”¹ã€‚ä½ç§»ä¸»é¢˜çš„ Key ä¸»è¦åŒ…æ‹¬ 3 éƒ¨åˆ†å†…å®¹ï¼š&lt;Group IDï¼Œtopicåï¼Œåˆ†åŒºå· &gt;<br>Kafka Consumer æäº¤ä½ç§»çš„æ–¹å¼æœ‰ä¸¤ç§ï¼šè‡ªåŠ¨æäº¤ä½ç§»å’Œæ‰‹åŠ¨æäº¤ä½ç§»ã€‚<br>Kafka ä½¿ç”¨Compactç­–ç•¥æ¥åˆ é™¤ä½ç§»ä¸»é¢˜ä¸­çš„è¿‡æœŸæ¶ˆæ¯ï¼Œé¿å…è¯¥topicæ— é™æœŸè†¨èƒ€ã€‚æä¾›äº†ä¸“é—¨çš„åå°çº¿ç¨‹å®šæœŸåœ°å·¡æ£€å¾… Compact çš„ä¸»é¢˜ï¼Œçœ‹çœ‹æ˜¯å¦å­˜åœ¨æ»¡è¶³æ¡ä»¶çš„å¯åˆ é™¤æ•°æ®ã€‚</p><h2 id="åˆ†åŒºå†åˆ†é…æ˜¯åšä»€ä¹ˆçš„" tabindex="-1"><a class="header-anchor" href="#åˆ†åŒºå†åˆ†é…æ˜¯åšä»€ä¹ˆçš„"><span>åˆ†åŒºå†åˆ†é…æ˜¯åšä»€ä¹ˆçš„ï¼Ÿ<br><br></span></a></h2><p>ç­”æ¡ˆï¼š<br>åˆ†åŒºå†åˆ†é…ä¸»è¦æ˜¯ç”¨æ¥<strong>ç»´æŠ¤ kafka é›†ç¾¤çš„è´Ÿè½½å‡è¡¡</strong><br>æ—¢ç„¶æ˜¯åˆ†åŒºå†åˆ†é…ï¼Œé‚£ä¹ˆ kafka åˆ†åŒºæœ‰ä»€ä¹ˆé—®é¢˜å‘¢ï¼Ÿ<br><img src="https://cdn.nlark.com/yuque/0/2022/png/21503536/1666966943050-f067c92e-da8a-4523-b8d1-b8df48a829c2.png#clientId=ua41a3794-5c73-4&amp;from=paste&amp;height=240&amp;id=u17272f4d&amp;originHeight=392&amp;originWidth=892&amp;originalType=url&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;status=done&amp;style=none&amp;taskId=u06187419-1307-429b-80f2-3c18f836688&amp;title=&amp;width=546" alt="" loading="lazy"></p><ul><li>é—®é¢˜1: å½“é›†ç¾¤ä¸­çš„ä¸€ä¸ªèŠ‚ç‚¹ä¸‹çº¿äº† <ul><li>å¦‚æœè¯¥èŠ‚ç‚¹çš„åˆ†åŒºæ˜¯å•å‰¯æœ¬çš„ï¼Œé‚£ä¹ˆåˆ†åŒºå°†ä¼šå˜å¾—ä¸å¯ç”¨</li><li>å¦‚æœæ˜¯å¤šå‰¯æœ¬çš„ï¼Œå°±ä¼šè¿›è¡Œ leader é€‰ä¸¾ï¼Œåœ¨å…¶ä»–æœºå™¨ä¸Šé€‰ä¸¾å‡ºæ–°çš„ leader</li></ul></li></ul><p><strong>kafka å¹¶ä¸ä¼šå°†è¿™äº›å¤±æ•ˆçš„åˆ†åŒºè¿ç§»åˆ°å…¶ä»–å¯ç”¨çš„ broker ä¸Š</strong>ï¼Œè¿™æ ·å°±ä¼šå½±å“é›†ç¾¤çš„è´Ÿè½½å‡è¡¡ï¼Œç”šè‡³ä¹Ÿä¼šå½±å“æœåŠ¡çš„å¯é æ€§å’Œå¯ç”¨æ€§<br><img src="https://cdn.nlark.com/yuque/0/2022/png/21503536/1666966943237-44fcbda1-d733-4eb5-8aa6-2328e15bbc4d.png#clientId=ua41a3794-5c73-4&amp;from=paste&amp;height=240&amp;id=uabea12a3&amp;originHeight=412&amp;originWidth=994&amp;originalType=url&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;status=done&amp;style=none&amp;taskId=u5f29c7fe-ef80-4dc6-a076-69436c6b2c2&amp;title=&amp;width=578" alt="" loading="lazy"></p><ul><li>é—®é¢˜2: å½“é›†ç¾¤æ–°å¢ broker æ—¶ï¼Œåªæœ‰æ–°çš„ä¸»é¢˜åˆ†åŒºä¼šåˆ†é…åœ¨è¯¥ broker ä¸Šï¼Œè€Œè€çš„ä¸»é¢˜åˆ†åŒºä¸ä¼šåˆ†é…åœ¨è¯¥ broker ä¸Šï¼Œå°±é€ æˆäº†<strong>è€èŠ‚ç‚¹å’Œæ–°èŠ‚ç‚¹ä¹‹é—´çš„è´Ÿè½½ä¸å‡è¡¡</strong>ã€‚</li></ul><p>ä¸ºäº†è§£å†³è¯¥é—®é¢˜å°±å‡ºç°äº†åˆ†åŒºå†åˆ†é…ï¼Œå®ƒå¯ä»¥åœ¨é›†ç¾¤æ‰©å®¹ï¼Œbroker å¤±æ•ˆçš„åœºæ™¯ä¸‹è¿›è¡Œåˆ†åŒºè¿ç§»ã€‚<br><strong>åˆ†åŒºå†åˆ†é…çš„åŸç†å°±æ˜¯é€šè¿‡æ§åˆ¶å™¨ç»™åˆ†åŒºæ–°å¢æ–°çš„å‰¯æœ¬ï¼Œç„¶åé€šè¿‡ç½‘ç»œæŠŠæ—§çš„å‰¯æœ¬æ•°æ®å¤åˆ¶åˆ°æ–°çš„å‰¯æœ¬ä¸Šï¼Œåœ¨å¤åˆ¶å®Œæˆåï¼Œå°†æ—§å‰¯æœ¬æ¸…é™¤ã€‚</strong> å½“ç„¶ï¼Œä¸ºäº†ä¸å½±å“é›†ç¾¤æ­£å¸¸çš„æ€§èƒ½ï¼Œåœ¨æ­¤å¤åˆ¶æœŸé—´è¿˜ä¼šæœ‰ä¸€äº›åˆ—ä¿è¯æ€§èƒ½çš„æ“ä½œï¼Œæ¯”å¦‚<strong>å¤åˆ¶é™æµ</strong>ã€‚</p><h2 id="å‰¯æœ¬-leader-æ˜¯æ€ä¹ˆé€‰ä¸¾çš„" tabindex="-1"><a class="header-anchor" href="#å‰¯æœ¬-leader-æ˜¯æ€ä¹ˆé€‰ä¸¾çš„"><span>å‰¯æœ¬ leader æ˜¯æ€ä¹ˆé€‰ä¸¾çš„ï¼Ÿ<br><br></span></a></h2><p>ç­”æ¡ˆï¼š<br>å½“åˆ†åŒº leader èŠ‚ç‚¹å´©æºƒæ—¶ï¼Œå…¶ä¸­ä¸€ä¸ª follower èŠ‚ç‚¹ä¼šæˆä¸ºæ–°çš„ leader èŠ‚ç‚¹ï¼Œè¿™æ ·ä¼š<strong>å¯¼è‡´é›†ç¾¤çš„è´Ÿè½½ä¸å‡è¡¡ï¼Œä»è€Œå½±å“æœåŠ¡çš„å¥å£®æ€§å’Œç¨³å®šæ€§</strong>ã€‚<br>å¦‚ä¸‹:</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>Topic: test Partation:0 Leader:1 Replicas:1,2,0 Isr:1,2,0</span></span>
<span class="line"><span>Topic: test Partation:1 Leader:2 Replicas:2,0,1 Isr:2,0,1</span></span>
<span class="line"><span>Topic: test Partation:2 Leader:0 Replicas:0,1,2 Isr:0,1,2</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°</p><ul><li>0 åˆ†åŒº 1 æ˜¯ leader</li><li>1 åˆ†åŒº 2 æ˜¯ leader</li><li>2 åˆ†åŒº 0 æ˜¯ leader</li></ul><p>å¦‚æœæ­¤æ—¶ä¸­é—´çš„<strong>èŠ‚ç‚¹é‡å¯</strong></p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>Topic: test Partation:0 Leader:1 Replicas:1,2,0 Isr:1,0,2</span></span>
<span class="line"><span>Topic: test Partation:1 Leader:0 Replicas:2,0,1 Isr:0,1,2</span></span>
<span class="line"><span>Topic: test Partation:2 Leader:0 Replicas:0,1,2 Isr:0,1,2</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æˆ‘ä»¬åˆå¯ä»¥çœ‹åˆ°:</p><ul><li>0 åˆ†åŒº 1 æ˜¯ leader</li><li>1 åˆ†åŒº 0 æ˜¯ leader</li><li>2 åˆ†åŒº 0 æ˜¯ leader</li></ul><p>æˆ‘ä»¬ä¼šå‘ç°ï¼ŒåŸæœ¬ 1 åˆ†åŒºæœ‰ä¸¤ä¸ª ledaerï¼Œç»è¿‡é‡å¯å leader éƒ½æ¶ˆå¤±äº†ï¼Œå¦‚æ­¤å°±<strong>è´Ÿè½½ä¸å‡è¡¡</strong>äº†ã€‚<br>ä¸ºäº†è§£å†³è¿™ç§é—®é¢˜ï¼Œå°±å¼•å…¥äº†<code>ä¼˜å…ˆå‰¯æœ¬</code>çš„æ¦‚å¿µ<br>ä¼˜å…ˆå‰¯æœ¬å°±æ˜¯è¯´åœ¨ AR é›†åˆä¸­çš„ç¬¬ä¸€ä¸ªå‰¯æœ¬ã€‚æ¯”å¦‚åˆ†åŒº 2 çš„ AR ä¸º 0ï¼Œ1ï¼Œ2ï¼Œé‚£ä¹ˆåˆ†åŒº 2 çš„ä¼˜å…ˆå‰¯æœ¬å°±ä¸º0ã€‚ç†æƒ³æƒ…å†µä¸‹ä¼˜å…ˆå‰¯æœ¬å°±æ˜¯ leader å‰¯æœ¬ã€‚ä¼˜å…ˆå‰¯æœ¬é€‰ä¸¾å°±æ˜¯ä¿ƒä½¿ä¼˜å…ˆå‰¯æœ¬æˆä¸º leader å‰¯æœ¬ï¼Œä»è€Œç»´æŠ¤é›†ç¾¤çš„è´Ÿè½½å‡è¡¡ã€‚</p><h2 id="åˆ†åŒºæ•°è¶Šå¤šè¶Šå¥½å—-ååé‡å°±ä¼šè¶Šé«˜å—" tabindex="-1"><a class="header-anchor" href="#åˆ†åŒºæ•°è¶Šå¤šè¶Šå¥½å—-ååé‡å°±ä¼šè¶Šé«˜å—"><span>åˆ†åŒºæ•°è¶Šå¤šè¶Šå¥½å—ï¼Ÿååé‡å°±ä¼šè¶Šé«˜å—ï¼Ÿ</span></a></h2><p>ç­”æ¡ˆï¼š<br>ä¸€èˆ¬ç±»ä¼¼äºè¿™ç§é—®é¢˜çš„ç­”æ¡ˆï¼Œéƒ½æ˜¯æŒå¦å®šæ€åº¦çš„ã€‚<br>ä½†æ˜¯å¯ä»¥è¯´ï¼Œ<strong>åœ¨ä¸€å®šæ¡ä»¶ä¸‹ï¼Œåˆ†åŒºæ•°çš„æ•°é‡æ˜¯å’Œååé‡æˆæ­£æ¯”çš„ï¼Œåˆ†åŒºæ•°å’Œæ€§èƒ½ä¹Ÿæ˜¯æˆæ­£æ¯”çš„</strong>ã€‚<br>é‚£ä¹ˆä¸ºä»€ä¹ˆè¯´è¶…è¿‡äº†ä¸€å®šé™åº¦ï¼Œå°±ä¼šå¯¹æ€§èƒ½é€ æˆå½±å“å‘¢ï¼ŸåŸå› å¦‚ä¸‹:<br><img src="https://cdn.nlark.com/yuque/0/2022/png/21503536/1666966943332-f155dc0c-b407-49be-8c86-d03a29aabf03.png#clientId=ua41a3794-5c73-4&amp;from=paste&amp;height=235&amp;id=u1dce99b2&amp;originHeight=463&amp;originWidth=1080&amp;originalType=url&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;status=done&amp;style=none&amp;taskId=ud49020f6-a594-4d89-bdb5-f5e97710dec&amp;title=&amp;width=547" alt="" loading="lazy"><br><strong>1ã€å®¢æˆ·ç«¯/æœåŠ¡å™¨ç«¯éœ€è¦ä½¿ç”¨çš„å†…å­˜å°±è¶Šå¤š</strong></p><ul><li>æœåŠ¡ç«¯åœ¨å¾ˆå¤šç»„ä»¶ä¸­éƒ½ç»´æŠ¤äº†åˆ†åŒºçº§åˆ«çš„ç¼“å­˜ï¼Œåˆ†åŒºæ•°è¶Šå¤§ï¼Œ<strong>ç¼“å­˜æˆæœ¬</strong>ä¹Ÿå°±è¶Šå¤§ã€‚</li><li>æ¶ˆè´¹ç«¯çš„æ¶ˆè´¹çº¿ç¨‹æ•°æ˜¯å’Œåˆ†åŒºæ•°æŒ‚é’©çš„ï¼Œåˆ†åŒºæ•°è¶Šå¤§æ¶ˆè´¹çº¿ç¨‹æ•°ä¹Ÿå°±è¶Šå¤šï¼Œ<strong>çº¿ç¨‹çš„å¼€é”€æˆæœ¬</strong>ä¹Ÿå°±è¶Šå¤§</li><li>ç”Ÿäº§è€…å‘é€æ¶ˆæ¯æœ‰ç¼“å­˜çš„æ¦‚å¿µï¼Œä¼šä¸ºæ¯ä¸ªåˆ†åŒºç¼“å­˜æ¶ˆæ¯ï¼Œå½“ç§¯ç´¯åˆ°ä¸€å®šç¨‹åº¦æˆ–è€…æ—¶é—´æ—¶ä¼šå°†æ¶ˆæ¯å‘é€åˆ°åˆ†åŒºï¼Œ<strong>åˆ†åŒºè¶Šå¤šï¼Œè¿™éƒ¨åˆ†çš„ç¼“å­˜</strong>ä¹Ÿå°±è¶Šå¤§</li></ul><p><strong>2ã€æ–‡ä»¶å¥æŸ„çš„å¼€é”€</strong> <br><strong>æ¯ä¸ª partition éƒ½ä¼šå¯¹åº”ç£ç›˜æ–‡ä»¶ç³»ç»Ÿçš„ä¸€ä¸ªç›®å½•</strong>ã€‚åœ¨ Kafka çš„æ•°æ®æ—¥å¿—æ–‡ä»¶ç›®å½•ä¸­ï¼Œæ¯ä¸ªæ—¥å¿—æ•°æ®æ®µéƒ½ä¼šåˆ†é…ä¸¤ä¸ªæ–‡ä»¶ï¼Œä¸€ä¸ªç´¢å¼•æ–‡ä»¶å’Œä¸€ä¸ªæ•°æ®æ–‡ä»¶ã€‚<strong>æ¯ä¸ª broker ä¼šä¸ºæ¯ä¸ªæ—¥å¿—æ®µæ–‡ä»¶æ‰“å¼€ä¸€ä¸ª index æ–‡ä»¶å¥æŸ„å’Œä¸€ä¸ªæ•°æ®æ–‡ä»¶å¥æŸ„</strong>ã€‚å› æ­¤ï¼Œéšç€ partition çš„å¢å¤šï¼Œæ‰€éœ€è¦ä¿æŒæ‰“å¼€çŠ¶æ€çš„æ–‡ä»¶å¥æŸ„æ•°ä¹Ÿå°±è¶Šå¤šï¼Œæœ€ç»ˆå¯èƒ½è¶…è¿‡åº•å±‚æ“ä½œç³»ç»Ÿé…ç½®çš„æ–‡ä»¶å¥æŸ„æ•°é‡é™åˆ¶ã€‚<br><strong>3ã€è¶Šå¤šçš„åˆ†åŒºå¯èƒ½å¢åŠ ç«¯å¯¹ç«¯çš„å»¶è¿Ÿ</strong> <br>Kafka ä¼šå°†åˆ†åŒº HW ä¹‹å‰çš„æ¶ˆæ¯æš´éœ²ç»™æ¶ˆè´¹è€…ã€‚<strong>åˆ†åŒºè¶Šå¤šåˆ™å‰¯æœ¬ä¹‹é—´çš„åŒæ­¥æ•°é‡å°±è¶Šå¤š</strong>ï¼Œåœ¨é»˜è®¤æƒ…å†µä¸‹ï¼Œæ¯ä¸ª broker ä»å…¶ä»– broker èŠ‚ç‚¹è¿›è¡Œæ•°æ®å‰¯æœ¬å¤åˆ¶æ—¶ï¼Œè¯¥ broker èŠ‚ç‚¹åªä¼šä¸ºæ­¤å·¥ä½œåˆ†é…ä¸€ä¸ªçº¿ç¨‹ï¼Œè¯¥çº¿ç¨‹éœ€è¦å®Œæˆè¯¥ broker æ‰€æœ‰ partition æ•°æ®çš„å¤åˆ¶ã€‚<br><strong>4ã€é™ä½é«˜å¯ç”¨æ€§</strong> <br>åœ¨ç¬¬ 13 é—®æˆ‘ä»¬æåˆ°äº†åˆ†åŒºå†åˆ†é…ï¼Œä¼šå°†æ•°æ®å¤åˆ¶åˆ°å¦ä¸€ä»½å‰¯æœ¬å½“ä¸­ï¼Œ<strong>åˆ†åŒºæ•°é‡è¶Šå¤šï¼Œé‚£ä¹ˆæ¢å¤æ—¶é—´ä¹Ÿå°±è¶Šé•¿</strong>ï¼Œè€Œå¦‚æœå‘ç”Ÿå®•æœºçš„ broker æ°å¥½æ˜¯ controller èŠ‚ç‚¹æ—¶ï¼šåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ–° leader èŠ‚ç‚¹çš„é€‰ä¸¾è¿‡ç¨‹åœ¨ controller èŠ‚ç‚¹æ¢å¤åˆ°æ–°çš„ broker ä¹‹å‰ä¸ä¼šå¯åŠ¨ã€‚controller èŠ‚ç‚¹çš„é”™è¯¯æ¢å¤å°†ä¼šè‡ªåŠ¨åœ°è¿›è¡Œï¼Œä½†æ˜¯æ–°çš„ controller èŠ‚ç‚¹éœ€è¦ä» zookeeper ä¸­è¯»å–æ¯ä¸€ä¸ª partition çš„å…ƒæ•°æ®ä¿¡æ¯ç”¨äºåˆå§‹åŒ–æ•°æ®ã€‚ä¾‹å¦‚ï¼Œå‡è®¾ä¸€ä¸ªKafka é›†ç¾¤å­˜åœ¨ 10000ä¸ªpartitionï¼Œä» zookeeper ä¸­æ¢å¤å…ƒæ•°æ®æ—¶æ¯ä¸ª partition å¤§çº¦èŠ±è´¹ 2 msï¼Œåˆ™ controller çš„æ¢å¤å°†ä¼šå¢åŠ çº¦ 20 ç§’çš„ä¸å¯ç”¨æ—¶é—´çª—å£ã€‚</p><h2 id="å¦‚ä½•æå‡æ¶ˆè´¹è€…çš„æ¶ˆè´¹èƒ½åŠ›" tabindex="-1"><a class="header-anchor" href="#å¦‚ä½•æå‡æ¶ˆè´¹è€…çš„æ¶ˆè´¹èƒ½åŠ›"><span>å¦‚ä½•æå‡æ¶ˆè´¹è€…çš„æ¶ˆè´¹èƒ½åŠ›ï¼Ÿ</span></a></h2><p>ç­”æ¡ˆï¼š</p><ul><li>1.å¯ä»¥è€ƒè™‘å¢åŠ  topic çš„åˆ†åŒºæ•°ï¼Œå¹¶ä¸”åŒæ—¶æå‡æ¶ˆè´¹ç»„çš„æ¶ˆè´¹è€…æ•°é‡ï¼Œæ¶ˆè´¹è€…æ•°=åˆ†åŒºæ•°ã€‚</li><li>2.å¦‚æœæ˜¯æ¶ˆè´¹è€…æ¶ˆè´¹ä¸åŠæ—¶ï¼Œå¯ä»¥é‡‡ç”¨å¤šçº¿ç¨‹çš„æ–¹å¼è¿›è¡Œæ¶ˆè´¹ï¼Œå¹¶ä¸”ä¼˜åŒ–ä¸šåŠ¡æ–¹æ³•æµç¨‹ã€‚</li></ul><h2 id="æ¶ˆè´¹è€…ä¸-topic-çš„åˆ†åŒºåˆ†é…ç­–ç•¥æœ‰å“ªäº›" tabindex="-1"><a class="header-anchor" href="#æ¶ˆè´¹è€…ä¸-topic-çš„åˆ†åŒºåˆ†é…ç­–ç•¥æœ‰å“ªäº›"><span>æ¶ˆè´¹è€…ä¸ topic çš„åˆ†åŒºåˆ†é…ç­–ç•¥æœ‰å“ªäº›ï¼Ÿ</span></a></h2><p>ç­”æ¡ˆï¼š<br><img src="https://cdn.nlark.com/yuque/0/2022/png/21503536/1666966943464-979b5978-dc65-48ad-ba95-3f3ccb6648e8.png#clientId=ua41a3794-5c73-4&amp;from=paste&amp;height=232&amp;id=u0e06b4cd&amp;originHeight=458&amp;originWidth=1080&amp;originalType=url&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;status=done&amp;style=none&amp;taskId=u2cbc278f-c674-4f59-a34b-5caaf830382&amp;title=&amp;width=547" alt="" loading="lazy"><br><strong>1ã€RangeAssignor åˆ†é…ç­–ç•¥</strong><br>è¯¥åˆ†é…ç­–ç•¥æ˜¯æŒ‰ç…§<strong>æ¶ˆè´¹è€…æ€»æ•°å’Œåˆ†åŒºæ€»æ•°è¿›è¡Œæ•´é™¤è¿ç®—</strong>æ¥è·å¾—ä¸€ä¸ªè·¨åº¦ï¼Œç„¶ååˆ†åŒºæŒ‰ç…§è·¨åº¦æ¥è¿›è¡Œå¹³å‡åˆ†é…ï¼Œå°½å¯èƒ½ä¿è¯åˆ†åŒºå‡åŒ€çš„åˆ†é…ç»™æ‰€æœ‰çš„æ¶ˆè´¹è€…ã€‚<br>å¯¹äºæ¯ä¸ª topicï¼Œè¯¥ç­–ç•¥ä¼šè®²æ¶ˆè´¹è€…ç»„å†…æ‰€æœ‰è®¢é˜…è¿™ä¸ªä¸»é¢˜çš„æ¶ˆè´¹è€…<strong>æŒ‰ç…§åç§°çš„å­—å…¸é¡ºåºæ’åº</strong>ï¼Œç„¶åä¸ºæ¯ä¸ªæ¶ˆè´¹è€…åˆ’åˆ†å›ºå®šè¿‡çš„åŒºåŸŸï¼Œ<strong>å¦‚æœä¸å¤Ÿå¹³å‡åˆ†é…ï¼Œé‚£ä¹ˆå­—å…¸æ’åºè€ƒå‰çš„å°±ä¼šå¤šåˆ†é…ä¸€ä¸ªåˆ†åŒº</strong>ã€‚<br>æ¯”å¦‚ 2 ä¸ªæ¶ˆè´¹è€…å±äºä¸€ä¸ªæ¶ˆè´¹è€…ç»„ï¼Œæœ‰ 2 ä¸ª topic t1ï¼Œt2ï¼Œæ¯ä¸ª topic éƒ½æœ‰ 3 ä¸ªåˆ†åŒºï¼Œp1ï¼Œp2ï¼Œp3ï¼Œé‚£ä¹ˆåˆ†é…çš„æƒ…å†µå¦‚ä¸‹:</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>  æ¶ˆè´¹è€…A:t0-p0ï¼Œt0-p1ï¼Œt1-p0ï¼Œt1-p1ï¼Œ</span></span>
<span class="line"><span>  æ¶ˆè´¹è€…B:t0-p2ï¼Œt1-p2</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™æ ·å°±ä¼šå‡ºç°éé…ä¸å‡åŒ€çš„æƒ…å†µ</p><p><strong>2ã€RoundRobinAssignor åˆ†é…ç­–ç•¥</strong><br>è¯¥åˆ†é…ç­–ç•¥æ˜¯<strong>æŒ‰å°†æ¶ˆè´¹è€…ç»„å†…æ‰€æœ‰æ¶ˆè´¹è€…åŠæ¶ˆè´¹è€…è®¢é˜…çš„æ‰€æœ‰ä¸»é¢˜çš„åˆ†åŒºæŒ‰ç…§å­—å…¸æ’åºï¼Œç„¶åé€šè¿‡è½®è¯¢çš„æ–¹å¼åˆ†é…ç»™æ¯ä¸ªæ¶ˆè´¹è€…</strong>ã€‚<br>æ¯”å¦‚æœ‰ 3 ä¸ªæ¶ˆè´¹è€… Aï¼ŒBï¼ŒCï¼Œè®¢é˜…äº† 3 ä¸ª topic ï¼Œt0ï¼Œt1ï¼Œt2ï¼Œæ¯ä¸ª topic å„æœ‰ 3 ä¸ªåˆ†åŒº p0ï¼Œp1ï¼Œp2ã€‚å¦‚æœ A è®¢é˜…äº† t0ï¼ŒB è®¢é˜…äº† t0 å’Œ t1ï¼ŒC è®¢é˜…äº† t0ï¼Œt1ï¼Œt2ï¼Œé‚£ä¹ˆåˆ†é…çš„æƒ…å†µå¦‚ä¸‹:</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>  æ¶ˆè´¹è€…A:t0-p0</span></span>
<span class="line"><span>  æ¶ˆè´¹è€…B:t1-p0</span></span>
<span class="line"><span>  æ¶ˆè´¹è€…C:t1-p1ï¼Œt2-p0ï¼Œt2-p1ï¼Œt2-p2</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™æ ·ä¹Ÿä¼šå‡ºç°åˆ†é…ä¸å‡åŒ€çš„æƒ…å†µï¼ŒæŒ‰ç…§è®¢é˜…æƒ…å†µæ¥è®²å®Œå…¨å¯ä»¥å§ t1p1 åˆ†é…ç»™æ¶ˆè´¹è€…B</p><p><strong>3ã€StickyAssignoråˆ†é…ç­–ç•¥</strong><br>è¿™ç§åˆ†é…ç­–ç•¥æœ‰ä¸¤ä¸ªç›®çš„</p><ul><li>åˆ†åŒºçš„åˆ†é…è¦å°½å¯èƒ½çš„å‡åŒ€</li><li>åˆ†åŒºçš„åˆ†é…å°½å¯èƒ½çš„ä¸ä¸Šæ¬¡åˆ†é…çš„ä¿æŒç›¸åŒã€‚</li></ul><p>å½“ä¸¤è€…å‘ç”Ÿå†²çªæ—¶ï¼Œç¬¬ä¸€ä¸ªç›®æ ‡ä¼˜å…ˆäºç¬¬äºŒä¸ªç›®æ ‡ã€‚<br>å‡è®¾æ¶ˆè´¹ç»„å†…æœ‰3ä¸ªæ¶ˆè´¹è€…ï¼š**C0ã€C1ã€C2ï¼Œ**å®ƒä»¬éƒ½è®¢é˜…äº†4ä¸ªä¸»é¢˜ï¼š<strong>t0ã€t1ã€t2ã€t3</strong> <br>å¹¶ä¸”æ¯ä¸ªä¸»é¢˜æœ‰2ä¸ªåˆ†åŒºï¼Œä¹Ÿå°±æ˜¯è¯´æ•´ä¸ªæ¶ˆè´¹ç»„è®¢é˜…äº†ï¼Œ<strong>t0p0ã€t0p1ã€t1p0ã€t1p1ã€t2p0ã€t2p1ã€t3p0ã€t3p1</strong> è¿™8ä¸ªåˆ†åŒºã€‚<br> æœ€ç»ˆçš„åˆ†é…ç»“æœå¦‚ä¸‹ï¼š</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>æ¶ˆè´¹è€…C0ï¼št0p0ã€t1p1ã€t3p0</span></span>
<span class="line"><span></span></span>
<span class="line"><span>æ¶ˆè´¹è€…C1ï¼št0p1ã€t2p0ã€t3p1</span></span>
<span class="line"><span></span></span>
<span class="line"><span>æ¶ˆè´¹è€…C2ï¼št1p0ã€t2p1</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™æ ·åˆçœ‹ä¸Šå»ä¼¼ä¹ä¸é‡‡ç”¨RoundRobinAssignorç­–ç•¥æ‰€åˆ†é…çš„ç»“æœç›¸åŒ<br>æ­¤æ—¶å‡è®¾æ¶ˆè´¹è€…C1è„±ç¦»äº†æ¶ˆè´¹ç»„ï¼Œé‚£ä¹ˆæ¶ˆè´¹ç»„å°±ä¼šæ‰§è¡Œå†å¹³è¡¡æ“ä½œï¼Œè¿›è€Œæ¶ˆè´¹åˆ†åŒºä¼šé‡æ–°åˆ†é…ã€‚å¦‚æœé‡‡ç”¨RoundRobinAssignorç­–ç•¥ï¼Œé‚£ä¹ˆæ­¤æ—¶çš„åˆ†é…ç»“æœå¦‚ä¸‹ï¼š</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>æ¶ˆè´¹è€…C0ï¼št0p0ã€t1p0ã€t2p0ã€t3p0</span></span>
<span class="line"><span></span></span>
<span class="line"><span>æ¶ˆè´¹è€…C2ï¼št0p1ã€t1p1ã€t2p1ã€t3p1</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¦‚åˆ†é…ç»“æœæ‰€ç¤ºï¼ŒRoundRobinAssignorç­–ç•¥ä¼šæŒ‰ç…§æ¶ˆè´¹è€…C0å’ŒC2è¿›è¡Œé‡æ–°è½®è¯¢åˆ†é…ã€‚è€Œå¦‚æœæ­¤æ—¶ä½¿ç”¨çš„æ˜¯StickyAssignorç­–ç•¥ï¼Œé‚£ä¹ˆåˆ†é…ç»“æœä¸ºï¼š</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>æ¶ˆè´¹è€…C0ï¼št0p0ã€t1p1ã€t3p0ã€t2p0</span></span>
<span class="line"><span></span></span>
<span class="line"><span>æ¶ˆè´¹è€…C2ï¼št1p0ã€t2p1ã€t0p1ã€t3p1</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¯ä»¥çœ‹åˆ°åˆ†é…ç»“æœä¸­ä¿ç•™äº†ä¸Šä¸€æ¬¡åˆ†é…ä¸­å¯¹äºæ¶ˆè´¹è€…C0å’ŒC2çš„æ‰€æœ‰åˆ†é…ç»“æœï¼Œå¹¶å°†åŸæ¥æ¶ˆè´¹è€…C1çš„â€œè´Ÿæ‹…â€åˆ†é…ç»™äº†å‰©ä½™çš„ä¸¤ä¸ªæ¶ˆè´¹è€…C0å’ŒC2ï¼Œæœ€ç»ˆC0å’ŒC2çš„åˆ†é…è¿˜ä¿æŒäº†å‡è¡¡ã€‚</p><p><strong>å¦‚æœå‘ç”Ÿåˆ†åŒºé‡åˆ†é…ï¼Œé‚£ä¹ˆå¯¹äºåŒä¸€ä¸ªåˆ†åŒºè€Œè¨€æœ‰å¯èƒ½ä¹‹å‰çš„æ¶ˆè´¹è€…å’Œæ–°æŒ‡æ´¾çš„æ¶ˆè´¹è€…ä¸æ˜¯åŒä¸€ä¸ªï¼Œå¯¹äºä¹‹å‰æ¶ˆè´¹è€…è¿›è¡Œåˆ°ä¸€åŠçš„å¤„ç†è¿˜è¦åœ¨æ–°æŒ‡æ´¾çš„æ¶ˆè´¹è€…ä¸­å†æ¬¡å¤ç°ä¸€éï¼Œè¿™æ˜¾ç„¶å¾ˆæµªè´¹ç³»ç»Ÿèµ„æºã€‚StickyAssignorç­–ç•¥å¦‚åŒå…¶åç§°ä¸­çš„â€œstickyâ€ä¸€æ ·ï¼Œè®©åˆ†é…ç­–ç•¥å…·å¤‡ä¸€å®šçš„â€œç²˜æ€§â€ï¼Œå°½å¯èƒ½åœ°è®©å‰åä¸¤æ¬¡åˆ†é…ç›¸åŒï¼Œè¿›è€Œå‡å°‘ç³»ç»Ÿèµ„æºçš„æŸè€—ä»¥åŠå…¶å®ƒå¼‚å¸¸æƒ…å†µçš„å‘ç”Ÿ</strong>ã€‚</p><p>åˆ°ç›®å‰ä¸ºæ­¢æ‰€åˆ†æçš„éƒ½æ˜¯æ¶ˆè´¹è€…çš„è®¢é˜…ä¿¡æ¯éƒ½æ˜¯ç›¸åŒçš„æƒ…å†µï¼Œæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹è®¢é˜…ä¿¡æ¯ä¸åŒçš„æƒ…å†µä¸‹çš„å¤„ç†ã€‚<br>ä¸¾ä¾‹ï¼šåŒæ ·æ¶ˆè´¹ç»„å†…æœ‰3ä¸ªæ¶ˆè´¹è€…ï¼š<strong>C0ã€C1ã€C2</strong> <br>é›†ç¾¤ä¸­æœ‰3ä¸ªä¸»é¢˜ <strong>t0ã€t1ã€t2</strong> <br>è¿™3ä¸ªä¸»é¢˜åˆ†åˆ«æœ‰ <strong>1ã€2ã€3</strong>ä¸ªåˆ†åŒº <br>ä¹Ÿå°±æ˜¯è¯´é›†ç¾¤ä¸­æœ‰ <strong>t0p0ã€t1p0ã€t1p1ã€t2p0ã€t2p1ã€t2p2</strong> è¿™6ä¸ªåˆ†åŒº <br>æ¶ˆè´¹è€…<strong>C0è®¢é˜…äº†ä¸»é¢˜t0ï¼Œæ¶ˆè´¹è€…C1è®¢é˜…äº†ä¸»é¢˜t0å’Œt1ï¼Œæ¶ˆè´¹è€…C2è®¢é˜…äº†ä¸»é¢˜t0ã€t1å’Œt2</strong> <br>å¦‚æœæ­¤æ—¶é‡‡ç”¨RoundRobinAssignorç­–ç•¥ï¼š</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>æ¶ˆè´¹è€…C0ï¼št0p0</span></span>
<span class="line"><span></span></span>
<span class="line"><span>æ¶ˆè´¹è€…C1ï¼št1p0</span></span>
<span class="line"><span></span></span>
<span class="line"><span>æ¶ˆè´¹è€…C2ï¼št1p1ã€t2p0ã€t2p1ã€t2p2</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¦‚æœæ­¤æ—¶é‡‡ç”¨çš„æ˜¯StickyAssignorç­–ç•¥ï¼š</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>æ¶ˆè´¹è€…C0ï¼št0p0</span></span>
<span class="line"><span></span></span>
<span class="line"><span>æ¶ˆè´¹è€…C1ï¼št1p0ã€t1p1</span></span>
<span class="line"><span></span></span>
<span class="line"><span>æ¶ˆè´¹è€…C2ï¼št2p0ã€t2p1ã€t2p2</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ­¤æ—¶æ¶ˆè´¹è€…C0è„±ç¦»äº†æ¶ˆè´¹ç»„ï¼Œé‚£ä¹ˆRoundRobinAssignorç­–ç•¥çš„åˆ†é…ç»“æœä¸ºï¼š</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>æ¶ˆè´¹è€…C1ï¼št0p0ã€t1p1</span></span>
<span class="line"><span></span></span>
<span class="line"><span>æ¶ˆè´¹è€…C2ï¼št1p0ã€t2p0ã€t2p1ã€t2p2</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>StickyAssignorç­–ç•¥ï¼Œé‚£ä¹ˆåˆ†é…ç»“æœä¸ºï¼š</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>æ¶ˆè´¹è€…C1ï¼št1p0ã€t1p1ã€t0p0</span></span>
<span class="line"><span></span></span>
<span class="line"><span>æ¶ˆè´¹è€…C2ï¼št2p0ã€t2p1ã€t2p2</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¯ä»¥çœ‹åˆ°StickyAssignorç­–ç•¥ä¿ç•™äº†æ¶ˆè´¹è€…C1å’ŒC2ä¸­åŸæœ‰çš„5ä¸ªåˆ†åŒºçš„åˆ†é…ï¼š</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>t1p0ã€t1p1ã€t2p0ã€t2p1ã€t2p2ã€‚</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>ä»ç»“æœä¸Šçœ‹StickyAssignorç­–ç•¥æ¯”å¦å¤–ä¸¤è€…åˆ†é…ç­–ç•¥è€Œè¨€æ˜¾å¾—æ›´åŠ çš„ä¼˜å¼‚ï¼Œè¿™ä¸ªç­–ç•¥çš„ä»£ç å®ç°ä¹Ÿæ˜¯å¼‚å¸¸å¤æ‚ã€‚</p><p><strong>4ã€è‡ªå®šä¹‰åˆ†åŒºåˆ†é…ç­–ç•¥</strong><br>å¯ä»¥é€šè¿‡å®ç° org.apache.kafka.clients.consumer.internals.PartitionAssignor æ¥å£æ¥å®ç°</p><h2 id="kafka-æ§åˆ¶å™¨æœ‰ä»€ä¹ˆä½œç”¨" tabindex="-1"><a class="header-anchor" href="#kafka-æ§åˆ¶å™¨æœ‰ä»€ä¹ˆä½œç”¨"><span><strong>Kafka æ§åˆ¶å™¨æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ</strong><br><br></span></a></h2><p>ç­”æ¡ˆï¼š<br>åœ¨ Kafka é›†ç¾¤ä¸­ä¼šæœ‰ä¸€ä¸ªæˆ–å¤šä¸ª brokerï¼Œå…¶ä¸­æœ‰ä¸€ä¸ª broker ä¼šè¢«é€‰ä¸¾ä¸ºæ§åˆ¶å™¨ï¼Œ<strong>å®ƒè´Ÿè´£ç®¡ç†æ•´ä¸ªé›†ç¾¤ä¸­æ‰€æœ‰åˆ†åŒºå’Œå‰¯æœ¬çš„çŠ¶æ€</strong>ï¼Œkafka é›†ç¾¤ä¸­<strong>åªèƒ½æœ‰ä¸€ä¸ªæ§åˆ¶å™¨</strong>ã€‚</p><ul><li>å½“æŸä¸ªåˆ†åŒºçš„ leader å‰¯æœ¬å‡ºç°æ•…éšœæ—¶ï¼Œç”±æ§åˆ¶å™¨è´Ÿè´£<strong>ä¸ºè¯¥åˆ†åŒºé€‰ä¸¾æ–°çš„ leader å‰¯æœ¬</strong>ã€‚</li><li>å½“æ£€æµ‹åˆ°æŸä¸ªåˆ†åŒºçš„ISRé›†åˆå‘ç”Ÿå˜åŒ–æ—¶ï¼Œç”±æ§åˆ¶å™¨<strong>é€šçŸ¥æ‰€æœ‰ broker æ›´æ–°å…¶å…ƒæ•°æ®ä¿¡æ¯</strong>ã€‚</li><li>å½“ä¸ºæŸä¸ª topic å¢åŠ åˆ†åŒºæ•°é‡æ—¶ï¼Œç”±æ§åˆ¶å™¨<strong>è´Ÿè´£åˆ†åŒºçš„é‡æ–°åˆ†é…</strong>ã€‚</li></ul><h2 id="kafka-æ§åˆ¶å™¨å¦‚ä½•è¿›è¡Œé€‰ä¸¾" tabindex="-1"><a class="header-anchor" href="#kafka-æ§åˆ¶å™¨å¦‚ä½•è¿›è¡Œé€‰ä¸¾"><span><strong>kafka æ§åˆ¶å™¨å¦‚ä½•è¿›è¡Œé€‰ä¸¾ï¼Ÿ</strong><br><br></span></a></h2><p>ç­”æ¡ˆï¼š<br>kafka ä¸­çš„æ§åˆ¶å™¨é€‰ä¸¾å·¥ä½œ<strong>ä¾èµ–äº Zookeeper</strong>ï¼ŒæˆåŠŸç«é€‰æˆä¸ºæ§åˆ¶å™¨çš„ broker ä¼šåœ¨Zookeeperä¸­åˆ›å»º/controllerä¸´æ—¶èŠ‚ç‚¹ã€‚<br>æ¯ä¸ª broker å¯åŠ¨çš„æ—¶å€™ä¼šå»å°è¯•è¯»å–/controller èŠ‚ç‚¹çš„ brokeridçš„å€¼</p><ul><li><strong>å¦‚æœ</strong>è¯»å–åˆ°çš„ <strong>brokerid çš„å€¼ä¸ä¸º-1</strong>ï¼Œè¡¨ç¤ºå·²ç»æœ‰å…¶ä»–broker èŠ‚ç‚¹æˆåŠŸç«é€‰ä¸ºæ§åˆ¶å™¨ï¼Œæ‰€ä»¥å½“å‰ broker <strong>å°±ä¼šæ”¾å¼ƒç«é€‰</strong>ï¼›</li></ul><p>å¦‚æœZookeeperä¸­<strong>ä¸å­˜åœ¨</strong>/controller èŠ‚ç‚¹ï¼Œ<strong>æˆ–è€…</strong>è¿™ä¸ªèŠ‚ç‚¹çš„æ•°æ®<strong>å¼‚å¸¸</strong>ï¼Œé‚£ä¹ˆ<strong>å°±ä¼šå°è¯•å»åˆ›å»º</strong>/controller èŠ‚ç‚¹ï¼Œ<strong>åˆ›å»ºæˆåŠŸçš„é‚£ä¸ª broker å°±ä¼šæˆä¸ºæ§åˆ¶å™¨</strong>ã€‚<br>æ¯ä¸ª broker éƒ½ä¼šåœ¨å†…å­˜ä¸­ä¿å­˜å½“å‰æ§åˆ¶å™¨çš„ brokerid å€¼ï¼Œè¿™ä¸ªå€¼å¯ä»¥æ ‡è¯†ä¸º activeControllerIdã€‚<br>Zookeeper ä¸­è¿˜æœ‰ä¸€ä¸ªä¸æ§åˆ¶å™¨æœ‰å…³çš„/controller_epoch èŠ‚ç‚¹ï¼Œè¿™ä¸ªèŠ‚ç‚¹æ˜¯<strong>æŒä¹…èŠ‚ç‚¹</strong>ï¼ŒèŠ‚ç‚¹ä¸­å­˜æ”¾çš„æ˜¯ä¸€ä¸ªæ•´å‹çš„ controller_epoch å€¼ã€‚controller_epoch å€¼ç”¨äº<strong>è®°å½•æ§åˆ¶å™¨å‘ç”Ÿå˜æ›´çš„æ¬¡æ•°</strong>ã€‚<br>controller_epoch çš„<strong>åˆå§‹å€¼ä¸º1</strong>ï¼Œå³é›†ç¾¤ä¸­çš„ç¬¬ä¸€ä¸ªæ§åˆ¶å™¨çš„çºªå…ƒä¸º1ï¼Œå½“æ§åˆ¶å™¨å‘ç”Ÿå˜æ›´æ—¶ï¼Œ<strong>æ¯é€‰å‡ºä¸€ä¸ªæ–°çš„æ§åˆ¶å™¨å°±å°†è¯¥å­—æ®µå€¼åŠ 1</strong>ã€‚<br>æ¯ä¸ªå’Œæ§åˆ¶å™¨äº¤äº’çš„è¯·æ±‚éƒ½ä¼šæºå¸¦ controller_epoch è¿™ä¸ªå­—æ®µï¼Œ</p><ul><li><strong>å¦‚æœè¯·æ±‚çš„ controller_epoch å€¼</strong>å°äº<strong>å†…å­˜ä¸­çš„ controller_epochå€¼</strong>ï¼Œ<strong>åˆ™</strong>è®¤ä¸ºè¿™ä¸ªè¯·æ±‚æ˜¯å‘å·²ç»è¿‡æœŸçš„æ§åˆ¶å™¨å‘é€çš„è¯·æ±‚ï¼Œé‚£ä¹ˆè¿™ä¸ªè¯·æ±‚ä¼š<strong>è¢«è®¤å®šä¸ºæ— æ•ˆçš„è¯·æ±‚</strong>ã€‚</li><li>å¦‚æœè¯·æ±‚çš„ controller_epoch å€¼<strong>å¤§äº</strong>å†…å­˜ä¸­çš„ controller_epochå€¼ï¼Œé‚£ä¹ˆè¯´æ˜<strong>å·²ç»æœ‰æ–°çš„æ§åˆ¶å™¨å½“é€‰</strong>äº†</li></ul><h2 id="å¦‚ä½•ä¿è¯æ¶ˆæ¯ä¸ä¸¢å¤±" tabindex="-1"><a class="header-anchor" href="#å¦‚ä½•ä¿è¯æ¶ˆæ¯ä¸ä¸¢å¤±"><span><strong>å¦‚ä½•ä¿è¯æ¶ˆæ¯ä¸ä¸¢å¤±?</strong><br><br></span></a></h2><p>ç­”æ¡ˆï¼š<br>Kafka æœ‰ä¸‰æ¬¡æ¶ˆæ¯ä¼ é€’çš„è¿‡ç¨‹ï¼šç”Ÿäº§è€…å‘æ¶ˆæ¯ç»™ Brokerã€Broker åŒæ­¥æ¶ˆæ¯å’ŒæŒä¹…åŒ–æ¶ˆæ¯ã€Broker å°†æ¶ˆæ¯ä¼ é€’ç»™æ¶ˆè´¹è€…ã€‚<br>è¿™å…¶ä¸­æ¯ä¸€æ­¥éƒ½æœ‰å¯èƒ½ä¸¢å¤±æ¶ˆæ¯ï¼š</p><p><strong>1ã€ç”Ÿäº§è€…å‘é€æ•°æ®</strong></p><ul><li>å½“ acks ä¸º 0ï¼Œ<strong>åªè¦æœåŠ¡ç«¯å†™æ¶ˆæ¯æ—¶å‡ºç°ä»»ä½•é—®é¢˜ï¼Œéƒ½ä¼šå¯¼è‡´æ¶ˆæ¯ä¸¢å¤±</strong>ã€‚</li><li>å½“ acks é…ç½®ä¸º 1 æ—¶ï¼Œç”Ÿäº§è€…å‘é€æ¶ˆæ¯ï¼Œåªè¦ leader å‰¯æœ¬æˆåŠŸå†™å…¥æ¶ˆæ¯ï¼Œå°±ä»£è¡¨æˆåŠŸã€‚è¿™ç§æ–¹æ¡ˆçš„é—®é¢˜åœ¨äºï¼Œå½“è¿”å›æˆåŠŸåï¼Œ<strong>å¦‚æœ leader å‰¯æœ¬å’Œ follower å‰¯æœ¬è¿˜æ²¡æœ‰æ¥å¾—åŠåŒæ­¥ï¼Œleader å´©æºƒäº†ï¼Œé‚£ä¹ˆåœ¨é€‰ä¸¾åçš„æ–° leader æ²¡æœ‰è¿™æ¡æ¶ˆæ¯ï¼Œä¹Ÿå°±ä¸¢å¤±äº†</strong>ã€‚</li></ul><div class="hint-container info"><p class="hint-container-title">ç›¸å…³ä¿¡æ¯</p><p>é€šè¿‡åœ¨ producer ç«¯è®¾ç½® acks=all æ¥å¤„ç†ï¼Œè¿™ä¸ªå‚æ•°æ˜¯è¦æ±‚ leader æ¥æ”¶åˆ°æ¶ˆæ¯åï¼Œéœ€è¦ç­‰åˆ°æ‰€æœ‰çš„ follower éƒ½åŒæ­¥åˆ°äº†æ¶ˆæ¯ä¹‹åï¼Œæ‰è®¤ä¸ºæœ¬æ¬¡å†™æˆåŠŸäº†ã€‚å¦‚æœæ²¡æ»¡è¶³è¿™ä¸ªæ¡ä»¶ï¼Œç”Ÿäº§è€…ä¼šè‡ªåŠ¨ä¸æ–­çš„é‡è¯•ã€‚</p></div><p><strong>2ã€Broker å­˜å‚¨æ•°æ®</strong><br> kafka é€šè¿‡ Page Cache å°†æ•°æ®å†™å…¥ç£ç›˜ã€‚<br> Page Cache å°±æ˜¯å½“å¾€ç£ç›˜æ–‡ä»¶å†™å…¥çš„æ—¶å€™ï¼Œç³»ç»Ÿä¼šå…ˆå°†æ•°æ®æµå†™å…¥ç¼“å­˜ä¸­ï¼Œä½†æ˜¯<strong>ä»€ä¹ˆæ—¶å€™å°†ç¼“å­˜çš„æ•°æ®å†™å…¥ç£ç›˜æ–‡ä»¶ä¸­æ˜¯ç”±æ“ä½œç³»ç»Ÿè‡ªè¡Œå†³å®š</strong>ã€‚æ‰€ä»¥<strong>å¦‚æœæ­¤æ—¶æœºå™¨çªç„¶æŒ‚äº†ï¼Œä¹Ÿä¼šä¸¢å¤±æ¶ˆæ¯</strong>ã€‚<br>å¯¹äºè¿™ä¸ªé—®é¢˜ï¼Œ Kafka å¯ä»¥è®¾ç½®å¦‚ä¸‹ 4 ä¸ªå‚æ•°ï¼Œæ¥å°½é‡é¿å…æ¶ˆæ¯ä¸¢å¤±ï¼š</p><ul><li>ç»™ topic è®¾ç½® replication.factor å‚æ•°ï¼šè¿™ä¸ªå€¼å¿…é¡»å¤§äº 1 ï¼Œè¦æ±‚æ¯ä¸ª partition å¿…é¡»æœ‰è‡³å°‘ 2 ä¸ªå‰¯æœ¬ï¼›</li><li>åœ¨ Kafka æœåŠ¡ç«¯è®¾ç½® min.insync.replicas å‚æ•°ï¼šè¿™ä¸ªå€¼å¿…é¡»å¤§äº 1 ï¼Œè¿™ä¸ªå‚æ•°çš„å«ä¹‰æ˜¯ä¸€ä¸ªleader è‡³å°‘æ„ŸçŸ¥åˆ°æœ‰è‡³å°‘ä¸€ä¸ª follower è¿˜è·Ÿè‡ªå·±ä¿æŒè”ç³»ï¼Œæ²¡æ‰é˜Ÿï¼Œè¿™æ ·æ‰èƒ½ç¡®ä¿ leaderæŒ‚äº†è¿˜æœ‰ä¸€ä¸ª follower èŠ‚ç‚¹ã€‚</li><li>åœ¨ producer ç«¯è®¾ç½® acks=all ï¼Œè¿™ä¸ªæ˜¯è¦æ±‚æ¯æ¡æ•°æ®ï¼Œå¿…é¡»æ˜¯å†™å…¥æ‰€æœ‰ replica ä¹‹åï¼Œæ‰èƒ½è®¤ä¸ºæ˜¯å†™æˆåŠŸäº†ï¼›</li><li>åœ¨ producer ç«¯è®¾ç½® retries=MAX ï¼ˆå¾ˆå¤§å¾ˆå¤§å¾ˆå¤§çš„ä¸€ä¸ªå€¼ï¼Œæ— é™æ¬¡é‡è¯•çš„æ„æ€ï¼‰ï¼šè¿™ä¸ªå‚æ•°çš„å«ä¹‰æ˜¯ä¸€æ—¦å†™å…¥å¤±è´¥ï¼Œå°±æ— é™é‡è¯•ï¼Œå¡åœ¨è¿™é‡Œäº†ã€‚</li></ul><p><strong>3ã€æ¶ˆè´¹è€…æ¶ˆè´¹æ•°æ®</strong><br> <strong>å¼€å¯è‡ªåŠ¨æäº¤ offset</strong>ï¼Œåªè¦æ¶ˆè´¹è€…æ¶ˆè´¹åˆ°æ¶ˆæ¯ï¼Œé‚£ä¹ˆå°±ä¼šè‡ªåŠ¨æäº¤åç§»é‡ï¼Œ<strong>å¦‚æœä¸šåŠ¡è¿˜æ²¡æœ‰æ¥å¾—åŠå¤„ç†ï¼Œé‚£ä¹ˆæ¶ˆæ¯å°±ä¼šä¸¢å¤±</strong>ã€‚<br>åªè¦å…³é—­è‡ªåŠ¨æäº¤ offset ï¼Œæ¶ˆè´¹è€…åœ¨å¤„ç†å®Œä¹‹åæ‰‹åŠ¨æäº¤ offset ï¼Œå°±å¯ä»¥ä¿è¯æ¶ˆæ¯ä¸ä¼šä¸¢å¤±ã€‚ä½†æ˜¯æ­¤æ—¶éœ€è¦æ³¨æ„é‡å¤æ¶ˆè´¹é—®é¢˜ï¼Œæ¯”å¦‚æ¶ˆè´¹è€…åˆšå¤„ç†å®Œï¼Œè¿˜æ²¡æäº¤ offset ï¼Œè¿™æ—¶è‡ªå·±å®•æœºäº†ï¼Œæ­¤æ—¶è¿™æ¡æ¶ˆæ¯è‚¯å®šè¢«é‡å¤æ¶ˆè´¹ä¸€æ¬¡ï¼Œè¿™å°±éœ€è¦æ¶ˆè´¹è€…æ ¹æ®å®é™…æƒ…å†µä¿è¯å¹‚ç­‰æ€§ã€‚</p><p>æ›´å¤šèµ„æ–™å‚è€ƒæ–‡ç« ï¼š <a href="https://mp.weixin.qq.com/s/ppJ6asrbT-r3_9T3SHOGTw" target="_blank" rel="noopener noreferrer">ç¡¬æ ¸ | Kafka å¦‚ä½•è§£å†³æ¶ˆæ¯ä¸ä¸¢å¤±ï¼Ÿ</a></p><h2 id="å¦‚ä½•ä¿è¯æ¶ˆæ¯çš„é¡ºåºæ€§" tabindex="-1"><a class="header-anchor" href="#å¦‚ä½•ä¿è¯æ¶ˆæ¯çš„é¡ºåºæ€§"><span>å¦‚ä½•ä¿è¯æ¶ˆæ¯çš„é¡ºåºæ€§ï¼Ÿ</span></a></h2><p>ç­”æ¡ˆï¼š<br>åœ¨æŸäº›ä¸šåŠ¡åœºæ™¯ä¸‹ï¼Œæˆ‘ä»¬éœ€è¦ä¿è¯å¯¹äºæœ‰é€»è¾‘å…³è”çš„å¤šæ¡MQæ¶ˆæ¯è¢«æŒ‰é¡ºåºå¤„ç†ï¼Œæ¯”å¦‚å¯¹äºæŸä¸€æ¡æ•°æ®ï¼Œæ­£å¸¸å¤„ç†é¡ºåºæ˜¯ æ–°å¢-æ›´æ–°-åˆ é™¤ ï¼Œæœ€ç»ˆç»“æœæ˜¯æ•°æ®è¢«åˆ é™¤ã€‚å¦‚æœæ¶ˆæ¯æ²¡æœ‰æŒ‰åºæ¶ˆè´¹ï¼Œå¤„ç†é¡ºåºå¯èƒ½æ˜¯ åˆ é™¤-æ–°å¢-æ›´æ–° ï¼Œæœ€ç»ˆæ•°æ®æ²¡æœ‰è¢«åˆ æ‰ï¼Œå¯èƒ½ä¼šäº§ç”Ÿä¸€äº›é€»è¾‘é”™è¯¯ã€‚å¯¹äºå¦‚ä½•ä¿è¯æ¶ˆæ¯çš„é¡ºåºæ€§ï¼Œä¸»è¦éœ€è¦è€ƒè™‘å¦‚ä¸‹ä¸¤ç‚¹ï¼š <br><strong>1ã€å¦‚ä½•ä¿è¯æ¶ˆæ¯åœ¨ Kafka ä¸­é¡ºåºæ€§</strong><br>å¯¹äº Kafka ï¼Œå¦‚æœæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ª topic ï¼Œé»˜è®¤æœ‰ä¸‰ä¸ª partition åˆ†åŒºã€‚ç”Ÿäº§è€…åœ¨å†™æ•°æ®çš„æ—¶å€™ï¼Œå¯ä»¥æŒ‡å®šä¸€ä¸ª key ï¼Œæ¯”å¦‚åœ¨è®¢å• topic ä¸­æˆ‘ä»¬å¯ä»¥æŒ‡å®šè®¢å• id ä½œä¸º key ï¼Œé‚£ä¹ˆç›¸åŒè®¢å• id çš„æ•°æ®ï¼Œä¼šè¢«åˆ†å‘åˆ°åŒä¸€ä¸ª partition ä¸­ï¼Œè¿™ä¸ª partition ä¸­çš„æ•°æ®ä¸€å®šæ˜¯æœ‰é¡ºåºçš„ã€‚æ¶ˆè´¹è€…ä»partition ä¸­å–å‡ºæ¥æ•°æ®çš„æ—¶å€™ï¼Œä¹Ÿä¸€å®šæ˜¯æœ‰é¡ºåºçš„ã€‚é€šè¿‡åˆ¶å®š key çš„æ–¹å¼é¦–å…ˆå¯ä»¥ä¿è¯åœ¨ kafka å†…éƒ¨æ¶ˆæ¯æ˜¯æœ‰åºçš„ã€‚ <br><strong>2ã€å¦‚ä½•ä¿è¯æ¶ˆè´¹è€…å¤„ç†æ¶ˆè´¹çš„é¡ºåºæ€§</strong><br>å¯¹äºæŸä¸ª topic çš„ä¸€ä¸ª partition ï¼Œåªèƒ½è¢«åŒç»„å†…éƒ¨çš„ä¸€ä¸ª consumer æ¶ˆè´¹ï¼Œå¦‚æœè¿™ä¸ª consumerå†…éƒ¨è¿˜æ˜¯å•çº¿ç¨‹å¤„ç†ï¼Œé‚£ä¹ˆå…¶å®åªè¦ä¿è¯æ¶ˆæ¯åœ¨ MQ å†…éƒ¨æ˜¯æœ‰é¡ºåºçš„å°±å¯ä»¥ä¿è¯æ¶ˆè´¹ä¹Ÿæ˜¯æœ‰é¡ºåºçš„ã€‚ä½†æ˜¯å•çº¿ç¨‹ååé‡å¤ªä½ï¼Œåœ¨å¤„ç†å¤§é‡ MQ æ¶ˆæ¯æ—¶ï¼Œæˆ‘ä»¬ä¸€èˆ¬ä¼šå¼€å¯å¤šçº¿ç¨‹æ¶ˆè´¹æœºåˆ¶ï¼Œé‚£ä¹ˆå¦‚ä½•ä¿è¯æ¶ˆæ¯åœ¨å¤šä¸ªçº¿ç¨‹ä¹‹é—´æ˜¯è¢«é¡ºåºå¤„ç†çš„å‘¢ï¼Ÿå¯¹äºå¤šçº¿ç¨‹æ¶ˆè´¹æˆ‘ä»¬å¯ä»¥é¢„å…ˆè®¾ç½® N ä¸ªå†…å­˜ Queue ï¼Œå…·æœ‰ç›¸åŒ keyçš„æ•°æ®éƒ½æ”¾åˆ°åŒä¸€ä¸ªå†…å­˜ Queue ä¸­ï¼›ç„¶åå¼€å¯ N ä¸ªçº¿ç¨‹ï¼Œæ¯ä¸ªçº¿ç¨‹åˆ†åˆ«æ¶ˆè´¹ä¸€ä¸ªå†…å­˜ Queue çš„æ•°æ®å³å¯ï¼Œè¿™æ ·å°±èƒ½ä¿è¯é¡ºåºæ€§ã€‚å½“ç„¶ï¼Œæ¶ˆæ¯æ”¾åˆ°å†…å­˜ Queue ä¸­ï¼Œæœ‰å¯èƒ½è¿˜æœªè¢«å¤„ç†ï¼Œ consumer å‘ç”Ÿå®•æœºï¼Œå†…å­˜ Queue ä¸­çš„æ•°æ®ä¼šå…¨éƒ¨ä¸¢å¤±ï¼Œè¿™å°±è½¬å˜ä¸ºä¸Šé¢æåˆ°çš„å¦‚ä½•ä¿è¯æ¶ˆæ¯çš„å¯é ä¼ è¾“çš„é—®é¢˜äº†</p><h2 id="å…³äºkafka-é¢è¯•å®˜ä¸€èˆ¬å–œæ¬¢è€ƒå¯Ÿå“ªäº›é—®é¢˜" tabindex="-1"><a class="header-anchor" href="#å…³äºkafka-é¢è¯•å®˜ä¸€èˆ¬å–œæ¬¢è€ƒå¯Ÿå“ªäº›é—®é¢˜"><span><strong>å…³äºKafkaï¼Œé¢è¯•å®˜ä¸€èˆ¬å–œæ¬¢è€ƒå¯Ÿå“ªäº›é—®é¢˜ï¼Ÿ</strong></span></a></h2><p>ç­”æ¡ˆï¼š</p><ul><li>æ¶ˆæ¯å‹ç¼©</li><li>æ¶ˆæ¯è§£å‹ç¼©</li><li>åˆ†åŒºç­–ç•¥</li><li>ç”Ÿäº§è€…å¦‚ä½•å®ç°å¹‚ç­‰ã€äº‹åŠ¡</li><li>Kafka Broker æ˜¯å¦‚ä½•å­˜å‚¨æ•°æ®ï¼Ÿå¤‡ä»½æœºåˆ¶</li><li>ä¸ºä»€ä¹ˆè¦å¼•å…¥æ¶ˆè´¹ç»„ï¼Ÿ</li><li>è¯¦ç»†å†…å®¹ï¼Œå‚è€ƒä¹‹å‰å†™çš„ <a href="https://mp.weixin.qq.com/s?__biz=Mzg2NzYyNjQzNg==&amp;mid=2247485551&amp;idx=1&amp;sn=533259fc15567b9f44e169943be4a305&amp;scene=21#wechat_redirect" target="_blank" rel="noopener noreferrer">èŠèŠ Kafka é‚£ç‚¹ç ´äº‹ï¼</a></li></ul><h2 id="ä¸ºä»€ä¹ˆä¸æ”¯æŒè¯»å†™åˆ†ç¦»" tabindex="-1"><a class="header-anchor" href="#ä¸ºä»€ä¹ˆä¸æ”¯æŒè¯»å†™åˆ†ç¦»"><span><strong>ä¸ºä»€ä¹ˆä¸æ”¯æŒè¯»å†™åˆ†ç¦»ï¼Ÿ</strong></span></a></h2><p>ç­”æ¡ˆï¼š<br>Kafka <strong>ä¸æ”¯æŒè¯»å†™åˆ†ç¦»</strong>ï¼Œé‚£ä¹ˆè¯»å†™åˆ†ç¦»çš„å¥½å¤„æ˜¯ä»€ä¹ˆï¼Ÿä¸»è¦å°±æ˜¯è®©ä¸€ä¸ªèŠ‚ç‚¹å»æ‰¿æ‹…å¦ä¸€ä¸ªèŠ‚ç‚¹çš„è´Ÿè½½å‹åŠ›ï¼Œä¹Ÿå°±æ˜¯èƒ½åšåˆ°ä¸€å®šç¨‹åº¦çš„è´Ÿè½½å‡è¡¡ï¼Œè€Œä¸” Kafka ä¸é€šè¿‡è¯»å†™åˆ†ç¦»ä¹Ÿå¯ä»¥ä¸€å®šç¨‹åº¦ä¸Šå»å®ç°è´Ÿè½½å‡è¡¡ã€‚<br>ä½†æ˜¯å¯¹äº Kafka çš„æ¶æ„æ¥è¯´ï¼Œè¯»å†™åˆ†ç¦»æœ‰ä¸¤ä¸ªå¾ˆå¤§çš„<strong>ç¼ºç‚¹ï¼š</strong><br>1ã€æ•°æ®ä¸ä¸€è‡´çš„é—®é¢˜ã€‚ä¸€ä¸»å¤šä»ï¼Œleaderå‰¯æœ¬çš„æ•°æ®åŒæ­¥åˆ°followerå‰¯æœ¬æœ‰ä¸€å®šçš„å»¶æ—¶ï¼Œå› æ­¤æ¯ä¸ªfollowerå‰¯æœ¬çš„æ¶ˆæ¯ä½ç§»ä¹Ÿä¸ä¸€æ ·ï¼Œè€Œæ¶ˆè´¹ç«¯æ˜¯é€šè¿‡æ¶ˆè´¹ä½ç§»æ¥æ§åˆ¶æ¶ˆæ¯æ‹‰å–è¿›åº¦ï¼Œå¤šä¸ªå‰¯æœ¬é—´è¦ç»´æŠ¤åŒä¸€ä¸ªæ¶ˆè´¹ä½ç§»çš„ä¸€è‡´æ€§ã€‚å¦‚æœå¼•å…¥åˆ†å¸ƒå¼é”ï¼Œä¿è¯å¹¶å‘å®‰å…¨ï¼Œéå¸¸è€—è´¹æ€§èƒ½ã€‚<br>2ã€å®æ—¶æ€§ã€‚leaderå‰¯æœ¬çš„æ•°æ®åŒæ­¥åˆ°followerå‰¯æœ¬æœ‰ä¸€å®šçš„å»¶æ—¶ï¼Œå¦‚æœç½‘ç»œè¾ƒå·®ï¼Œå»¶è¿Ÿä¼šå¾ˆä¸¥é‡ï¼Œæ— æ³•æ»¡è¶³å®æ—¶æ€§ä¸šåŠ¡éœ€æ±‚ã€‚</p><p><strong>ç”Ÿäº§ç«¯å†™å…¥æ¶ˆæ¯ã€æ¶ˆè´¹ç«¯æ‹‰å–æ¶ˆæ¯éƒ½æ˜¯ä¸leader å‰¯æœ¬äº¤äº’çš„ï¼Œå¹¶æ²¡æœ‰åƒmysqlæ•°æ®åº“é‚£æ ·ï¼Œmasterè´Ÿè´£å†™ï¼Œslaveè´Ÿè´£è¯»ã€‚</strong></p><h2 id="ä¸ºä»€ä¹ˆé‡‡ç”¨-pull-æ¨¡å¼-è¿˜æ˜¯-push-æ¨¡å¼" tabindex="-1"><a class="header-anchor" href="#ä¸ºä»€ä¹ˆé‡‡ç”¨-pull-æ¨¡å¼-è¿˜æ˜¯-push-æ¨¡å¼"><span>ä¸ºä»€ä¹ˆé‡‡ç”¨ Pull æ¨¡å¼ï¼Œè¿˜æ˜¯ Push æ¨¡å¼ï¼Ÿ<br><br></span></a></h2><p>ç­”æ¡ˆï¼š<br>æ¶ˆè´¹è€…ä½¿ç”¨pullæ¨¡å¼ä» Broker è®¢é˜…æ¶ˆæ¯ã€‚ <br>pushæ¨¡å¼å¾ˆéš¾é€‚åº”æ¶ˆè´¹é€Ÿç‡ä¸åŒçš„æ¶ˆè´¹è€…ï¼Œå¦‚æœpushçš„é€Ÿåº¦å¤ªå¿«ï¼Œå®¹æ˜“é€ æˆæ¶ˆè´¹è€…æ‹’ç»æœåŠ¡æˆ–ç½‘ç»œæ‹¥ å¡ï¼›å¦‚æœpushçš„é€Ÿåº¦å¤ªæ…¢ï¼Œå®¹æ˜“é€ æˆæ¶ˆè´¹è€…æ€§èƒ½æµªè´¹ã€‚<br>ä½†æ˜¯é‡‡ç”¨pullçš„æ–¹å¼ä¹Ÿæœ‰ä¸€ä¸ªç¼ºç‚¹ï¼Œå°±æ˜¯å½“Brokeræ²¡æœ‰æ¶ˆæ¯æ—¶ï¼Œæ¶ˆè´¹è€…ä¼šé™·å…¥ä¸æ–­åœ°è½®è¯¢ä¸­ï¼Œä¸ºäº†é¿å…è¿™ç‚¹ï¼Œkafkaæœ‰ä¸ªå‚æ•°å¯ä»¥è®©æ¶ˆè´¹è€…é˜»å¡çŸ¥é“æ˜¯å¦æœ‰æ–°æ¶ˆæ¯åˆ°è¾¾ã€‚</p><h2 id="å“ªäº›åœºæ™¯ä½¿ç”¨é›¶æ‹·è´" tabindex="-1"><a class="header-anchor" href="#å“ªäº›åœºæ™¯ä½¿ç”¨é›¶æ‹·è´"><span>å“ªäº›åœºæ™¯ä½¿ç”¨é›¶æ‹·è´ï¼Ÿ<br><br></span></a></h2><p>ç­”æ¡ˆï¼š<br><strong>1ã€åŸºäº mmap çš„ç´¢å¼•</strong><br>ç´¢å¼•éƒ½æ˜¯åŸºäºMappedByteBufferçš„ï¼Œä¹Ÿå°±æ˜¯è®©ç”¨æˆ·æ€å’Œå†…æ ¸æ€å…±äº«å†…æ ¸æ€çš„æ•°æ®ç¼“å†²åŒºï¼Œæ­¤æ—¶ï¼Œæ•°æ®ä¸éœ€è¦å¤åˆ¶åˆ°ç”¨æˆ·æ€ç©ºé—´ã€‚ä¸è¿‡ï¼Œmmap è™½ç„¶é¿å…äº†ä¸å¿…è¦çš„æ‹·è´ï¼Œä½†ä¸ä¸€å®šå°±èƒ½ä¿è¯å¾ˆé«˜çš„æ€§èƒ½ã€‚åœ¨ä¸åŒçš„æ“ä½œç³»ç»Ÿä¸‹ï¼Œmmapçš„åˆ›å»ºå’Œé”€æ¯æˆæœ¬å¯èƒ½æ˜¯ä¸ä¸€æ ·çš„ã€‚å¾ˆé«˜çš„åˆ›å»ºå’Œé”€æ¯å¼€é”€ä¼šæŠµæ¶ˆZero Copyå¸¦æ¥çš„æ€§èƒ½ä¼˜åŠ¿ã€‚ç”±äºè¿™ç§ä¸ç¡®å®šæ€§ï¼Œåœ¨Kafkaä¸­ï¼Œåªæœ‰ç´¢å¼•åº”ç”¨äº†mmapï¼Œæœ€æ ¸å¿ƒçš„æ—¥å¿—å¹¶æœªä½¿ç”¨mmapæœºåˆ¶ã€‚</p><p><strong>2ã€æ—¥å¿—æ–‡ä»¶è¯»å†™æ‰€ç”¨çš„ TransportLayer</strong><br>TransportLayeræ˜¯Kafkaä¼ è¾“å±‚çš„æ¥å£ã€‚å®ƒçš„æŸä¸ªå®ç°ç±»ä½¿ç”¨äº†FileChannelçš„transferToæ–¹æ³•ã€‚è¯¥æ–¹æ³•åº•å±‚ä½¿ç”¨sendfileå®ç°äº†Zero Copyã€‚å¯¹Kafkaè€Œè¨€ï¼Œå¦‚æœI/Oé€šé“ä½¿ç”¨æ™®é€šçš„PLAINTEXTï¼Œé‚£ä¹ˆï¼ŒKafkaå°±å¯ä»¥åˆ©ç”¨Zero Copyç‰¹æ€§ï¼Œç›´æ¥å°†é¡µç¼“å­˜ä¸­çš„æ•°æ®å‘é€åˆ°ç½‘å¡çš„Bufferä¸­ï¼Œé¿å…ä¸­é—´çš„å¤šæ¬¡æ‹·è´ã€‚ç›¸åï¼Œå¦‚æœI/Oé€šé“å¯ç”¨äº†SSLï¼Œé‚£ä¹ˆï¼ŒKafkaä¾¿æ— æ³•åˆ©ç”¨ Zero Copy ç‰¹æ€§ã€‚</p><h2 id="åœ¨kafkaä¸­-zookeeper-ä½œç”¨æ˜¯ä»€ä¹ˆ" tabindex="-1"><a class="header-anchor" href="#åœ¨kafkaä¸­-zookeeper-ä½œç”¨æ˜¯ä»€ä¹ˆ"><span>åœ¨Kafkaä¸­ï¼ŒZooKeeper ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ<br><br></span></a></h2><p>ç­”æ¡ˆï¼š<br>Kafka ä½¿ç”¨ ZooKeeper å­˜æ”¾é›†ç¾¤å…ƒæ•°æ®ã€æˆå‘˜ç®¡ç†ã€Controller é€‰ä¸¾ï¼Œä»¥åŠå…¶ä»–ä¸€äº›ç®¡ç†ç±»ä»»åŠ¡ã€‚</p><ul><li>å­˜æ”¾å…ƒæ•°æ®ï¼šæ˜¯æŒ‡ä¸»é¢˜åˆ†åŒºçš„æ‰€æœ‰æ•°æ®éƒ½ä¿å­˜åœ¨ ZooKeeper ä¸­ï¼Œä¸”ä»¥å®ƒä¿å­˜çš„æ•°æ®ä¸ºå‡†</li><li>æˆå‘˜ç®¡ç†ï¼šæŒ‡ Broker èŠ‚ç‚¹çš„æ³¨å†Œã€æ³¨é”€ä»¥åŠå±æ€§å˜æ›´ï¼Œç­‰ç­‰ã€‚</li><li>Controller é€‰ä¸¾ï¼šæ˜¯æŒ‡é€‰ä¸¾é›†ç¾¤ Controllerï¼Œè€Œå…¶ä»–ç®¡ç†ç±»ä»»åŠ¡åŒ…æ‹¬ä½†ä¸é™äºä¸»é¢˜åˆ é™¤ã€å‚æ•°é…ç½® ç­‰ã€‚</li></ul><h2 id="å†å²æ•°æ®æ¸…ç†ç­–ç•¥" tabindex="-1"><a class="header-anchor" href="#å†å²æ•°æ®æ¸…ç†ç­–ç•¥"><span>å†å²æ•°æ®æ¸…ç†ç­–ç•¥ï¼Ÿ</span></a></h2><p>ç­”æ¡ˆï¼š</p><ul><li>åŸºäºä¿å­˜æ—¶é—´ï¼Œlog.retention.hours</li><li>åŸºäºæ—¥å¿—å¤§å°çš„æ¸…ç†ç­–ç•¥ã€‚é€šè¿‡log.retention.bytesæ§åˆ¶</li><li>ç»„åˆæ–¹å¼</li></ul></div><!----><!----><!--[--><h2 id="doc-contributors" tabindex="-1"><a href="#doc-contributors" class="header-anchor"><span>è´¡çŒ®è€…</span></a></h2><div class="vp-contributors"><a href="https://github.com/bbhou" target="_blank" rel="noreferrer" class="vp-contributor"><!----><span class="vp-contributor-name">bbhou</span></a></div><!--]--></div><footer class="vp-page-meta"><div class="vp-meta-item edit-link"><a class="auto-link external-link vp-meta-label" href="https://github.com/houbb/vpress/edit/main/src/posts/interview/tech/Kafka é‚£ç‚¹ç ´äº‹.md" aria-label="Edit this page on GitHub" rel="noopener noreferrer" target="_blank" iconsizing="both"><!--[--><svg xmlns="http://www.w3.org/2000/svg" class="icon edit-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="edit icon" name="edit"><path d="M430.818 653.65a60.46 60.46 0 0 1-50.96-93.281l71.69-114.012 7.773-10.365L816.038 80.138A60.46 60.46 0 0 1 859.225 62a60.46 60.46 0 0 1 43.186 18.138l43.186 43.186a60.46 60.46 0 0 1 0 86.373L588.879 565.55l-8.637 8.637-117.466 68.234a60.46 60.46 0 0 1-31.958 11.229z"></path><path d="M728.802 962H252.891A190.883 190.883 0 0 1 62.008 771.98V296.934a190.883 190.883 0 0 1 190.883-192.61h267.754a60.46 60.46 0 0 1 0 120.92H252.891a69.962 69.962 0 0 0-69.098 69.099V771.98a69.962 69.962 0 0 0 69.098 69.098h475.911A69.962 69.962 0 0 0 797.9 771.98V503.363a60.46 60.46 0 1 1 120.922 0V771.98A190.883 190.883 0 0 1 728.802 962z"></path></svg><!--]-->Edit this page on GitHub<!----></a></div><div class="vp-meta-item git-info"><div class="update-time"><span class="vp-meta-label">æœ€è¿‘æ›´æ–°ï¼š</span><time class="vp-meta-info" datetime="2025-08-16T11:28:53.000Z" data-allow-mismatch>2025/8/16 11:28</time></div></div></footer><!----><!----><!----><!--]--></main><!--]--><footer class="vp-footer-wrapper" vp-footer><div class="vp-footer">æˆ‘æ˜¯è€é©¬ï¼ŒæœŸå¾…ä¸ä½ çš„ä¸‹æ¬¡é‡é€¢</div><div class="vp-copyright">Copyright Â© 2025 è€é©¬å•¸è¥¿é£ </div></footer></div><!--]--><!--[--><!----><!----><!--[--><!--]--><!--]--><!--]--></div>
    <script type="module" src="/interview/assets/app-BDqOilFQ.js" defer></script>
  </body>
</html>
