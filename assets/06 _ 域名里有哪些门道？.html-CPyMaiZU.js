import{_ as a}from"./plugin-vue_export-helper-DlAUqK2U.js";import{c as p,a as r,o as t}from"./app-d8EKP-K0.js";const i={};function n(o,e){return t(),p("div",null,e[0]||(e[0]=[r(`<h1 id="_06-域名里有哪些门道" tabindex="-1"><a class="header-anchor" href="#_06-域名里有哪些门道"><span>06 _ 域名里有哪些门道？</span></a></h1><p><audio id="audio" title="06 | 域名里有哪些门道？" controls="" preload="none"><source id="mp3" src="https://static001.geekbang.org/resource/audio/81/3e/81cf8701700965c6fea30f406497bc3e.mp3"></audio></p><p>在上一讲里，我们学习了HTTP协议使用的TCP/IP协议栈，知道了HTTP协议是运行在TCP/IP上的。</p><p>IP协议的职责是“网际互连”，它在MAC层之上，使用IP地址把MAC编号转换成了四位数字，这就对物理网卡的MAC地址做了一层抽象，发展出了许多的“新玩法”。</p><p>例如，分为A、B、C、D、E五种类型，公有地址和私有地址，掩码分割子网等。只要每个小网络在IP地址这个概念上达成一致，不管它在MAC层有多大的差异，都可以接入TCP/IP协议栈，最终汇合进整个互联网。</p><p>但接入互联网的计算机越来越多，IP地址的缺点也就暴露出来了，最主要的是它“对人不友好”，虽然比MAC的16进制数要好一点，但还是难于记忆和输入。</p><p>怎么解决这个问题呢？</p><p>那就“以其人之道还治其人之身”，在IP地址之上再来一次抽象，把数字形式的IP地址转换成更有意义更好记的名字，在字符串的层面上再增加“新玩法”。于是，DNS域名系统就这么出现了。</p><h2 id="域名的形式" tabindex="-1"><a class="header-anchor" href="#域名的形式"><span>域名的形式</span></a></h2><p>在第4讲曾经说过，域名是一个有层次的结构，是一串用“.”分隔的多个单词，最右边的被称为“顶级域名”，然后是“二级域名”，层级关系向左依次降低。</p><p>最左边的是主机名，通常用来表明主机的用途，比如“www”表示提供万维网服务、“mail”表示提供邮件服务，不过这也不是绝对的，名字的关键是要让我们容易记忆。</p><p>看一下极客时间的域名“<a href="http://time.geekbang.org" target="_blank" rel="noopener noreferrer">time.geekbang.org</a>”，这里的“org”就是顶级域名，“geekbang”是二级域名，“time”则是主机名。使用这个域名，DNS就会把它转换成相应的IP地址，你就可以访问极客时间的网站了。</p><p>域名不仅能够代替IP地址，还有许多其他的用途。</p><p>在Apache、Nginx这样的Web服务器里，域名可以用来标识虚拟主机，决定由哪个虚拟主机来对外提供服务，比如在Nginx里就会使用“server_name”指令：</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>server {</span></span>
<span class="line"><span>    listen 80;                       #监听80端口</span></span>
<span class="line"><span>    server_name  time.geekbang.org;  #主机名是time.geekbang.org</span></span>
<span class="line"><span>    ...</span></span>
<span class="line"><span>}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>域名本质上还是个名字空间系统，使用多级域名就可以划分出不同的国家、地区、组织、公司、部门，每个域名都是独一无二的，可以作为一种身份的标识。</p><p>举个例子吧，假设A公司里有个小明，B公司里有个小强，于是他们就可以分别说是“小明.A公司”，“小强.B公司”，即使B公司里也有个小明也不怕，可以标记为“小明.B公司”，很好地解决了重名问题。</p><p>因为这个特性，域名也被扩展到了其他应用领域，比如Java的包机制就采用域名作为命名空间，只是它使用了反序。如果极客时间要开发Java应用，那么它的包名可能就是“org.geekbang.time”。</p><p>而XML里使用URI作为名字空间，也是间接使用了域名。</p><h2 id="域名的解析" tabindex="-1"><a class="header-anchor" href="#域名的解析"><span>域名的解析</span></a></h2><p>就像IP地址必须转换成MAC地址才能访问主机一样，域名也必须要转换成IP地址，这个过程就是“<strong>域名解析</strong>”。</p><p>目前全世界有几亿个站点，有几十亿网民，而每天网络上发生的HTTP流量更是天文数字。这些请求绝大多数都是基于域名来访问网站的，所以DNS就成了互联网的重要基础设施，必须要保证域名解析稳定可靠、快速高效。</p><p>DNS的核心系统是一个三层的树状、分布式服务，基本对应域名的结构：</p><ol><li>根域名服务器（Root DNS Server）：管理顶级域名服务器，返回“com”“net”“cn”等顶级域名服务器的IP地址；</li><li>顶级域名服务器（Top-level DNS Server）：管理各自域名下的权威域名服务器，比如com顶级域名服务器可以返回apple.com域名服务器的IP地址；</li><li>权威域名服务器（Authoritative DNS Server）：管理自己域名下主机的IP地址，比如apple.com权威域名服务器可以返回www.apple.com的IP地址。</li></ol><img src="https://static001.geekbang.org/resource/image/6b/f2/6b020454987543efdd1cf6ddec784bf2.png" alt=""><p>在这里根域名服务器是关键，它必须是众所周知的，否则下面的各级服务器就无从谈起了。目前全世界共有13组根域名服务器，又有数百台的镜像，保证一定能够被访问到。</p><p>有了这个系统以后，任何一个域名都可以在这个树形结构里从顶至下进行查询，就好像是把域名从右到左顺序走了一遍，最终就获得了域名对应的IP地址。</p><p>例如，你要访问“<a href="http://www.apple.com" target="_blank" rel="noopener noreferrer">www.apple.com</a>”，就要进行下面的三次查询：</p><ol><li>访问根域名服务器，它会告诉你“com”顶级域名服务器的地址；</li><li>访问“com”顶级域名服务器，它再告诉你“<a href="http://apple.com" target="_blank" rel="noopener noreferrer">apple.com</a>”域名服务器的地址；</li><li>最后访问“<a href="http://apple.com" target="_blank" rel="noopener noreferrer">apple.com</a>”域名服务器，就得到了“<a href="http://www.apple.com" target="_blank" rel="noopener noreferrer">www.apple.com</a>”的地址。</li></ol><p>虽然核心的DNS系统遍布全球，服务能力很强也很稳定，但如果全世界的网民都往这个系统里挤，即使不挤瘫痪了，访问速度也会很慢。</p><p>所以在核心DNS系统之外，还有两种手段用来减轻域名解析的压力，并且能够更快地获取结果，基本思路就是“<strong>缓存</strong>”。</p><p>首先，许多大公司、网络运行商都会建立自己的DNS服务器，作为用户DNS查询的代理，代替用户访问核心DNS系统。这些“野生”服务器被称为“非权威域名服务器”，可以缓存之前的查询结果，如果已经有了记录，就无需再向根服务器发起查询，直接返回对应的IP地址。</p><p>这些DNS服务器的数量要比核心系统的服务器多很多，而且大多部署在离用户很近的地方。比较知名的DNS有Google的“8.8.8.8”，Microsoft的“4.2.2.1”，还有CloudFlare的“1.1.1.1”等等。</p><p>其次，操作系统里也会对DNS解析结果做缓存，如果你之前访问过“<a href="http://www.apple.com" target="_blank" rel="noopener noreferrer">www.apple.com</a>”，那么下一次在浏览器里再输入这个网址的时候就不会再跑到DNS那里去问了，直接在操作系统里就可以拿到IP地址。</p><p>另外，操作系统里还有一个特殊的“主机映射”文件，通常是一个可编辑的文本，在Linux里是“/etc/hosts”，在Windows里是“C:\\WINDOWS\\system32\\drivers\\etc\\hosts”，如果操作系统在缓存里找不到DNS记录，就会找这个文件。</p><p>有了上面的“野生”DNS服务器、操作系统缓存和hosts文件后，很多域名解析的工作就都不用“跋山涉水”了，直接在本地或本机就能解决，不仅方便了用户，也减轻了各级DNS服务器的压力，效率就大大提升了。</p><p>下面的这张图比较完整地表示了现在的DNS架构。</p><img src="https://static001.geekbang.org/resource/image/e5/ac/e51df3245609880641043af65bba94ac.png" alt=""><p>在Nginx里有这么一条配置指令“resolver”，它就是用来配置DNS服务器的，如果没有它，那么Nginx就无法查询域名对应的IP，也就无法反向代理到外部的网站。</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>resolver 8.8.8.8 valid=30s;  #指定Google的DNS，缓存30秒</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h2 id="域名的-新玩法" tabindex="-1"><a class="header-anchor" href="#域名的-新玩法"><span>域名的“新玩法”</span></a></h2><p>有了域名，又有了可以稳定工作的解析系统，于是我们就可以实现比IP地址更多的“新玩法”了。</p><p>第一种，也是最简单的，“重定向”。因为域名代替了IP地址，所以可以让对外服务的域名不变，而主机的IP地址任意变动。当主机有情况需要下线、迁移时，可以更改DNS记录，让域名指向其他的机器。</p><p>比如，你有一台“<a href="http://buy.tv" target="_blank" rel="noopener noreferrer">buy.tv</a>”的服务器要临时停机维护，那你就可以通知DNS服务器：“我这个buy.tv域名的地址变了啊，原先是1.2.3.4，现在是5.6.7.8，麻烦你改一下。”DNS于是就修改内部的IP地址映射关系，之后再有访问buy.tv的请求就不走1.2.3.4这台主机，改由5.6.7.8来处理，这样就可以保证业务服务不中断。</p><p>第二种，因为域名是一个名字空间，所以可以使用bind9等开源软件搭建一个在内部使用的DNS，作为名字服务器。这样我们开发的各种内部服务就都用域名来标记，比如数据库服务都用域名“mysql.inner.app”，商品服务都用“goods.inner.app”，发起网络通信时也就不必再使用写死的IP地址了，可以直接用域名，而且这种方式也兼具了第一种“玩法”的优势。</p><p>第三种“玩法”包含了前两种，也就是基于域名实现的负载均衡。</p><p>这种“玩法”也有两种方式，两种方式可以混用。</p><p>第一种方式，因为域名解析可以返回多个IP地址，所以一个域名可以对应多台主机，客户端收到多个IP地址后，就可以自己使用轮询算法依次向服务器发起请求，实现负载均衡。</p><p>第二种方式，域名解析可以配置内部的策略，返回离客户端最近的主机，或者返回当前服务质量最好的主机，这样在DNS端把请求分发到不同的服务器，实现负载均衡。</p><p>前面我们说的都是可信的DNS，如果有一些不怀好意的DNS，那么它也可以在域名这方面“做手脚”，弄一些比较“恶意”的“玩法”，举两个例子：</p><ul><li>“域名屏蔽”，对域名直接不解析，返回错误，让你无法拿到IP地址，也就无法访问网站；</li><li>“域名劫持”，也叫“域名污染”，你要访问A网站，但DNS给了你B网站。</li></ul><p>好在互联网上还是好人多，而且DNS又是互联网的基础设施，这些“恶意DNS”并不多见，你上网的时候不需要太过担心。</p><h2 id="小结" tabindex="-1"><a class="header-anchor" href="#小结"><span>小结</span></a></h2><p>这次我们学习了与HTTP协议有重要关系的域名和DNS，在这里简单小结一下今天的内容：</p><ol><li>域名使用字符串来代替IP地址，方便用户记忆，本质上一个名字空间系统；</li><li>DNS就像是我们现实世界里的电话本、查号台，统管着互联网世界里的所有网站，是一个“超级大管家”；</li><li>DNS是一个树状的分布式查询系统，但为了提高查询效率，外围有多级的缓存；</li><li>使用DNS可以实现基于域名的负载均衡，既可以在内网，也可以在外网。</li></ol><h2 id="课下作业" tabindex="-1"><a class="header-anchor" href="#课下作业"><span>课下作业</span></a></h2><ol><li>在浏览器地址栏里随便输入一个不存在的域名，比如就叫“<a href="http://www.xn--ihqv5t4nd.com" target="_blank" rel="noopener noreferrer">www.不存在.com</a>”，试着解释一下它的DNS解析过程。</li><li>如果因为某些原因，DNS失效或者出错了，会出现什么后果？</li></ol><p>欢迎你把自己的答案写在留言区，与我和其他同学一起讨论。如果你觉得有所收获，也欢迎把文章分享给你的朋友。</p><img src="https://static001.geekbang.org/resource/image/78/36/7838e0e705864ddfeacc79e0aeb8f236.png" alt="unpreview">`,59)]))}const c=a(i,[["render",n]]),d=JSON.parse('{"path":"/posts/%E9%80%8F%E8%A7%86HTTP%E5%8D%8F%E8%AE%AE/%E7%A0%B4%E5%86%B0%E7%AF%87/06%20_%20%E5%9F%9F%E5%90%8D%E9%87%8C%E6%9C%89%E5%93%AA%E4%BA%9B%E9%97%A8%E9%81%93%EF%BC%9F.html","title":"06 _ 域名里有哪些门道？","lang":"zh-CN","frontmatter":{"description":"06 _ 域名里有哪些门道？ 在上一讲里，我们学习了HTTP协议使用的TCP/IP协议栈，知道了HTTP协议是运行在TCP/IP上的。 IP协议的职责是“网际互连”，它在MAC层之上，使用IP地址把MAC编号转换成了四位数字，这就对物理网卡的MAC地址做了一层抽象，发展出了许多的“新玩法”。 例如，分为A、B、C、D、E五种类型，公有地址和私有地址，掩...","head":[["meta",{"property":"og:url","content":"https://houbb.github.io/interview/posts/%E9%80%8F%E8%A7%86HTTP%E5%8D%8F%E8%AE%AE/%E7%A0%B4%E5%86%B0%E7%AF%87/06%20_%20%E5%9F%9F%E5%90%8D%E9%87%8C%E6%9C%89%E5%93%AA%E4%BA%9B%E9%97%A8%E9%81%93%EF%BC%9F.html"}],["meta",{"property":"og:site_name","content":"老马啸西风"}],["meta",{"property":"og:title","content":"06 _ 域名里有哪些门道？"}],["meta",{"property":"og:description","content":"06 _ 域名里有哪些门道？ 在上一讲里，我们学习了HTTP协议使用的TCP/IP协议栈，知道了HTTP协议是运行在TCP/IP上的。 IP协议的职责是“网际互连”，它在MAC层之上，使用IP地址把MAC编号转换成了四位数字，这就对物理网卡的MAC地址做了一层抽象，发展出了许多的“新玩法”。 例如，分为A、B、C、D、E五种类型，公有地址和私有地址，掩..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2025-08-16T11:19:38.000Z"}],["meta",{"property":"article:modified_time","content":"2025-08-16T11:19:38.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"06 _ 域名里有哪些门道？\\",\\"image\\":[\\"\\"],\\"dateModified\\":\\"2025-08-16T11:19:38.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"老马啸西风\\",\\"url\\":\\"https://houbb.github.io\\"}]}"]]},"git":{"createdTime":1755343178000,"updatedTime":1755343178000,"contributors":[{"name":"bbhou","username":"bbhou","email":"1557740299@qq.com","commits":1,"url":"https://github.com/bbhou"}]},"readingTime":{"minutes":9.85,"words":2955},"filePathRelative":"posts/透视HTTP协议/破冰篇/06 _ 域名里有哪些门道？.md","localizedDate":"2025年8月16日","excerpt":"\\n<p><audio id=\\"audio\\" title=\\"06 | 域名里有哪些门道？\\" controls=\\"\\" preload=\\"none\\"><source id=\\"mp3\\" src=\\"https://static001.geekbang.org/resource/audio/81/3e/81cf8701700965c6fea30f406497bc3e.mp3\\"></audio></p>\\n<p>在上一讲里，我们学习了HTTP协议使用的TCP/IP协议栈，知道了HTTP协议是运行在TCP/IP上的。</p>\\n<p>IP协议的职责是“网际互连”，它在MAC层之上，使用IP地址把MAC编号转换成了四位数字，这就对物理网卡的MAC地址做了一层抽象，发展出了许多的“新玩法”。</p>","autoDesc":true}');export{c as comp,d as data};
